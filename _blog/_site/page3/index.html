<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>

<meta charset="utf-8">
<title>Delicious Days &#8211; Delicious Days</title>
<meta name="description" content="Ryoya Kawai's Life Blog">
<meta name="keywords" content="blog, ryoya, kawai, life">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://ryoyakawai.com/blog/images/background_sf_pano.jpg">

<meta name="twitter:description" content="Ryoya Kawai's Life Blog">


<!-- Open Graph -->
<meta property="og:locale" content="ja_JP">
<meta property="og:type" content="summary">
<meta property="og:image" content="https://ryoyakawai.com/blog/images/background_sf_pano_300x300.jpg">
<meta property="og:title" content="Delicious Days">
<meta property="og:description" content="Ryoya Kawai's Life Blog">
<meta property="og:url" content="https://ryoyakawai.com/blog/page3/">
<meta property="og:site_name" content="Delicious Days">





<link rel="canonical" href="https://ryoyakawai.com/blog/page3/">
<link href="https://ryoyakawai.com/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Delicious Days Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://ryoyakawai.com/blog/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://ryoyakawai.com/blog/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Polymer -->
<script src="https://polygit.org/components/webcomponentsjs/webcomponents-loader.js"></script>
<link rel="import" href="https://ryoyakawai.com/blog/assets/components/youtube-play.html">
<link rel="import" href="https://ryoyakawai.com/blog/assets/components/language-selector.html">

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://ryoyakawai.com/blog/images/profile_photo.jpg">
<link rel="icon" type="image/jpeg" href="https://ryoyakawai.com/blog/images/profile_photo.jpg">



<!-- AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9891854265132215",
    enable_page_level_ads: true
  });
</script>




  <link rel="stylesheet" type="text/css" href="https://ryoyakawai.com/blog/assets/css/header-title.css">
  <link rel="stylesheet" type="text/css" href="https://ryoyakawai.com/blog/assets/css/post.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
   (adsbygoogle = window.adsbygoogle || []).push({
     google_ad_client: "ca-pub-9891854265132215",
     enable_page_level_ads: true
   });
  </script>
</head>

<body id="post-index" class="feature">

<!-- register service worker-->
<script type="text/javascript" src="register_sw.js"></script>

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="https://ryoyakawai.com/blog/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="https://ryoyakawai.com/blog/images/avatar.jpg" alt="Ryoya Kawai photo" class="author-photo">
					<h4>Ryoya Kawai</h4>
					<p></p>
				</li>
				<li><a href="https://ryoyakawai.com/blog/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:blog@ryoyakawai.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/ryoyakawai"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/ryoyakawai"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				<li>
					<a href="https://google.com/+ryoyakawai"><i class="fa fa-fw fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="https://linkedin.com/in/ryoya-kawai-11342b57"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/ryoyakawai"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="https://ryoyakawai.com/blog/posts/">Order by Date</a></li>
				<li><a href="https://ryoyakawai.com/blog/tags/">Group By Tag</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <img class="entry-raw-image" src="https://ryoyakawai.com/blog/images/background_sf_pano.jpg">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1 class="header-title-text">Delicious Days</h1>
      <!--h2>Delicious Days</h2-->
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-07-18T00:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/07/18/ci-android-espresso-00.html">July 18, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/07/18/ci-android-espresso-00.html" rel="bookmark" title="Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã" itemprop="url">Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="ã“ã‚Œã¯ä½•">ã“ã‚Œã¯ä½•ï¼Ÿ</h2>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®UI Testã®æ›¸ãæ–¹ã«ã¤ã„ã¦èª¬æ˜ã—ãŸè¨˜äº‹ã§ã™ã€‚
å…·ä½“çš„ã«ã¯<a href="https://github.com/ryoyakawai/uitest_sample_android">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª</a>ã®<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">UI Testã§ã‚ã‚‹ã“ã‚Œ</a>ã®èª¬æ˜ã§ã™ã€‚</p>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>
<h3 id="androidã§ui-testã‚’æ›¸ã">Androidã§UI Testã‚’æ›¸ã</h3>
<p>AndroidãŒå…¬å¼ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹UI Testã®ãƒ„ãƒ¼ãƒ«ã¯ <a href="https://developer.android.com/training/testing/espresso">Espresso</a>ã€
<a href="https://developer.android.com/training/testing/ui-automator">UI Automator</a> ã®2ç¨®é¡ã‚ã‚Šã¾ã™ã€‚
ãã‚Œãã‚Œä»¥ä¸‹ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã®ã§ã€Œã©ã¡ã‚‰ã‚’ä½¿ã†ã‹ï¼Ÿã€ã«ã¤ã„ã¦ã¯ã€Œã©ã¡ã‚‰ã‚‚ä½µç”¨ã—ã¦ä½¿ã†ã€ã®ãŒã„ã„ã‚ˆã†ã«æ„Ÿã˜ã¦ã„ã¾ã™ã€‚</p>

<h4 id="espresso">Espresso</h4>
<p>ã€Œto write concise, beautiful, and reliable Android UI testsã€ã¨å…¬å¼ã‚µã‚¤ãƒˆã«ã¯èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹å®šã®ã‚¢ãƒ—ãƒªã®UIã«å¯¾ã—ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹•ä½œã‚’ã•ã›ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚å˜ä¸€ã®ã‚¢ãƒ—ãƒªã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹å ´åˆã«ä½¿ã†ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚Googleç¤¾ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã®ã§ã€Anroidã®å…¬å¼ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¨è¨€ã£ã¦ã‚ˆã„ã§ã—ã‚‡ã†ã€‚<br />
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ã‚¢ãƒ—ãƒªã®æ“ä½œã®ã™ã¹ã¦ã‚’Espressoã§æ›¸ã„ã¦ã„ã¾ã™ã€‚</p>

<h4 id="ui-automator">UI Automator</h4>
<p>ã€Œsuitable for cross-app functional UI testing across system and installed apps.ã€ã¨å…¬å¼ã‚µã‚¤ãƒˆã«èª¬æ˜ã•ã‚Œã¦ã„ã‚‹é€šã‚Šã§ã€Espressoã¨æ¯”ã¹ã‚‹ã¨ã€ã‚ˆã‚ŠAndroidã®OSã«è¿‘ã„å´ã«ä½ç½®ã—ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€è¤‡æ•°ã‚¢ãƒ—ãƒªã‚’è¡Œãæ¥ã™ã‚‹ã‚ˆã†å‹•ä½œã‚’ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®šç¾©ã™ã‚‹ã“ã¨ã®å¯èƒ½ã§ã™ã€‚Espressoã¨ã¯é•ã„ã€è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹å ´åˆã«ä½¿ã†ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚ã“ã¡ã‚‰ã‚‚Espressoã¨åŒã˜ãGoogleç¤¾ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã®ã§ã€Anroidã®å…¬å¼ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¨è¨€ã£ã¦ã‚ˆã„ã§ã—ã‚‡ã†ã€‚<br />
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®æ’®å½±ã€Permissionãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®æ“ä½œã®2ã¤ã‚’UI Automatorã§æ›¸ã„ã¦ã„ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-uitesttool_00.png" width="50%" />
</div>

<h3 id="espressoui-automatorã§testã‚’æ›¸ãæº–å‚™ã‚’ã™ã‚‹">Espressoã€UI Automatorã§Testã‚’æ›¸ãæº–å‚™ã‚’ã™ã‚‹</h3>
<p>ä»¥ä¸‹ã®2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¦æº–å‚™å®Œäº†ã§ã™ã€‚</p>

<h4 id="-buildgradle-ã«ä»¥ä¸‹ã‚’è¿½åŠ ">ï¼ <code class="highlighter-rouge">build.gradle</code> ã«ä»¥ä¸‹ã‚’è¿½åŠ </h4>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="n">allprojects</span> <span class="p">{</span>
<span class="o">....</span>
  <span class="n">tasks</span><span class="p">.</span><span class="n">matching</span> <span class="p">{</span><span class="n">it</span> <span class="n">instanceof</span> <span class="n">Test</span><span class="p">}.</span><span class="n">all</span> <span class="p">{</span>
    <span class="n">testLogging</span><span class="p">.</span><span class="n">events</span> <span class="p">=</span> <span class="p">[</span><span class="s">"failed"</span><span class="p">,</span> <span class="s">"passed"</span><span class="p">,</span> <span class="s">"skipped"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="o">....</span>
<span class="p">}</span>
<span class="o">....</span>
</code></pre></div></div>

<h4 id="-appbuildgradle-ã«ä»¥ä¸‹ã‚’è¿½åŠ "><code class="highlighter-rouge">ï¼ app/build.gradle</code> ã«ä»¥ä¸‹ã‚’è¿½åŠ </h4>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="n">dependencies</span> <span class="p">{</span>
<span class="o">....</span>
  <span class="c1">// for connected Android test
</span>  <span class="n">androidTestUtil</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">:</span><span class="n">orchestrator</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">:</span><span class="n">runner</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">espresso</span><span class="p">:</span><span class="n">espresso</span><span class="p">-</span><span class="n">core</span><span class="p">:</span><span class="m">3.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">espresso</span><span class="p">:</span><span class="n">espresso</span><span class="p">-</span><span class="n">intents</span><span class="p">:</span><span class="m">3.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">uiautomator</span><span class="p">:</span><span class="n">uiautomator</span><span class="p">-</span><span class="n">v18</span><span class="p">:</span><span class="m">2.1</span><span class="p">.</span><span class="m">3</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">:</span><span class="n">rules</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">junit</span><span class="p">:</span><span class="n">junit</span><span class="p">:</span><span class="m">4.12</span><span class="err">'</span>
<span class="o">....</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ãƒ†ã‚¹ãƒˆã‚’æ›¸ã">ãƒ†ã‚¹ãƒˆã‚’æ›¸ã</h3>
<p>ãƒ†ã‚¹ãƒˆã¯<code class="highlighter-rouge">app/src/androidTest/[Packageå]</code>ä»¥ä¸‹ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚<br />
ä»Šå›ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ <code class="highlighter-rouge">com.example.uitestsample</code> 
ã§ã™ã®ã§ <a href="app/src/androidTest/java/com/example/uitestsample/"><code class="highlighter-rouge">app/src/androidTest/java/com/example/uitestsample/</code></a>
ä»¥ä¸‹ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚<br />
ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã®ç²’åº¦ã¯Activityæ¯ã€Fragmentæ¯ã€æ©Ÿèƒ½æ¯ç­‰ã€è‡ªç”±ã«ã¾ã¨ã‚ã¦ã—ã¾ã£ã¦å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯Activityæ¯ã§ã¾ã¨ã‚ã¦<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">MainActivityInstrumentedTest.kt</a>ã«æ›¸ã„ã¦ã„ã¾ã™ã€‚</p>

<h4 id="å‰æº–å‚™">å‰æº–å‚™</h4>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">@RunWith</span><span class="p">(</span><span class="n">AndroidJUnit4</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="n">@SdkSuppress</span><span class="p">(</span><span class="n">minSdkVersion</span> <span class="p">=</span> <span class="m">26</span><span class="p">)</span>
<span class="n">@LargeTest</span>
<span class="kd">class</span> <span class="nc">MainActivityInstrumentedTest</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">_packageName</span> <span class="p">=</span> <span class="s">"com.example.uitestsample"</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">mUTs</span><span class="p">:</span> <span class="n">UiTestUtils</span> <span class="p">=</span> <span class="n">UiTestUtils</span><span class="p">()</span>
    <span class="c1">// ^^^ ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ– ^^^
</span>
    <span class="n">@Rule</span>
    <span class="n">@JvmField</span>
    <span class="kd">val</span> <span class="py">mActivityTestRule</span><span class="p">:</span> <span class="n">ActivityTestRule</span><span class="p">&lt;</span><span class="n">MainActivity</span><span class="p">&gt;</span> <span class="p">=</span>
        <span class="n">ActivityTestRule</span><span class="p">(</span><span class="n">MainActivity</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>

    <span class="n">@Rule</span>
    <span class="n">@JvmField</span>
    <span class="kd">val</span> <span class="py">cGrantPermissionRule</span><span class="p">:</span> <span class="n">GrantPermissionRule</span> <span class="p">=</span>
        <span class="n">GrantPermissionRule</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="n">Manifest</span><span class="p">.</span><span class="n">permission</span><span class="p">.</span><span class="n">WRITE_EXTERNAL_STORAGE</span><span class="p">)</span>
    <span class="c1">// ^^^ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¿å­˜ã®ç‚ºã«STORAGEã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¼·åˆ¶çš„ã«è¨±å¯ ^^^
</span>
    <span class="n">@Rule</span>
    <span class="n">@JvmField</span>
    <span class="kd">val</span> <span class="py">screenshotRule</span> <span class="p">=</span> <span class="n">ScreenshotTakingRule</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">)</span>
    <span class="c1">// ^^^ Testå¤±æ•—æ™‚ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±ã™ã‚‹ã‚ˆã†ã«æŒ‡å®š ^^^
</span>
    <span class="n">@Before</span>
    <span class="k">fun</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">setActivity</span><span class="p">(</span><span class="n">mActivityTestRule</span><span class="p">.</span><span class="n">activity</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">@After</span>
    <span class="k">fun</span> <span class="nf">teardown</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

<span class="o">....</span>

<span class="p">}</span>
</code></pre></div></div>
<p>ã€ŒTestå¤±æ•—æ™‚ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ã®å‹•ä½œã¯ <code class="highlighter-rouge">uitestutils/UiTestUtils.kt</code> ã®æœ€å¾Œã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="kd">class</span> <span class="nc">ScreenshotTakingRule</span><span class="p">(</span><span class="n">mUTs</span><span class="p">:</span> <span class="n">UiTestUtils</span><span class="p">)</span> <span class="p">:</span> <span class="n">TestWatcher</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">mUTs</span> <span class="p">=</span> <span class="n">mUTs</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">failed</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Throwable</span><span class="p">?,</span> <span class="n">description</span><span class="p">:</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">runner</span><span class="p">.</span><span class="n">Description</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="n">failed</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">mUTs</span><span class="p">.</span><span class="n">screenShot</span><span class="p">(</span><span class="s">"FAIL-$description"</span><span class="p">)</span>
        <span class="n">mUTs</span><span class="p">.</span><span class="n">log_d</span><span class="p">(</span><span class="s">"&gt;&gt;&gt; !!! TEST FAILED !!! &lt;&lt;&lt; ScreenShot Taken method=[$description] filename=[$path]"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<h4 id="ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹">ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹</h4>
<p>ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®3ã¤ã§ã™ã€‚
ã€Œã‚±ãƒ¼ã‚¹ã¨ã—ã¦è¶³ã‚Šãªã„ï¼ã€ã¨ã‹ãƒ„ãƒƒã‚³ãƒŸã¯ã‚ã‚Šã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€UI Testã‚’å‹•ã‹ã™ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã®ã§ã”å®¹èµ¦ãã ã•ã„ã€‚</p>

<ul>
  <li><code class="highlighter-rouge">useAppContext()</code>ï¼šãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’ç¢ºèª</li>
  <li><code class="highlighter-rouge">checkTextHelloWorld()</code>ï¼šã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã€ä¸­å¿ƒã®ã€ŒHello World!ã€ã®è¡¨ç¤ºã‚’ç¢ºèª</li>
  <li><code class="highlighter-rouge">checkButtonIncrementFloating()</code>ï¼šç”»é¢å³ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨è¡¨ç¤ºã—ã¦ã„ã‚‹æ•°å­—ãŒã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—SnackbarãŒè¡¨ç¤ºã•ã‚Œã€ã¾ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰Resetã™ã‚‹ã¨ã‚¼ãƒ­ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª</li>
</ul>

<p><code class="highlighter-rouge">checkButtonIncrementFloating()</code> ã®ãƒã‚¤ãƒ³ãƒˆã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§èª¬æ˜ã—ã¾ã™ã€‚<br />
<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">Testã®ã‚³ãƒ¼ãƒ‰å…¨ä½“ã¯ã“ã¡ã‚‰</a>ã«ãªã‚Šã¾ã™ã®ã§åˆã‚ã›ã¦å¾¡è¦§ãã ã•ã„ã€‚</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="n">@Test</span>
<span class="k">fun</span> <span class="nf">checkButtonIncrementFloating</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// false ã«ã™ã‚‹ã“ã¨ã§TestãŒæˆåŠŸã—ãŸå ´åˆã§ã‚‚ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ®‹ã›ã¾ã™ã€‚
</span>    <span class="c1">// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€TestãŒæˆåŠŸã™ã‚‹ã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¯å…¨å‰Šé™¤ã¨ãªã‚Šã¾ã™ã€‚
</span>    <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">prepareScreenShot</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>

<span class="o">....</span>

    <span class="kd">val</span> <span class="py">willTap</span> <span class="p">=</span> <span class="m">5</span>
    <span class="c1">// å³ä¸‹ã®èµ¤è‰²ã®Fabã‚’æŒ‡å®š
</span>    <span class="kd">val</span> <span class="py">incrementButton</span> <span class="p">=</span>  <span class="n">withId</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">increment_fab_text</span><span class="p">)</span>

    <span class="c1">// ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’å¢—åŠ ã•ã›ã¦è¡¨ç¤ºãŒæƒ³å®šé€šã‚Šã§ã‚ã‚‹ã‹ç¢ºèªã™ã‚‹
</span>    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">..</span><span class="n">willTap</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±
</span>        <span class="n">mUTs</span><span class="p">.</span><span class="n">screenShot</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"BEFORE &gt;&gt;&gt; ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼šã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ IDX=[$i]"</span><span class="p">)</span>
        <span class="c1">// æŒ‡å®šã—ãŸèµ¤è‰²ã®Fabã‚’ã‚¿ãƒƒãƒ—
</span>        <span class="n">onView</span><span class="p">(</span><span class="n">incrementButton</span><span class="p">).</span><span class="n">perform</span><span class="p">(</span><span class="n">click</span><span class="p">())</span>

        <span class="c1">// Permissionãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‡ºã¦ãŸã‚‰è¨±å¯ï¼ˆã“ã®ãƒ†ã‚¹ãƒˆä¸­ã¯å‡ºãªã„ã¯ãšï¼‰
</span>        <span class="n">mUTs</span><span class="p">.</span><span class="n">allowPermissionsIfNeeded</span><span class="p">()</span>

        <span class="c1">// ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±
</span>        <span class="n">mUTs</span><span class="p">.</span><span class="n">screenShot</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"AFTER &gt;&gt;&gt; ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼šã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ IDX=[$i]"</span><span class="p">)</span>
        <span class="c1">// è¦ç´ å†…ã®æ–‡å­—åˆ—ã‚’å–å¾—
</span>        <span class="n">actualCount</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">getText</span><span class="p">(</span><span class="n">withId</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">main_content_text</span><span class="p">))</span>
        <span class="c1">// ãƒ­ã‚°ã‚’æ®‹ã™
</span>        <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">log_d</span><span class="p">(</span><span class="s">"[Counter SEQ] ğŸğŸ expected=[$i] actual=[$actualCount]"</span><span class="p">)</span>
        <span class="c1">// æ–‡å­—åˆ—ã‚’Assert
</span>        <span class="n">assertEquals</span><span class="p">(</span><span class="s">"[Counter SEQ] ğŸğŸ"</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">toString</span><span class="p">(),</span> <span class="n">actualCount</span><span class="p">)</span>

        <span class="c1">// Snackbarã®æ–‡è¨€ãƒã‚§ãƒƒã‚¯
</span>        <span class="kd">val</span> <span class="py">snackBarTapped</span> <span class="p">=</span> <span class="n">allOf</span><span class="p">(</span><span class="n">withId</span><span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">design</span><span class="p">.</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">snackbar_text</span><span class="p">),</span> <span class="n">withText</span><span class="p">(</span><span class="s">"Tapped $i times."</span><span class="p">))</span>
        <span class="c1">// SnackbarãŒã‹ã‚‰æ¶ˆãˆã‚‹ã®ã‚’å¾…ã¤
</span>        <span class="n">waitForSnackbarDisappear</span><span class="p">(</span><span class="n">snackBarTapped</span><span class="p">)</span>
        <span class="c1">// Sleepã™ã‚‹
</span>        <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="s">"SHR"</span><span class="p">)</span>
    <span class="p">}</span>

<span class="o">....</span>

    <span class="c1">// this.mUTs.prepareScreenShot() ã« false ã‚’ã‚»ãƒƒãƒˆã—ã¦ã„ãªã‘ã‚Œã°
</span>    <span class="c1">// ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å‰Šé™¤ã™ã‚‹ï¼ˆï¼‰
</span>    <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">removeSuccessScreenShots</span><span class="p">()</span>

<span class="o">....</span>

<span class="p">}</span>
<span class="o">....</span>
</code></pre></div></div>

<h3 id="idãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®æŒ‡å®šæ–¹æ³•">IDãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®æŒ‡å®šæ–¹æ³•</h3>
<p>ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã«å¯¾ã—ã¦IDãŒæŒ¯ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã¯å¤§æŠµã®å ´åˆãã®IDã‚’ä½¿ã†ã“ã¨ã§æŒ‡å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ãŒã€
æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ <strong>Layout Inspector</strong> ï¼ˆ<a href="https://developer.android.com/studio/debug/layout-inspector">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ï¼‰ã§éšå±¤æ§‹é€ ã‚’å–å¾—
ã—ã¦è§£æã‚’ã—ã¦ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã‚’è¡Œã„ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190718-layoutinspector-00.png" width="90%" />
</div>

<p>Fragmentã®é‡ãªã‚Šæ–¹ãŒæ“ä½œã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹å ´åˆãŒã‚ã‚Šã€è¡¨ç¤ºã¯åŒã˜ã§ã‚‚éšå±¤ãŒé•ã†å ´åˆãŒå¤šã€…ç™ºç”Ÿã—ã¾ã™ã€‚
ã§ã™ã®ã§ã€Layout Inspectorã§éšå±¤æ§‹é€ ã‚’å–å¾—ã™ã‚‹ã¨ãã¯UI Testã§ã®ã‚·ãƒŠãƒªã‚ªé€šã‚Šã«ä¸€åº¦ç”»é¢ã‚’é·ç§»ã•ã›ã¦ã€ãã‚Œã‹ã‚‰å–å¾—ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚</p>

<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>iOSæ¨™æº–ã®UI Testãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹<a href="https://developer.apple.com/documentation/xctest">XCTest</a>ã«æ¯”ã¹ã‚‹ã¨
ç™–ãŒå°‘ã—å¼·ã„ã§ã™ã€‚ã¨ã£ã¤ãã«ãã„ã¨ã“ã‚ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãã“ã¾ã§é›£ã—ãã¯ãªã„ã®ã§æ°—ã«ãªã£ã¦ã„ã‚‹å ´åˆã¯æŒ‘æˆ¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚<br />
è‡ªåˆ†ã®ä½œã£ãŸã‚¢ãƒ—ãƒªãŒè‡ªå‹•ã§å‹•ãã®ã‚’è¦‹ã‚‹ã®ã‚‚æ¥½ã—ã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h2 id="reference">Reference</h2>
<ul>
  <li><a href="https://developer.android.com/training/testing/espresso">Espresso -  Android Developers</a></li>
  <li><a href="https://developer.android.com/training/testing/ui-automator">UI Automator - Android Developers</a></li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-07-16T00:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html">July 16, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~2 minutes


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html" rel="bookmark" title="Firebase Test Labã§UI Testã‚’å®Ÿè¡Œã™ã‚‹" itemprop="url">Firebase Test Labã§UI Testã‚’å®Ÿè¡Œã™ã‚‹</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="ã“ã‚Œã¯ä½•">ã“ã‚Œã¯ä½•ï¼Ÿ</h2>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®UI Testã‚’CircleCIã‹ã‚‰å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ãŸè¨˜äº‹ã§ã™ã€‚
<a href="https://github.com/ryoyakawai/uitest_sample_android">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª</a>ã®UI Testã‚’èµ°ã‚‰ã›ã‚‹Firebase Test Labï¼ˆUI Testã‚’å®Ÿè¡Œã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ï¼‰ã«ã¤ã„ã¦è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚</p>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>
<h3 id="ciã®æµã‚Œã§ui-testãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€">Ciã®æµã‚Œã§UI TestãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€</h3>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®CIã®æµã‚Œã§ã¯ <strong>(3) UI Test</strong> ã§UI Testã‚’å®Ÿè¡Œã€
<strong>(4) Report</strong> ã§ãƒ¬ãƒãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™ã€‚</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-circleci_firebase_00.png" width="80%" />
</div>
<p>ã“ã“ã§ä½¿ã†ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>
<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/tree/master/app/src/test/java/com/example/uitestsample">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ãƒªãƒã‚¸ãƒˆãƒª</a></li>
  <li>UI Testã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼š<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">MainActivityInstrumentedTest.kt</a></li>
</ul>

<h3 id="ãƒã‚¤ãƒ³ãƒˆæ¡ä»¶ãªã©">ãƒã‚¤ãƒ³ãƒˆã€æ¡ä»¶ãªã©</h3>
<p>CIã§ä½¿ã†CircleCIã¯2.0ã‹ã‚‰Androidã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ããªããªã£ãŸã“ã¨ã‹ã‚‰ã€
CircleCIå˜ä½“ã§ã®UI Testã®å®Ÿè¡ŒãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚ï¼ˆ<a href="https://support.circleci.com/hc/en-us/articles/360000028928-Testing-with-Android-emulator-on-CircleCI-2-0">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ï¼‰
ã§ã™ã®ã§ã€UI Testã‚’å«ã‚ã‚‹ã¨ã™ã‚‹ã¨ã€Androidã‚¢ãƒ—ãƒªã®CIã¯å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒå¿…é ˆã¨ãªã£ã¦ã„ã¾ã™ã€‚</p>

<p>ä»Šå›ã¯<a href="https://support.circleci.com/hc/en-us/articles/360000028928-Testing-with-Android-emulator-on-CircleCI-2-0">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã«ã‚ªã‚¹ã‚¹ãƒ¡ã•ã‚Œã¦ã„ã‚‹
Firebase Test Labã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚</p>

<h3 id="firebase-test-labã¨ã¯">Firebase Test Labã¨ã¯</h3>
<p>Firebase Test Labã¯FirebaseãŒã®ã‚µãƒ¼ãƒ“ã‚¹ã®1ã¤ã¨ã—ã¦æä¾›ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ã§UI Testã‚’è¡Œã†ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚Android(Espressoã€UI Automator)ã€iOS(XCTest)ã§æ›¸ã‹ã‚ŒãŸãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚</p>

<p>ï¼ˆè©³ã—ãã¯ã€ŒAndroidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚ã€ã®<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html#aboutfirebasetestlab">Firebase Test Labã¨ã¯</a>ã‚’å¾¡è¦§ãã ã•ã„ã€‚ï¼‰</p>

<p><a href="https://firebase.google.com/docs/test-lab">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã¡ã‚‰</a>ã§ã™ã€‚</p>

<p>ãã‚Œã§ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç­‰ã®æº–å‚™ã‚’èª¬æ˜ã—ã¾ã™ã€‚</p>

<h4 id="æ–™é‡‘ä½“ç³»2019å¹´7æœˆç¾åœ¨">æ–™é‡‘ä½“ç³»ï¼ˆ2019å¹´7æœˆç¾åœ¨ï¼‰</h4>
<p>æ–™é‡‘ã¯ç„¡æ–™æ ãŒã€ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ5å›ã¾ã§ã€Virtualï¼ˆä»®æƒ³ï¼‰ãƒ‡ãƒã‚¤ã‚¹ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ10å›ã¾ã§ã€‚<br />
ç„¡æ–™æ ã‚’è¶…ãˆã‚‹ã¨ã€ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹1å°1æ™‚é–“$5ã€Virtualï¼ˆä»®æƒ³ï¼‰ãƒ‡ãƒã‚¤ã‚¹1å°1æ™‚é–“$1ã¨ãªã‚Šã¾ã™ã€‚
ã¾ãŸã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®ä¸Šé™ã‚‚ã‚ã‚Šã€ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ãŒ30åˆ†ã€Virtualï¼ˆä»®æƒ³ï¼‰ãƒ‡ãƒã‚¤ã‚¹ãŒ60åˆ†ã¨æ±ºã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã®ã§ã€
Firebase Test Labã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯ãã“ã«åã¾ã‚‹ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚<br />
ã“ã®æ™‚é–“ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã‚‚Virtualï¼ˆä»®æƒ³ï¼‰ãƒ‡ãƒã‚¤ã‚¹ã‚‚åŒã˜ã15åˆ†ã§è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<p><a href="https://firebase.google.com/pricing">è©³ç´°ã¯ã“ã“ã®Test Lab</a>ã®é …ç›®ã‚’å¾¡è¦§ãã ã•ã„ã€‚</p>

<h4 id="-firebaseã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™">ï¼ Firebaseã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™</h4>
<p><a href="https://console.firebase.google.com">console.firebase.google.com</a>ã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<h3 id="-gcpã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æº–å‚™">ï¼ GCPã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æº–å‚™</h3>
<p>Circle CIã‹ã‚‰ã¯ gcloud ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ Firebase Test Lab å®Ÿè¡Œã™ã‚‹ã®ã§ã€GCPã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚å¿…é ˆã¨ãªã‚Šã¾ã™ã€‚
ã¾ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å¿…è¦ã¨ãªã‚Šã¾ã™ã®ã§ä½œæˆã—ã¦ã„ãã¾ã™ã€‚</p>

<ul>
  <li><a href="https://console.cloud.google.com">console.firebase.google.com</a> ã‹ã‚‰GCPã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ</li>
  <li>GCPã® <a href="https://console.cloud.google.com/projectcreate">æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹</a></li>
  <li>å¼•ãç¶šãGCPã§ <a href="https://console.cloud.google.com/marketplace/details/google/testing.googleapis.com">Cloud Testing API</a>ã¨<a href="https://console.cloud.google.com/marketplace/details/google/toolresults.googleapis.com">Cloud Tool Results API</a> ã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼ˆä¸‹å›³å·¦ï¼šç”»é¢ä¸Šéƒ¨ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é¸æŠã‚’å¿˜ã‚Œãšã«ï¼ï¼‰</li>
  <li><a href="https://console.cloud.google.com">console.firebase.google.com</a> ã«æˆ»ã‚ŠGCPã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒªãƒ³ã‚¯ã™ã‚‹ã€‚ç”»åƒå†…ã®(1)ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã™ã‚‹ã€‚ï¼ˆä¸‹å›³å³ï¼‰</li>
</ul>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190717-gcp-activateapi-00.png" width="47%" style="margin-right:15px;border-radius:4px;border:1px solid #eeeeee" />
<img src="https://ryoyakawai.com/blog/images/2019/07/20190717-firebase-linkproject-00.png" width="47%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<p>ç¶šã„ã¦ã€gcloud ã‚³ãƒãƒ³ãƒ‰ã¯<a href="https://cloud.google.com/sdk/downloads">ã“ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã®é€šã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚<br />
æœ€å¾Œã«Androidã®Buildç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚<a href="https://developer.android.com/studio/install">Android Studioã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a>ã™ã‚‹ã®ãŒã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h3 id="-ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰å‹•ã‹ã—ã¦ã¿ã‚‹">ï¼ ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰å‹•ã‹ã—ã¦ã¿ã‚‹</h3>

<p>ã¾ãšã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡å®šã‚’è¡Œã„ã¾ã™ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§GCPã«ãƒ­ã‚°ã‚¤ãƒ³</span>
<span class="nv">$ </span>gcloud auth<span class="p">;</span>

<span class="c"># è¨­å®šå¯èƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªã‚¹ãƒˆã™ã‚‹</span>
<span class="nv">$ </span>gcloud projects list<span class="p">;</span>
PROJECT_ID                 NAME                   PROJECT_NUMBER
my-test-project-00-2xxxx5  My-Test-Project-00     6xxxx4xxxxx6

<span class="c"># ã€Œmy-test-project-00-24690ã€ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æŒ‡å®šã™ã‚‹</span>
<span class="nv">$ </span>gcloud config <span class="nb">set </span>project my-test-project-00-2xxxx5<span class="p">;</span>

<span class="c"># è¨­å®šå†…å®¹ã‚’ç¢ºèªã™ã‚‹(account, projectãŒæŒ‡å®šã—ãŸå†…å®¹ã§ã‚ã‚‹ã‹ç¢ºèª)</span>
<span class="nv">$ </span>gcloud config list<span class="p">;</span>
<span class="o">[</span>compute]
region <span class="o">=</span> us-central1
zone <span class="o">=</span> us-central1-c
<span class="o">[</span>core]
account <span class="o">=</span> xxxxx.xxxx.xxxx.xxxx@example.com
disable_usage_reporting <span class="o">=</span> True
project <span class="o">=</span> my-test-project-00-2xxxx5

Your active configuration is: <span class="o">[</span>default]
</code></pre></div></div>

<h3 id="-ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œã•ã›ã¦ã¿ã‚‹">ï¼ ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œã•ã›ã¦ã¿ã‚‹</h3>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ã‚³ãƒ¼ãƒ‰ã‚’Cloneã™ã‚‹</span>
<span class="nv">$ </span>git clone https://github.com/ryoyakawai/uitest_sample_android.git<span class="p">;</span>
<span class="nv">$ </span><span class="nb">cd </span>uitest_sample_android/<span class="p">;</span>

<span class="c"># Build</span>
<span class="c"># EmulatorãŒå‹•ä½œã—ã¦ã„ãªã„å ´åˆã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ãŒã€ä»¥ä¸‹ã®2ã¤ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ã€‚</span>
<span class="c"># - app/build/outputs/apk/debug/app-debug.apk</span>
<span class="c"># - app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk</span>
<span class="nv">$ </span>./gradlew connectedAndroidTest<span class="p">;</span>

<span class="c"># ç’°å¢ƒå¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹</span>
<span class="nv">$ GOOGLE_PROJECT_ID</span><span class="o">=</span><span class="s2">"my-test-project-00-2xxxx5"</span><span class="p">;</span>
<span class="nv">$ BK_OBJ_NAME</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">GOOGLE_PROJECT_ID</span><span class="k">}</span><span class="s2">/uitest-</span><span class="k">$(</span>date <span class="s2">"+%Y%m%d_%H%M"</span><span class="k">)</span><span class="s2">"</span><span class="p">;</span>

<span class="c"># ã‚³ãƒãƒ³ãƒ‰ã‚’æ”¹è¡Œã™ã‚‹ã¨ãã¯æœ«å°¾ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å¿˜ã‚Œãšã«å…¥ã‚Œã¦ãã ã•ã„ã€‚</span>
<span class="nv">$ </span>gcloud firebase <span class="nb">test </span>android run <span class="se">\</span>
 <span class="nt">--type</span> instrumentation <span class="se">\</span>
 <span class="nt">--app</span> ./app/build/outputs/apk/debug/app-debug.apk <span class="se">\</span>
 <span class="nt">--test</span> ./app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk <span class="se">\</span>
 <span class="nt">--test-targets</span> <span class="s2">"class com.example.uitestsample.MainActivityInstrumentedTest"</span> <span class="se">\</span>
 <span class="nt">--results-dir</span> <span class="nv">$BK_OBJ_NAME</span> <span class="se">\</span>
 <span class="nt">--results-bucket</span> cloud-test-<span class="k">${</span><span class="nv">GOOGLE_PROJECT_ID</span><span class="k">}</span> <span class="se">\</span>
 <span class="nt">--directories-to-pull</span> /sdcard/uitest/ <span class="se">\</span>
 <span class="nt">--device</span> <span class="nv">model</span><span class="o">=</span>Pixel2,version<span class="o">=</span>26,locale<span class="o">=</span>en_US,orientation<span class="o">=</span>portrait <span class="se">\</span>
 <span class="nt">--use-orchestrator</span> <span class="se">\</span>
 <span class="nt">--timeout</span> 120s<span class="p">;</span>

<span class="c"># ç„¡äº‹ã«é–‹å§‹ã•ã‚Œã‚‹ã¨ä»¥ä¸‹ãŒå‡ºåŠ›ã•ã‚‹</span>
Have questions, feedback, or issues? Get support by visiting:
  https://firebase.google.com/support/

Uploading <span class="o">[</span>./app/build/outputs/apk/debug/app-debug.apk] to Firebase Test Lab...
Uploading <span class="o">[</span>./app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk] to Firebase Test Lab...
Raw results will be stored <span class="k">in </span>your GCS bucket at <span class="o">[</span>https://console.developers.google.com/storage/browser/cloud-test-my-test-project-00-2xxxx5/my-test-project-00-2xxxx5/uitest-20190716_1603/]

Test <span class="o">[</span>matrix-1gpbgxrsx8fag] has been created <span class="k">in </span>the Google Cloud.
Firebase Test Lab will execute your instrumentation <span class="nb">test </span>on 1 device<span class="o">(</span>s<span class="o">)</span><span class="nb">.</span>
Creating individual <span class="nb">test </span>executions...done.

Test results will be streamed to <span class="o">[</span>https://console.firebase.google.com/project/my-test-project-00-2xxxx5/testlab/histories/bh.xxxxxxxxxxxx/matrices/8xxxxxxxxxxxx11].
16:17:55 Test is Pending
16:18:23 Starting attempt 1.
16:18:23 Test is Running
16:19:17 Started logcat recording.
16:19:17 Preparing device.
16:19:52 Logging <span class="k">in </span>to Google account on device.
16:19:52 Installing apps.
16:20:06 Retrieving Pre-Test Package Stats information from the device.
16:20:06 Retrieving Performance Environment information from the device.
16:20:06 Started crash detection.
16:20:06 Started crash monitoring.
16:20:06 Started performance monitoring.
16:20:19 Started video recording.
16:20:19 Starting instrumentation test.
16:20:53 Completed instrumentation test.
16:21:07 Stopped performance monitoring.
16:21:14 Stopped crash monitoring.
16:21:14 Stopped logcat recording.
16:21:14 Retrieving Post-test Package Stats information from the device.
16:21:14 Logging out of Google account on device.
16:21:21 Done. Test <span class="nb">time</span> <span class="o">=</span> 36 <span class="o">(</span>secs<span class="o">)</span>
16:21:21 Starting results processing. Attempt: 1
16:21:28 Completed results processing. Time taken <span class="o">=</span> 6 <span class="o">(</span>secs<span class="o">)</span>
16:21:28 Test is Finished

Instrumentation testing complete.

More details are available at <span class="o">[</span>https://console.firebase.google.com/project/my-test-project-00-2xxxx5/testlab/histories/bh.xxxxxxxxxxxx/matrices/8xxxxxxxxxxxx11].
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OUTCOME â”‚     TEST_AXIS_VALUE      â”‚     TEST_DETAILS    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Passed  â”‚ Pixel2-26-en_US-portrait â”‚ 3 <span class="nb">test </span>cases passed â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre></div></div>

<p>ã‚³ãƒãƒ³ãƒ‰ã«å‡ºåŠ›ã•ã‚Œã‚‹Firebaseã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨çµæœãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®1è¡Œã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä¸‹å›³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Test results will be streamed to <span class="o">[</span>https://console.firebase.google.com/project/my-test-project-00-2xxxx5/testlab/histories/bh.xxxxxxxxxxxx/matrices/8xxxxxxxxxxxx11]
</code></pre></div></div>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190717-firebase-result-00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<p>é™æ­¢ç”»ã€å‹•ç”»ã‚’ä¸€è¦§ã§è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ãƒ†ã‚¹ãƒˆã§ä½•ãŒã•ã‚Œã¦ã„ãŸã‹ã‚‚å¾Œã‹ã‚‰ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
ã¡ãªã¿ã«ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‹•ç”»ã¯æ’®å½±ã—ã¦ãã‚Œã‚‹è¨­å®šã«ãªã£ã¦ã„ã¾ã™ãŒã€é™æ­¢ç”»ã«é–¢ã—ã¦ã¯è‡ªå‰ã§æ’®å½±ã™ã‚‹å‡¦ç†ã‚’æ›¸ãã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ±ºã‚ã¦ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã«åŸ‹ã‚è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®é™æ­¢ç”»ã‚‚è‡ªå‰ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã®<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/uitestutils/UiTestUtils.kt">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®UiTestUtils</a>ã«å«ã‚“ã§ã„ã¾ã™ã®ã§è©¦ã—ã¦ã¿ãŸã„å ´åˆã¯åˆ©ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</p>

<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>CIã®æµã‚Œã®ä¸­ã§ã¯ã‚‚ã¡ã‚ã‚“ã€ã¾ãŸã€Œæ—¥ã€…ã®é–‹ç™ºã¨ä¸¦è¡Œã—ã¦ãƒ†ã‚¹ãƒˆã—ãŸã„å ´åˆã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ç’°å¢ƒã‚’ç”¨æ„ã™ã‚‹ã€ã“ã¨ã¯ã‚³ã‚¹ãƒˆçš„ã«å³ã—ã‹ã£ãŸã‚Šã€
ã€Œä»–ç«¯æœ«ã®å®Ÿãƒ‡ãƒã‚¤ã‚¹ã‚’ä½¿ã£ã¦ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‚’å‹•ã‹ã—ã¦ã¿ãŸã„ã€ã¨ã„ã†ã®ã‚‚åŒã˜ãã‚³ã‚¹ãƒˆçš„ã«å³ã—ã„ã“ã¨ãŒå°‘ãªããªã„ã¨æ€ã„ã¾ã™ã€‚
å…¨ã¦ã¯ç„¡ç†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãã‚“ãªã¨ãã«å¿ƒé…ã®å¡Šã®1éƒ¨ã ã‘ã§ã‚‚å–ã‚Šé™¤ãã¹ãFirebase Test Labã‚’ä½¿ã†ã€ã¨ã„ã†ã®ã‚‚ã¨ã¦ã‚‚æœ‰åŠ¹ã ã¨æ€ã„ã¾ã™ã€‚<br />
æ°—ã«ãªã£ã¦ã„ã‚‹æ–¹ã¯ä½¿ã£ã¦ã¿ã¦ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ</p>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://firebase.google.com/docs/test-lab/android/command-line">Get started with Firebase Test Lab from the gcloud Command Line</a></li>
  <li><a href="https://cloud.google.com/sdk/gcloud/reference/firebase/test/android/run">gcloud firebase test android run(Cloud SDK:Google Cloud)</a></li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-07-10T00:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/07/10/ci-android-unittest-00.html">July 10, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/07/10/ci-android-unittest-00.html" rel="bookmark" title="Androidã‚¢ãƒ—ãƒªã§ã®Unit Testã«ã¤ã„ã¦ã®è§£èª¬" itemprop="url">Androidã‚¢ãƒ—ãƒªã§ã®Unit Testã«ã¤ã„ã¦ã®è§£èª¬</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="ã“ã‚Œã¯ä½•">ã“ã‚Œã¯ä½•ï¼Ÿ</h2>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®Unit Testã‚’èª¬æ˜ã—ãŸè¨˜äº‹ã§ã™ã€‚
<a href="https://github.com/ryoyakawai/uitest_sample_android">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª</a>ã®Unit Testã«ã¤ã„ã¦è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚</p>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>
<h3 id="ciã®æµã‚Œã§unit-testãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€">CIã®æµã‚Œã§Unit TestãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€</h3>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®CIã®æµã‚Œã§ã¯ <strong>(2) Build</strong> ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-circleci_firebase_00.png" width="80%" />
</div>
<p>ã“ã“ã§ä½¿ã†ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>
<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/tree/master/app/src/test/java/com/example/uitestsample">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ãƒªãƒã‚¸ãƒˆãƒª</a></li>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/test/java/com/example/uitestsample/MainActivityUnitTest.kt">Unit Testã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</a></li>
</ul>

<p><a href="https://developer.android.com/training/testing/unit-testing/local-unit-tests">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã‚Œ</a>ã§ã™ã€‚</p>

<h3 id="ãƒã‚¤ãƒ³ãƒˆæ¡ä»¶ãªã©">ãƒã‚¤ãƒ³ãƒˆã€æ¡ä»¶ãªã©</h3>
<p><a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html#aboutunittest">Unit Testã«ã¤ã„ã¦ï¼ˆAndroidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚ï¼‰</a>ã«ã‚‚æ›¸ã„ã¦ã„ã¾ã™ãŒãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã§ã™ã€‚</p>
<ul>
  <li>MVPï¼ˆModel-View-Presenterï¼‰ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«å¯¾ã—ã¦ã®Unit Testã‚’å®Ÿè¡Œã™ã‚‹</li>
  <li><a href="https://junit.org/junit4/">JUnit</a>ã‚’ä½¿ã£ã¦Unit Testã‚’å®Ÿè¡Œã™ã‚‹</li>
  <li><a href="https://site.mockito.org/">Mockito</a>ã§Viewã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹</li>
  <li>HTTPã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹</li>
  <li>ãƒ†ã‚¹ãƒˆã™ã‚‹å ´æ‰€ã¯ä»¥ä¸‹ã®å›³ã® <strong>Point for Unit Testing</strong></li>
</ul>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-mvp-diagram-00.png" width="90%" />
</div>

<p>ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯MVPã«é™ã£ã¦ã„ã‚‹è¨³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€Interfaceã‚’å®šç¾©ã—ã¦ã„ã‚‹ã¨ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã®ãŒæ¥½ã«ãªã‚‹ã“ã¨ã‹ã‚‰
ã“ã“ã§ã¯MVPã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚</p>

<h3 id="ãƒ†ã‚¹ãƒˆã®ã‚·ãƒŠãƒªã‚ª">ãƒ†ã‚¹ãƒˆã®ã‚·ãƒŠãƒªã‚ª</h3>
<p>ã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½ã¨ã—ã¦ã¯ç„¡é§„ã«å®Ÿè£…ã•ã‚ŒãŸ<a href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a>
ã®REST APIã«æ¥ç¶šã‚’ã—ã¦JSONã‚’å–å¾—ã—ã€Viewã«åæ˜ ã•ã›ã‚‹éƒ¨åˆ†ã®å‹•ä½œã«é–¢ã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã™ã€‚<br />
å…·ä½“çš„ã«èª¬æ˜ã™ã‚‹ã¨ä¸Šå›³ã® <strong>Data Interaction</strong> ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦JSONã‚’å›ºå®šã—ã€<strong>UI Behavior</strong> ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦
æŒ‡å®šã•ã‚Œã¦ã„ã‚‹æŒ¯ã‚‹èˆã„ã‚’è¡Œã†ã‹ã€ã‚’ç¢ºèªã—ã¾ã™ã€‚
<br />
ã‚ˆã£ã¦ã€ä»Šå›ã¯ã“ã®ã‚·ãƒŠãƒªã‚ªã‚’ç¢ºèªã™ã‚‹ç‚ºã«ä»¥ä¸‹ã®2ã¤ã®ãƒ†ã‚¹ãƒˆã®ã‚±ãƒ¼ã‚¹ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚</p>
<ul>
  <li>HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰200ã§JSONã‚’æ­£ã—ãå—ã‘å–ã£ãŸå ´åˆã®å€¤ã®ç¢ºèªã¨Viewã«å¯¾ã™ã‚‹å‹•ä½œç¢ºèª</li>
  <li>HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰500ã‚’å—ã‘å–ã£ãŸå ´åˆã®Viewã«å¯¾ã™ã‚‹å‹•ä½œç¢ºèª</li>
</ul>

<h3 id="æº–å‚™">æº–å‚™</h3>
<p><code class="highlighter-rouge">build.gradle</code>ã«è¿½è¨˜ã€<code class="highlighter-rouge">org.mockito.plugins.MockMaker</code> ã®ä½œæˆã®2ã¤ãŒå¿…è¦ã§ã™ã€‚</p>

<h4 id="-buildgradleã«è¿½è¨˜">ï¼ <code class="highlighter-rouge">build.gradle</code>ã«è¿½è¨˜</h4>
<p><code class="highlighter-rouge">app/build.gradle</code> ã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¾ã™ã€‚</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="n">dependencies</span> <span class="p">{</span>
<span class="o">....</span>
    <span class="c1">// Unit and UI Test
</span>    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">junit</span><span class="p">:</span><span class="n">junit</span><span class="p">:</span><span class="m">4.12</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="s">"org.jetbrains.kotlin:kotlin-reflect:$kotlin_version"</span>
    <span class="n">testImplementation</span> <span class="s">"com.android.support:support-annotations:${android.defaultConfig.targetSdkVersion}"</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">org</span><span class="p">.</span><span class="n">robolectric</span><span class="p">:</span><span class="n">robolectric</span><span class="p">:</span><span class="m">4.0</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">nhaarman</span><span class="p">:</span><span class="n">mockito</span><span class="p">-</span><span class="n">kotlin</span><span class="p">-</span><span class="n">kt1</span><span class="p">.</span><span class="m">1</span><span class="p">:</span><span class="m">1.5</span><span class="p">.</span><span class="m">0</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">squareup</span><span class="p">.</span><span class="n">retrofit2</span><span class="p">:</span><span class="n">converter</span><span class="p">-</span><span class="n">moshi</span><span class="p">:</span><span class="m">2.2</span><span class="p">.</span><span class="m">0</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">squareup</span><span class="p">.</span><span class="n">retrofit2</span><span class="p">:</span><span class="n">retrofit</span><span class="p">-</span><span class="n">mock</span><span class="p">:</span><span class="m">2.3</span><span class="p">.</span><span class="m">0</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">squareup</span><span class="p">.</span><span class="n">okhttp3</span><span class="p">:</span><span class="n">mockwebserver</span><span class="p">:</span><span class="m">3.10</span><span class="p">.</span><span class="m">0</span><span class="err">'</span>
<span class="o">....</span>
<span class="p">}</span>
<span class="o">....</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">build.gradle</code> ã«ä»¥ä¸‹ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå‰æã§ã™ã€‚</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="n">buildscript</span> <span class="p">{</span>
<span class="o">....</span>
    <span class="n">ext</span><span class="p">.</span><span class="n">kotlin_version</span> <span class="p">=</span> <span class="err">'</span><span class="m">1.3</span><span class="p">.</span><span class="m">31</span><span class="err">'</span>
<span class="o">....</span>
<span class="p">}</span>
<span class="o">....</span>
</code></pre></div></div>

<h4 id="-orgmockitopluginsmockmaker-ã‚’ä½œæˆ">ï¼ <code class="highlighter-rouge">org.mockito.plugins.MockMaker</code> ã‚’ä½œæˆ</h4>
<p><code class="highlighter-rouge">app/src/test/resources/mockito-extensions/org.mockito.plugins.MockMaker</code> ã‚’æ–°è¦ã§ä½œæˆã—ã¦ã€ä»¥ä¸‹ã®1è¡Œã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mock-maker-inline
</code></pre></div></div>

<h3 id="unit-testã‚’æ›¸ã">Unit Testã‚’æ›¸ã</h3>

<h4 id="-rest-apiã‚’ãƒ¢ãƒƒã‚¯ã—ã¦å‡ºåŠ›ã‚’å›ºå®šã™ã‚‹">ï¼ REST APIã‚’ãƒ¢ãƒƒã‚¯ã—ã¦å‡ºåŠ›ã‚’å›ºå®šã™ã‚‹</h4>
<p><strong>Data Interaction</strong> ã®éƒ¨åˆ†ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦å‡ºåŠ›ã‚’å›ºå®šã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯<a href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a>ã®REST APIã®å‡ºåŠ›ã‚’å›ºå®šã™ã‚‹ç‚ºã«
HTTPã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ<a href="https://square.github.io/okhttp/">OkHttp</a>ã‚’ãƒ¢ãƒƒã‚¯ã—ã¾ã™ã€‚
æ‰±ã„ã‚„ã™ã„ã‚ˆã†ã«ã€ <strong>Unit Testæœ¬ä½“</strong> ã¨ã€ <strong>ãƒ¢ãƒƒã‚¯</strong> ã‚’1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã¡ã‚ƒã£ã¦ã„ã¾ã™ã€‚</p>

<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/test/java/com/example/uitestsample/MainActivityUnitTest.kt">MainActivityUnitTest.kt</a></li>
</ul>

<p><code class="highlighter-rouge">MockServerDispatcher</code>ã®ã‚¯ãƒ©ã‚¹ãŒãã‚Œã«ãªã‚Šã¾ã™ã€‚<br />
ã“ã“ã§ã¯ã€<code class="highlighter-rouge">Resp200</code>ã€<code class="highlighter-rouge">Resp400</code>ã€<code class="highlighter-rouge">Resp500</code> ã®3ã¤ã®Classã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®ç”¨ã«å‡ºåŠ›ã‚’å›ºå®šã—ã¾ã™ã€‚</p>

<ul>
  <li><code class="highlighter-rouge">Resp200</code>ï¼šæ­£å¸¸ç³»ã®å ´åˆã§ã€JSONã‚’è¿”ã™</li>
  <li><code class="highlighter-rouge">Resp400</code>ï¼šç•°å¸¸ç³»ã§ã€HTTP Statusã®400ã‚’è¿”ã™</li>
  <li><code class="highlighter-rouge">Resp500</code>ï¼šç•°å¸¸ç³»ã§ã€HTTP Statusã®500ã‚’è¿”ã™</li>
</ul>

<h4 id="-unit-testã‚’æ›¸ã">ï¼ Unit Testã‚’æ›¸ã</h4>
<p>2ã¤ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ã†ã¡ã®ã€ŒHTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰200ã§JSONã‚’æ­£ã—ãå—ã‘å–ã£ãŸå ´åˆã®å€¤ã®ç¢ºèªã¨Viewã«å¯¾ã™ã‚‹å‹•ä½œã®ç¢ºèªã€
ã®èª¬æ˜ã‚’ã€ä»¥ä¸‹ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§è¡Œã„ã¾ã™ã€‚ã€‚
ä»¥ä¸‹ã¯ã€</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MainActivityUnitTest</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">mMockTestUtils</span> <span class="p">=</span> <span class="n">UnitTestUtils</span><span class="p">()</span>

    <span class="n">@Test</span>
    <span class="k">fun</span> <span class="nf">sampleUnitDataFetchSuccessTest</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// vvv æ­£å¸¸ç³»ã§JSONã‚’è¿”ã™ã‚ˆã†æŒ‡å®š
</span>        <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">mockServerBehaviorSwitcher</span> <span class="p">=</span> <span class="p">{</span>
            <span class="n">MockServerDispatcher</span><span class="p">().</span><span class="n">Resp200</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="kd">val</span> <span class="py">expectedResponse</span> <span class="p">=</span> <span class="n">MockServerDispatcher</span><span class="p">().</span><span class="n">mockedResponse</span>

        <span class="kd">var</span> <span class="py">mMainActivityPresenter</span> <span class="p">=</span> <span class="n">MainActivityPresenter</span><span class="p">()</span>
        <span class="c1">// vvv Viewã«å¯¾ã™ã‚‹å‹•ä½œã®ç¢ºèªã®ç‚ºã«MainActivityViewContract()ã®Classã‚’ãƒ¢ãƒƒã‚¯
</span>        <span class="kd">var</span> <span class="py">mMainActivityViewContract</span> <span class="p">=</span> <span class="n">mock</span><span class="p">&lt;</span><span class="n">MainActivityViewContract</span><span class="p">&gt;()</span>

        <span class="c1">// vvv Presentorã«ãƒ¢ãƒƒã‚¯ã—ãŸMainActivityViewContract()ã‚’å©ã‹ã›ã‚‹ã‚ˆã†ã«ã‚»ãƒƒãƒˆ
</span>        <span class="n">mMainActivityPresenter</span><span class="p">.</span><span class="n">setView</span><span class="p">(</span><span class="n">mMainActivityViewContract</span><span class="p">)</span>

        <span class="c1">// vvv éåŒæœŸã§ã®å‡¦ç†ã‚’åŒæœŸã§å‹•ä½œã•ã›ã‚‹ã‚ˆã†ã«å¤‰æ›´
</span>        <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">prepareRxForTesting</span><span class="p">()</span>

        <span class="c1">// vvv ã“ã“ã§Mockã—ãŸã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹
</span>        <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">startMockServer</span><span class="p">()</span>

        <span class="c1">// vvv ä»¥ä¸‹ã®2è¡Œã§ã€ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®æ¥ç¶šå…ˆã‚’Mockã—ãŸã‚µãƒ¼ãƒã«å…¥ã‚Œæ›¿ãˆã‚‹
</span>        <span class="kd">var</span> <span class="py">mApiConnection</span> <span class="p">=</span> <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">setupMockServer</span><span class="p">()</span>
        <span class="n">setConnection</span><span class="p">(</span><span class="n">mApiConnection</span><span class="p">)</span>

        <span class="c1">// vvv Presenterã®Methodã‚’å©ã„ã¦ã€å‹•ä½œã•ã›ã‚‹
</span>        <span class="n">mMainActivityPresenter</span><span class="p">.</span><span class="n">getJsonSampleResponse</span><span class="p">()</span>
        <span class="c1">// vvv MainActivityViewContractã®handleSuccess()ãŒå©ã‹ã‚Œã‚Œã€
</span>        <span class="c1">// å›ºå®šã—ãŸãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰ã®å–å¾—ãŒã§ãã¦ã„ã‚‹ã‹ã‚’ç¢ºèª
</span>        <span class="n">argumentCaptor</span><span class="p">&lt;</span><span class="n">Array</span><span class="p">&lt;</span><span class="n">SinglePostResponse</span><span class="p">&gt;&gt;().</span><span class="n">apply</span> <span class="p">{</span>
            <span class="n">verify</span><span class="p">(</span><span class="n">mMainActivityViewContract</span><span class="p">,</span> <span class="n">times</span><span class="p">(</span><span class="m">1</span><span class="p">)).</span><span class="n">handleSuccess</span><span class="p">(</span><span class="n">capture</span><span class="p">())</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">0</span> <span class="n">until</span> <span class="n">expectedResponse</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">expected</span> <span class="p">=</span> <span class="n">expectedResponse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="kd">val</span> <span class="py">actual</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">firstValue</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">assertDataClass</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="p">}</span>
        <span class="c1">// vvv ã“ã“ã§Mockã—ãŸã‚µãƒ¼ãƒã‚’åœæ­¢
</span>        <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">shutdownMockServer</span><span class="p">()</span>
    <span class="p">}</span>
<span class="o">....</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="å®Ÿè¡Œã—ã¦ã¿ã‚‹">å®Ÿè¡Œã—ã¦ã¿ã‚‹</h3>
<p>å®Ÿè¡Œæ–¹æ³•ã«ã¯ã€Œã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã€ã€ã¾ãŸã€ŒAndroid Studioã‹ã‚‰ã€ã®2ã¤ãŒã‚ã‚Šã¾ã™ã€‚</p>

<h4 id="-ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰å®Ÿè¡Œ">&gt; ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰å®Ÿè¡Œ</h4>

<p>Unit Testã®å…¨ã¦ã‚’å®Ÿè¡Œã™ã‚‹</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./gradlew testDebugUnitTest<span class="p">;</span>
</code></pre></div></div>

<p>æŒ‡å®šã—ãŸClassã€Methodã®Unit Testã‚’å®Ÿè¡Œã‚‹</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Classã‚’æŒ‡å®š
// <span class="nt">--tests</span> ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ <span class="o">[</span>Package Name].[Class Name] ã‚’æŒ‡å®š
<span class="nv">$ </span>./gradlew testDebugUnitTest <span class="nt">--tests</span> com.example.uitestsample.MainActivityUnitTest<span class="p">;</span>

// Classã¨Methodã‚’æŒ‡å®š
// <span class="nt">--tests</span> ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ <span class="o">[</span>Package Name].[Class Name].[Method Name] ã‚’æŒ‡å®š
<span class="nv">$ </span>./gradlew testDebugUnitTest <span class="nt">--tests</span> com.example.uitestsample.MainActivityUnitTest.sampleUnitDataFetchSuccessTest<span class="p">;</span>
</code></pre></div></div>

<h4 id="-android-studioã‹ã‚‰">&gt; Android Studioã‹ã‚‰</h4>
<p><code class="highlighter-rouge">@Test</code>ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚’æ›¸ãã¨Testã¨ã—ã¦èªè­˜ã•ã‚Œã¾ã™ã€‚
ã™ã‚‹ã¨Android Studioã ã¨ä¸‹å›³ã®èµ¤ä¸¸ã®ã‚ˆã†ã«ã€ãã®å·¦å´ã« <span style="color:green">â–¶ï¸</span>ï¼ˆå†ç”Ÿãƒãƒ¼ã‚¯ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€
ãã‚Œã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190710-unittest-androidstudio-00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>ã€ŒCloneã—ãŸã‚‰ã™ãã«è©¦ã›ã‚‹ã€ã‚’ç›®æ¨™ã«æ›¸ãã¾ã—ãŸã®ã§ã€èˆˆå‘³ã‚’æŒãŸã‚ŒãŸæ–¹ã¯è©¦ã—ã¦ã¿ã¦ã„ãŸã ãˆã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚<br />
é–“é•ã£ã¦ã‚‹ï¼ã¨ã‹ã‚ã‚Šã¾ã—ãŸã‚‰PRã€ã¾ãŸã”æŒ‡æ‘˜ãã ã•ã„ã€‚</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-07-03T00:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">July 03, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~4 minutes


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html" rel="bookmark" title="Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚" itemprop="url">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="ã“ã‚Œã¯ä½•">ã“ã‚Œã¯ä½•ï¼Ÿ</h2>
<p>Androidã‚¢ãƒ—ãƒªã®CIï¼ˆç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰ç’°å¢ƒã‚’ä½œã£ã¦é‹ç”¨ã‚’ã—ãŸã¨ãã®çµŒé¨“ã‚’æ›¸ãå‡ºã—ãŸã‚‚ã®ã§ã™ã€‚
2019å¹´7æœˆæ™‚ç‚¹ã§ã®ã‚‚ã®ã«ãªã‚Šã¾ã™ã®ã§ã€æ™‚é–“çµŒéã«ã‚ˆã£ã¦ã¯å‹•ä½œã—ãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚Šã¾ã™ã®ã§äºˆã‚ã”äº†æ‰¿ãã ã•ã„ã€‚</p>

<h4 id="æ›´æ–°å±¥æ­´">æ›´æ–°å±¥æ­´</h4>

<ul>
  <li>2019/7/18 é–¢é€£è¨˜äº‹ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-espresso-00.html">Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã</a>ã€ã‚’å…¬é–‹</li>
  <li>2019/7/16 é–¢é€£è¨˜äº‹ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html">Firebase Test Labã§UI Testã‚’å®Ÿè¡Œã™ã‚‹</a>ã€ã‚’å…¬é–‹</li>
  <li>2019/7/12 é–¢é€£è¨˜äº‹ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/10/ci-android-unittest-00.html">Androidã‚¢ãƒ—ãƒªã§ã®Unit Testã«ã¤ã„ã¦ã®è§£èª¬</a>ã€ã‚’å…¬é–‹</li>
  <li>2019/7/7 DeployGateã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰ã®é…ä¿¡ã‚’è¿½è¨˜</li>
  <li>2019/7/6 å…¬é–‹</li>
</ul>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>
<p>Androidã‚¢ãƒ—ãƒªã®GitHubã¸ã®Pushã‹ã‚‰ã€CircleCIã§ãƒ“ãƒ«ãƒ‰ã€å˜ä½“ãƒ†ã‚¹ãƒˆã€UIãƒ†ã‚¹ãƒˆï¼ˆUI Animator &amp; Espresso on Firebase Test Labï¼‰ã€
ãã—ã¦DeployGateã¸ã‚¢ãƒ—ãƒªã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€ã¾ã§ã®ä¸€é€£ã®æµã‚Œã®é››å½¢ã®ã‚ˆã†ãªã‚‚ã®ã ã¨è€ƒãˆã¦ãã ã•ã„ã€‚<br />
ã¾ãŸè¨˜äº‹ã®å†…å®¹ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†å‰²ã—ã¦æ›¸ã„ã¦ã„ãäºˆå®šã§ã™ã€‚</p>
<ul>
  <li>ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€è©³ç´°ã¯ã¯ã¨ã‚‚ã‚ã‚Œã€CircleCIã§CIã‚’å›ã—ã¦ã¿ã‚‹</li>
  <li><a href="https://ryoyakawai.com/blog/2019/07/10/ci-android-unittest-00.html">Androidã‚¢ãƒ—ãƒªã§ã®Unit Testã«ã¤ã„ã¦ã®è§£èª¬</a></li>
  <li><a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-espresso-00.html">Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã</a></li>
  <li><a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html">Firebase Test Labã§UI Testã‚’å®Ÿè¡Œã™ã‚‹</a></li>
</ul>

<p>ã“ã®è¨˜äº‹ã¯ã€Œãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã€è©³ç´°ã¯ã¯ã¨ã‚‚ã‚ã‚Œã€CircleCIã§CIã‚’å›ã—ã¦ã¿ã‚‹ã€ã«ã¤ã„ã¦ã¨ãªã‚Šã¾ã™ã€‚<br />
å‹•ä½œã«å¿…é ˆãªè¨­å®šç­‰ã®èª¬æ˜ã‚’ã—ã¦ã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼ˆæ‰‹å…ƒã®PCï¼‰ã‹ã‚‰ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦æ‰‹å‹•ã§å‹•ä½œã•ã›æ­£å¸¸ã«å‹•ä½œã™ã‚‹ã‹ã™ã‹ã®ç¢ºèªã‚’è¡Œã„ã€
ãã®å¾Œã«ä¸€é€£ã®ãƒ“ãƒ«ãƒ‰ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’CircleCIã§å‹•ã‹ã™ã€ã¨ã„ã†ã®æµã‚Œã§èª¬æ˜ã—ã¾ã™ã€‚</p>

<h2 id="ãƒ“ãƒ«ãƒ‰ã®æµã‚Œã¨ã‚¤ãƒ³ãƒ•ãƒ©">ãƒ“ãƒ«ãƒ‰ã®æµã‚Œã¨ã‚¤ãƒ³ãƒ•ãƒ©</h2>
<p>ä»¥ä¸‹ã®å›³ã®æµã‚Œã§ãƒ“ãƒ«ãƒ‰ã‹ã‚‰ãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§è¡Œã„ã¾ã™ã€‚</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-circleci_firebase_00.png" width="80%" />
</div>

<ol>
  <li>é–‹ç™ºè€…ãŒGitHubã«ã‚³ãƒ¼ãƒ‰ã‚’Commitã—Pushã™ã‚‹</li>
  <li>CircleCIã§ãƒ“ãƒ«ãƒ‰ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒé–‹å§‹ã•ã‚Œã€Unitãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹</li>
  <li>UIãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®ç‚ºã€CicleCIãŒFirebaseã«å‘ã‘ã¦ã‚¢ãƒ—ãƒªã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’é…ä¿¡ã—UIãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹</li>
  <li>Firebase Test Labã§UIãƒ†ã‚¹ãƒˆãŒå®Ÿè¡ŒãŒå®Œäº†ã—ãŸã‚‰ãƒ¬ãƒãƒ¼ãƒˆã‚’CircleCIã«é…ä¿¡ã™ã‚‹</li>
  <li>DeployGateã«å‘ã‘ã¦ã‚¢ãƒ—ãƒªã‚’é…ä¿¡ã™ã‚‹</li>
</ol>

<h3 id="åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©">åˆ©ç”¨ã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©</h3>
<p>ä¸Šè¨˜ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ç‚ºã«ã€ä»¥ä¸‹ã®ã‚¤ãƒ³ãƒ•ãƒ©ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ãŠãªã˜ã¿ã®åå‰ã°ã‹ã‚Šã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒãƒ»ãƒ»ãƒ»</p>
<ul>
  <li>
    <p style="font-weight:bold;margin:0;"><a href="https://github.com">GitHub</a></p>
    <p>Gitã§æ“ä½œã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’æä¾›ã™ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹</p>
  </li>
  <li>
    <p style="font-weight:bold;margin:0;"><a href="https://circleci.com/">CircleCI</a></p>
    <p>CIã‚’è¡Œã£ã¦ãã‚Œã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹</p>
  </li>
  <li>
    <p style="font-weight:bold;margin:0;"><a href="https://console.firebase.google.com/">Firebase Test Lab</a></p>
    <p>Googleç¤¾ãŒæä¾›ã™ã‚‹mBaaSãŒæä¾›ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®1ã¤ã§ã€UIãƒ†ã‚¹ãƒˆï¼ˆEspressoã€UI Automator 2.0ã€XCTestï¼‰ã‚’ã‚¯ãƒ©ã‚¦ãƒ‰ã§è¡Œã†ã‚µãƒ¼ãƒ“ã‚¹</p>
  </li>
  <li>
    <p style="font-weight:bold;margin:0;"><a href="https://deploygate.com/">Deploy Gate</a></p>
    <p>ã‚¹ãƒˆã‚¢ï¼ˆGoogle Playã€App Storeï¼‰ã‚’é€šã•ãªã„ã‚¢ãƒ—ãƒªé…å¸ƒã‚’å®Ÿç¾ã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆãƒ™ãƒ¼ã‚¿ãƒ†ã‚¹ãƒˆç­‰ã«åˆ©ç”¨ã§ãã‚‹ï¼‰</p>
  </li>
</ul>

<h3 id="ä»Šå›åˆ©ç”¨ã™ã‚‹androidã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª">ä»Šå›åˆ©ç”¨ã™ã‚‹Androidã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª</h3>

<h4 id="-ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰">ï¼ ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ã‚³ãƒ¼ãƒ‰</h4>
<p>Unit Testã€UI Testã‚’è¡Œã†ç‚ºã«å¼·å¼•ã«å®Ÿè£…ã—ã¦ã„ã‚‹éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚</p>

<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android">UI Test Sample App</a></li>
</ul>

<h4 id="-æ©Ÿèƒ½ã®èª¬æ˜">ï¼ æ©Ÿèƒ½ã®èª¬æ˜</h4>
<p>ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>

<ul>
  <li>ç”»é¢å³ä¸‹ã®èµ¤è‰²ã®Fabã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ãƒ‡ãƒã‚¤ã‚¹ã¸ã®ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ã®è¨±å¯ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ã€‚</li>
  <li>ãƒ‡ãƒã‚¤ã‚¹ã¸ã®ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿ã®è¨±å¯ã®çŠ¶æ…‹ã«é–¢ä¿‚ãªãã€ç”»é¢ä¸­å¤®ã®æ–‡å­—åˆ—ã€ŒHello World!!ã€ãŒã€Œ1ã€ã«å¤‰åŒ–ã™ã‚‹</li>
  <li>æ›´ã«ã€ç”»é¢å³ä¸‹ã®èµ¤è‰²ã®Fabã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ã‚¿ãƒƒãƒ—æ¯ã«1ã¤ã¥ã¤ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã•ã‚ŒãŸæ•°å­—ãŒè¡¨ç¤ºã•ã‚Œã‚‹</li>
  <li>ç”»é¢å³ä¸Šã®3ç‚¹ãƒªãƒ¼ãƒ€ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã€ŒReset Counterã€ã®ãƒœã‚¿ãƒ³ãŒå‡ºç¾ã—ã€ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨ã‚«ã‚¦ãƒ³ã‚¿ãŒã€Œ0ã€ã«å¤‰åŒ–ã™ã‚‹</li>
</ul>

<p>ã“ã‚“ãªâ†“å‹•ä½œã‚’ã™ã‚‹ã‚¢ãƒ—ãƒªã§ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-uitestsampleapp_00.png" style="border-radius:8px" />
</div>

<h2 id="ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®å®Ÿè£…ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®å®Ÿè£…ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</h2>
<p>ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯MVP(Model-View-Presenter)ã§æ§‹æˆã•ã‚Œã¦ã„ã¦ã€Activityã¯1ã¤ã§ã™ã€‚<br />
ã¾ãŸä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ä»•æ§˜ï¼ˆä¸Šè¨˜ï¼‰ã§ã™ã¨ã€Modelï¼ˆDBã€APIç­‰ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ï¼‰ãŒå¿…è¦ã®ãªã„ã‚¢ãƒ—ãƒªã«ãªã£ã¦ã—ã¾ã„ã¾ã™ãŒã€
Unit Testã®ç‚ºã€å¤–éƒ¨ã®REST APIã¸æ¥ç¶šã‚’è¡Œã„ã€ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—Consoleå‡ºåŠ›ã‚’ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ãŒç„¡é§„ã«å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚<br />
ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯å›³ã«ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªæ§‹æˆã§ã™ã€‚å›³å†…ã§ã¯ã€ClassãŒ1ã¤ã®ãƒ–ãƒ­ãƒƒã‚¯ã«ãªã£ã¦ã„ã¦ã€ãƒ–ãƒ­ãƒƒã‚¯ã®ä¸Šéƒ¨ã«ç™½æ–‡å­—ã¯Interfaceã§ã™ã€‚
ä¾‹ãˆã°ã€MainActivityPresenterã¯MainActivityPresenterContractã®Interfaceã§æ§‹æˆã•ã‚ŒãŸClassã€
ã‚ˆã£ã¦ã€MainActivityInteractorã¯Interfaceã‚’è¦å®šã—ã¦ã„ãªã„Classã§ã‚ã‚‹ã“ã¨ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-mvp-diagram-00.png" width="90%" />
</div>

<p>ãã‚Œã§ã¯ã€ã§ãã‚‹ã ã‘ã‚µã‚¯ãƒƒã¨CircleCIã§CIã‚’å›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>

<h2 id="äº‹å‰æº–å‚™ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã™ã‚‹">äº‹å‰æº–å‚™ï¼šãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã™ã‚‹</h2>
<p>å®Ÿéš›ã«å‹•ä½œã•ã›ã‚‹å ´åˆã¯ã€ä¸Šè¨˜ã®URLã®ã‚³ãƒ¼ãƒ‰ã‚’Forkç­‰ã‚’ã—ã¦è‡ªå‰ã§å°‚ç”¨ã®ãƒªãƒã‚¸ãƒˆãƒªGitHubã«ã”ç”¨æ„ãã ã•ã„ã€‚</p>

<h2 id="unit-testã«ã¤ã„ã¦"><a name="aboutunittest">Unit Testã«ã¤ã„ã¦</a></h2>
<p>ï¼ˆé–¢é€£è¨˜äº‹ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/10/ci-android-unittest-00.html">Androidã‚¢ãƒ—ãƒªã§ã®Unit Testã«ã¤ã„ã¦ã®è§£èª¬</a>ã€ï¼‰</p>

<p><a href="https://junit.org/junit4/">JUnit</a>ã‚’ä½¿ã£ã¦Unit Testã‚’å®Ÿè¡Œã—ã¾ã™ã€‚Androidã§ã®Unit Testã®å®šç•ªã§ã™ã€‚
ãƒ¢ãƒƒã‚¯ã¯<a href="https://site.mockito.org/">Mockito</a>ã‚’ä½¿ã„ã¾ã™ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®Unit Testã¯Presenterã¨ã‚„ã‚Šå–ã‚Šã‚’æ¨ªå–ã‚Šã™ã‚‹å½¢ã§è¡Œã„ã¾ã™ã€‚
ä¸Šã®å›³ã® <strong>ã€ŒPoint for Unit Testingã€</strong> ã¨æ›¸ã‹ã‚ŒãŸçŸ¢å°ã®ãƒã‚¤ãƒ³ãƒˆãŒãã“ã§ã™ã€‚</p>

<h3 id="unit-testã®æ¦‚è¦">Unit Testã®æ¦‚è¦</h3>
<p>ã‚³ãƒ¼ãƒ‰ã¯<a href="https://github.com/ryoyakawai/uitest_sample_android/tree/master/app/src/test/java/com/example/uitestsample">ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª</a>ã«é…ç½®ã—ã¦ã„ã¾ã™ã€‚</p>

<p>Unit Testã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚</p>

<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/test/java/com/example/uitestsample/MainActivityUnitTest.kt">MainActivityUnitTest.kt</a></li>
</ul>

<p>å…±é€šã§ä½¿ã†ã§ã‚ã‚ã†æ©Ÿèƒ½ã‚’MethodåŒ–ã—ã¦é›†ã‚ãŸClassãŒã“ã¡ã‚‰ã€‚</p>

<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/test/java/com/example/uitestsample/unittestuitls/UnitTestUitls.kt">unittestuitls/UnitTestUitls.kt</a></li>
</ul>

<p>ãƒ†ã‚¹ãƒˆã¨ã—ã¦ã¯ã€å…ˆç¨‹èª¬æ˜ã—ãŸModelã«ã‚¢ãƒ—ãƒªã®å‹•ä½œã«å¯¾ã—ã¦ã¯ç„¡é§„ã«å®Ÿè£…ã—ãŸREST APIã¸æ¥ç¶šã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ã„ã¾ã™ã€‚
REST APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«æ­£ã—ãViewã«åæ˜ ã•ã‚Œã‚‹å‹•ä½œã‚’ã™ã‚‹ã‹ã®ç¢ºèªã‚’è¡Œã†ã®ãŒç›®çš„ã§ã™ã€‚<br />
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®æ¥ç¶šå…ˆREST APIã¯<a href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a>ã§ã™ã€‚æ¥ç¶šã™ã‚‹URLã¯<a href="https://jsonplaceholder.typicode.com/comments?postId=1">/comments?postId=1</a>ã§ã€<code class="highlighter-rouge">postId</code>ãŒåŒä¸€ã§ã‚ã‚Œã°å¸¸ã«åŒã˜å€¤ã®JSONã‚’è¿”ã—ã¦ãã‚Œã¾ã™ã€‚å¸¸ã«åŒã˜JSONã‚’è¿”ã—ã¦ãã‚Œã‚‹ã¨ã¯ã„ãˆã€Unit Testã§ã¯ã‚ˆã‚Šç¢ºå®Ÿæ€§ã‚’é«˜ã‚ãŸã„ã€ã¤ã¾ã‚Šã€ç›¸æ‰‹ã®ã‚µãƒ¼ãƒã®çŠ¶æ…‹ã«é–¢ä¿‚ãªãç¢ºå®Ÿã«åŒã˜JSONã‚’å–å¾—ã§ãã‚‹ã“ã¨ã‚’ä¿è¨¼ã—ãŸã„ã§ã™ã€‚ã§ã™ã®ã§ã€ã“ã®Unit Testã§ã¯<a href="https://site.mockito.org/">Mockito</a>ã‚’ä½¿ã£ã¦JSONPlaceholderã®APIã‚’Mockï¼ˆãƒ¢ãƒƒã‚¯ï¼‰ã™ã‚‹ã“ã¨ã§ç¢ºå®Ÿã«åŒä¸€ã®JSONã‚’å—ã‘å–ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚<br />
<br />
ãƒ†ã‚¹ãƒˆã®ã‚±ãƒ¼ã‚¹ã¯2ã¤ã§ã™ã€‚ãã®å†…å®¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>
<ul>
  <li>HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰200ã§JSONã‚’æ­£ã—ãå—ã‘å–ã£ãŸå ´åˆã®å€¤ã®ç¢ºèªã¨Viewã«å¯¾ã™ã‚‹å‹•ä½œã®ç¢ºèª</li>
  <li>HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰500ã‚’å—ã‘å–ã£ãŸå ´åˆã®Viewã«å¯¾ã™ã‚‹å‹•ä½œç¢ºèª</li>
</ul>

<p>ãªãŠã€Unit Testã®æ›¸ãæ–¹ï¼ˆãŠä½œæ³•ï¼‰ã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è©³ç´°ã¯åˆ¥ã‚¨ãƒ³ãƒˆãƒªã®<a href="https://ryoyakawai.com/blog/2019/07/10/ci-android-unittest-00.html">Androidã‚¢ãƒ—ãƒªã§ã®Unit Testã«ã¤ã„ã¦ã®è§£èª¬</a>ã§èª¬æ˜ã—ã¦ã„ã¾ã™ã€‚</p>

<h3 id="unit-testã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œã•ã›ã¦ã¿ã‚‹">Unit Testã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œã•ã›ã¦ã¿ã‚‹</h3>
<p>æ‰‹å…ƒã§å‹•ä½œã•ã›ã¦ã¿ã¾ã—ã‚‡ã†ã€‚Terminalã§ã‚³ãƒ¼ãƒ‰ã®ãƒˆãƒƒãƒ—ã«ç§»å‹•ã—ã¦ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã“ã‚“ãªå‡ºåŠ›ãŒå‡ºã¦ãã‚‹ã¯ãšã§ã™ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>https://ryoyakawai.com/blog/gradlew :app:testDebugUnitTest<span class="p">;</span>

<span class="o">&gt;</span> Task :app:testDebugUnitTest
com.example.uitestsample.MainActivityUnitTest <span class="o">&gt;</span> sampleUnit500ServerErrorTest PASSED
com.example.uitestsample.MainActivityUnitTest <span class="o">&gt;</span> sampleUnitDataFetchSuccessTest PASSED
com.example.uitestsample.MainActivityUnitTest <span class="o">&gt;</span> sampleUnit400BadRequestTest PASSED

<span class="o">&gt;</span> Task :app:testReleaseUnitTest
com.example.uitestsample.MainActivityUnitTest <span class="o">&gt;</span> sampleUnit500ServerErrorTest PASSED
com.example.uitestsample.MainActivityUnitTest <span class="o">&gt;</span> sampleUnitDataFetchSuccessTest PASSED
com.example.uitestsample.MainActivityUnitTest <span class="o">&gt;</span> sampleUnit400BadRequestTest PASSED

BUILD SUCCESSFUL <span class="k">in </span>8s
40 actionable tasks: 10 executed, 30 up-to-date
</code></pre></div></div>

<p><strong>ã€ŒBUILD SUCCESSFUL in XXsã€</strong> ãŒå‡ºãŸã‚‰ <strong>Unit Testã¯ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ã™ã¹ã¦Successã§çµ‚äº†ã—ãŸ</strong> ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸã€ã“ã“ã§Warningç­‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºãŸå ´åˆã€ã§ãã‚‹é™ã‚Šä¿®æ­£ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚<br />
ã“ã‚Œã§Unit Testã®æº–å‚™ã¯å®Œäº†ã§ã™ã€‚</p>

<h2 id="ui-testã«ã¤ã„ã¦">UI Testã«ã¤ã„ã¦</h2>
<p><a href="https://developer.android.com/training/testing/espresso">Espresso</a>ã€<a href="https://developer.android.com/training/testing/ui-automator">UI Automator</a>ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ãã‚Œãã‚Œã®ç‰¹å¾´ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-uitesttool_00.png" width="50%" />
</div>

<h4 id="espresso">Espresso</h4>
<p>ã€Œto write concise, beautiful, and reliable Android UI testsã€ã¨å…¬å¼ã‚µã‚¤ãƒˆã«ã¯èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹å®šã®ã‚¢ãƒ—ãƒªã®UIã«å¯¾ã—ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹•ä½œã‚’ã•ã›ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚å˜ä¸€ã®ã‚¢ãƒ—ãƒªã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹å ´åˆã«ä½¿ã†ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚Googleç¤¾ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã®ã§ã€Anroidã®å…¬å¼ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¨è¨€ã£ã¦ã‚ˆã„ã§ã—ã‚‡ã†ã€‚</p>

<h4 id="ui-automator">UI Automator</h4>
<p>ã€Œsuitable for cross-app functional UI testing across system and installed apps.ã€ã¨å…¬å¼ã‚µã‚¤ãƒˆã«èª¬æ˜ã•ã‚Œã¦ã„ã‚‹é€šã‚Šã§ã€Espressoã¨æ¯”ã¹ã‚‹ã¨ã€ã‚ˆã‚ŠAndroidã®OSã«è¿‘ã„å´ã«ä½ç½®ã—ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€è¤‡æ•°ã‚¢ãƒ—ãƒªã‚’è¡Œãæ¥ã™ã‚‹ã‚ˆã†å‹•ä½œã‚’ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®šç¾©ã™ã‚‹ã“ã¨ã®å¯èƒ½ã§ã™ã€‚Espressoã¨ã¯é•ã„ã€è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹å ´åˆã«ä½¿ã†ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚ã“ã¡ã‚‰ã‚‚Espressoã¨åŒã˜ãGoogleç¤¾ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã®ã§ã€Anroidã®å…¬å¼ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¨è¨€ã£ã¦ã‚ˆã„ã§ã—ã‚‡ã†ã€‚</p>

<h3 id="ui-testã®æ¦‚è¦">UI Testã®æ¦‚è¦</h3>
<p>ã‚³ãƒ¼ãƒ‰ã¯<a href="https://github.com/ryoyakawai/uitest_sample_android/tree/master/app/src/androidTest/java/com/example/uitestsample">ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª</a>ã«é…ç½®ã—ã¦ã„ã¾ã™ã€‚</p>

<p>UI Testã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚</p>

<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">MainActivityInstrumentedTest.kt</a></li>
</ul>

<p>å…±é€šã§ä½¿ã†ã§ã‚ã‚ã†æ©Ÿèƒ½ã‚’MethodåŒ–ã—ã¦é›†ã‚ãŸClassãŒã“ã¡ã‚‰ã€‚</p>

<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/uitestutils/UiTestUtils.kt">uitestutils/UiTestUtils.kt</a></li>
</ul>

<p>ãƒ†ã‚¹ãƒˆã®ã‚±ãƒ¼ã‚¹ã¯3ã¤ã§ã™ã€‚ãã®å†…å®¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>
<ul>
  <li>ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’ç¢ºèªã™ã‚‹</li>
  <li>ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã®ç”»é¢ã®æ–‡å­—åˆ—ã®ç¢ºèªã‚’ã™ã‚‹</li>
  <li>ã‚¢ãƒ—ãƒªèµ·å‹•å¾Œã€å„ãƒœã‚¿ãƒ³ãŒæ­£ã—ãæ©Ÿèƒ½ã—ã€ç”»é¢è¡¨ç¤ºãŒä»•æ§˜é€šã‚Šæ›´æ–°ã•ã‚Œã‚‹ã‹ã‚’ç¢ºèªã™ã‚‹</li>
</ul>

<p>ãªãŠã€UI Testï¼ˆEspressoã€UI AUtomatorï¼‰ã®æ›¸ãæ–¹ï¼ˆãŠä½œæ³•ï¼‰ã€ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è©³ç´°ã¯åˆ¥ã‚¨ãƒ³ãƒˆãƒªã®ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-espresso-00.html">Espresso, UI Automatorâ€Ã…ÃŸAndroidâ€Ã…Ã†UI Testâ€Ã‡Ã­ÃŠÃµâˆâ€Ã…Ã¨</a>ã€ã§èª¬æ˜ã—ã¦ã„ã¾ã™ã®ã§åˆã‚ã›ã¦å¾¡è¦§ãã ã•ã„ã€‚</p>

<h3 id="ui-testã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œã•ã›ã¦ã¿ã‚‹">UI Testã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œã•ã›ã¦ã¿ã‚‹</h3>
<p>æ‰‹å…ƒã§å‹•ä½œã•ã›ã¦ã¿ã¾ã—ã‚‡ã†ã€‚Terminalã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã®ãƒˆãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ã“ã‚“ãªâ†“ãŒå‡ºåŠ›ãŒå‡ºã¦ãã‚‹ã¯ãšã§ã™ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>./gradlew :app:connectedAndroidTest<span class="p">;</span> // â† ./gradlew cAT ã§ã‚‚OK

<span class="o">&gt;</span> Task :app:connectedDebugAndroidTest
01:52:09 V/ddms: execute: running am get-config
01:52:09 V/ddms: execute <span class="s1">'am get-config'</span> on <span class="s1">'emulator-5554'</span> : EOF hit. Read: <span class="nt">-1</span>
01:52:09 V/ddms: execute: returning
01:52:09 D/app-debug.apk: Uploading app-debug.apk onto device <span class="s1">'emulator-5554'</span>
01:52:09 D/Device: Uploading file onto device <span class="s1">'emulator-5554'</span>
....
01:52:13 V/ddms: execute: running pm install <span class="nt">-r</span> <span class="nt">-t</span> <span class="s2">"/data/local/tmp/test-services-1.0.2.apk"</span>
01:52:13 V/ddms: execute <span class="s1">'pm install -r -t "/data/local/tmp/test-services-1.0.2.apk"'</span> on <span class="s1">'emulator-5554'</span> : EOF hit. Read: <span class="nt">-1</span>
01:52:13 V/ddms: execute: returning
01:52:13 V/ddms: execute: running rm <span class="s2">"/data/local/tmp/test-services-1.0.2.apk"</span>
01:52:13 V/ddms: execute <span class="s1">'rm "/data/local/tmp/test-services-1.0.2.apk"'</span> on <span class="s1">'emulator-5554'</span> : EOF hit. Read: <span class="nt">-1</span>
01:52:13 V/ddms: execute: returning
01:52:13 D/app-debug-androidTest.apk: Uploading app-debug-androidTest.apk onto device <span class="s1">'emulator-5554'</span>
01:52:13 D/Device: Uploading file onto device <span class="s1">'emulator-5554'</span>
....
androidx.test.internal.runner.junit3.DelegatingFilterableTestSuite <span class="o">&gt;</span> <span class="o">[</span>API_27_Pixel_2<span class="o">(</span>AVD<span class="o">)</span> - 8.1.0] SKIPPED
01:52:20 V/InstrumentationResultParser: INSTRUMENTATION_STATUS_CODE: <span class="nt">-3</span>
01:52:21 V/InstrumentationResultParser: INSTRUMENTATION_STATUS: <span class="nv">class</span><span class="o">=</span>androidx.test.internal.runner.junit3.DelegatingTestSuite
01:52:21 V/InstrumentationResultParser: INSTRUMENTATION_STATUS: <span class="nv">current</span><span class="o">=</span>3
01:52:21 V/InstrumentationResultParser: INSTRUMENTATION_STATUS: <span class="nv">id</span><span class="o">=</span>AndroidJUnitRunner
01:52:21 V/InstrumentationResultParser: INSTRUMENTATION_STATUS: <span class="nv">numtests</span><span class="o">=</span>8
....
01:53:07 V/InstrumentationResultParser: Time: 48.21
01:53:07 V/InstrumentationResultParser:
01:53:07 V/InstrumentationResultParser: OK <span class="o">(</span>3 tests<span class="o">)</span>
....
01:53:07 V/ddms: execute: returning
01:53:07 V/ddms: execute: running pm uninstall com.example.uitestsample.test
01:53:07 V/ddms: execute <span class="s1">'pm uninstall com.example.uitestsample.test'</span> on <span class="s1">'emulator-5554'</span> : EOF hit. Read: <span class="nt">-1</span>
01:53:07 V/ddms: execute: returning
01:53:07 V/ddms: execute: running pm uninstall com.example.uitestsample
01:53:07 V/ddms: execute <span class="s1">'pm uninstall com.example.uitestsample'</span> on <span class="s1">'emulator-5554'</span> : EOF hit. Read: <span class="nt">-1</span>
01:53:07 V/ddms: execute: returning

BUILD SUCCESSFUL <span class="k">in </span>1m 1s
51 actionable tasks: 10 executed, 41 up-to-date
</code></pre></div></div>

<p>Unit Testã®ã¨ãã¨åŒã˜ãã€<strong>ã€ŒBUILD SUCCESSFUL in XXsã€</strong> ãŒå‡ºãŸã‚‰ <strong>UI Testã¯ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ã™ã¹ã¦Successã§çµ‚äº†ã—ãŸ</strong> ã¨ã„ã†æ„å‘³ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸã€ã“ã“ã‚‚Unit Testã®ã¨ãã¨åŒæ§˜ã«Warningç­‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ããŸã‚‰ã€ã§ã„ã‚‹é™ã‚Šä¿®æ­£ã™ã‚‹ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚</p>

<h2 id="firebase-test-labã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã†">Firebase Test Labã§ãƒ†ã‚¹ãƒˆã‚’è¡Œã†</h2>

<h3 id="firebase-test-labã¨ã¯"><a name="aboutfirebasetestlab">Firebase Test Labã¨ã¯</a></h3>

<p>Firebase Test Labã¯FirebaseãŒã®1ã¤ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã„ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ã§UI Testã‚’è¡Œã†ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚Android(Espressoã€UI Automator)ã€iOS(XCTest)ã§æ›¸ã‹ã‚ŒãŸãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚æ“ä½œã¯ä»¥ä¸‹ã®2ã¤ã®æ–¹æ³•ãŒæä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<ul>
  <li><a href="https://console.firebase.google.com/">ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰æ“ä½œã‚’è¡Œã†</a></li>
  <li>Google Cloud SDKã®CLIã‚’åˆ©ç”¨ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰<a href="https://console.cloud.google.com/marketplace/details/google/testing.googleapis.com?project=uitest-sample-android&amp;folder=&amp;organizationId=">Cloud Testing API</a>ã§å‹•ä½œã•ã›ã‚‹æ–¹æ³•</li>
</ul>

<p>ã©ã¡ã‚‰ã‚‚ã®æ–¹æ³•ã‚’ä½¿ã£ã¦ã‚‚çµæœã¯ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§å‹•ä½œã—ã¦ã„ã‚‹<a href="console.firebase.google.com">Firebaseã®Console</a>ï¼ˆä¸‹å›³â†“ï¼‰ã‹ã‚‰é–²è¦§ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-console-firebasetestlab_00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<p>ã“ã“ã§ã¯Google Cloud SDKã®CLIã‹ã‚‰Cloud Testing APIã‚’ä½¿ã†æ–¹æ³•ã§å®Ÿè¡Œã—ã¾ã™ã€‚
Google Cloud SDKã®CLIã‹ã‚‰ä½¿ã†å ´åˆã¯ä»¥ä¸‹ã®2ã¤ã®APIã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…é ˆã§ã™ã€‚å¿…ãšä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰åˆ©ç”¨ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚</p>

<ul>
  <li><a href="https://console.cloud.google.com/marketplace/details/google/testing.googleapis.com">Cloud Testing API</a></li>
  <li><a href="https://console.cloud.google.com/marketplace/details/google/toolresults.googleapis.com">Cloud Tool Results API</a></li>
</ul>

<p>ï¼ˆFirebase Test Labã®è¨­å®šã«ã¤ã„ã¦ã¯ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html">Firebase Test Labã§UI Testã‚’å®Ÿè¡Œã™ã‚‹</a>ã€ã§è©³ã—ãèª¬æ˜ã—ã¦ã„ã¾ã™ã€‚ï¼‰</p>

<h3 id="firebase-test-labã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œã•ã›ã¦ã¿ã‚‹">Firebase Test Labã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å‹•ä½œã•ã›ã¦ã¿ã‚‹</h3>
<p><a href="https://firebase.google.com/docs/test-lab">Firebaseã§ã®Projectã®è¨­å®š</a>ã€GCPã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™ã€<a href="https://cloud.google.com/sdk/downloads">Google Cloud SDKã®CLIã¯æº–å‚™</a>ã¯æ¸ˆã‚“ã§ã„ã‚‹ã¨ä»®å®šã—ã¾ã™ã€‚<br />
ã¾ãŸæ—¢ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§UIãƒ†ã‚¹ãƒˆã®å‹•ä½œç¢ºèªã‚‚æ¸ˆã‚“ã§ã„ã¾ã™ã®ã§ã€æ—©é€ŸUIãƒ†ã‚¹ãƒˆã‚’Firebase Test Labã§å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚<br />
ï¼ˆ<a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html">Firebase Test Labã§UI Testã‚’å®Ÿè¡Œã™ã‚‹</a>ã€ã§ã‚‚è©³ã—ãèª¬æ˜ã—ã¦ã„ã¾ã™ã€‚ï¼‰</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// Cloud Testing APIã‚’æœ‰åŠ¹ã«ã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã€CLIã®å‘ãå…ˆProjectã‚’åˆ‡æ›¿ãˆã‚‹
<span class="nv">$ </span>gcloud auth<span class="p">;</span>
<span class="nv">$ </span>gcloud config <span class="nb">set </span>project <span class="o">[</span>PROJECT ID]<span class="p">;</span>
</code></pre></div></div>

<p>ç¶šã„ã¦ã€Cloud Testing APIã§UIãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹ç‚ºã«ä»¥ä¸‹ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œã—ã¾ã™ã€‚<br />
ç’°å¢ƒå¤‰æ•°ã§å¤‰æ•°ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¦ã„ã¾ã™ãŒã€ã“ã“ã§ã¯ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ã‚‚OKã§ã™ã€‚
CircleCIã§ã¯ç’°å¢ƒå¤‰æ•°ã§æŒ‡å®šã™ã‚‹ã“ã¨ãŒæœ›ã¾ã—ã„ã®ã§ãã‚Œã«ç¿’ã£ã¦ã„ã¾ã™ã€‚
ã“ã®è¨˜äº‹å†…ã®ä»–ã®é …ç›®ã§ã‚‚ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†ç†ç”±ã¯åŒä¸€ã§ã™ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ TIME</span><span class="o">=</span><span class="k">$(</span>date <span class="s2">"+%Y%m%d_%H%M"</span><span class="k">)</span><span class="p">;</span>
<span class="nv">$ BK_OBJ_NAME</span><span class="o">=</span><span class="s2">"[ä¿å­˜ã™ã‚‹ãƒã‚±ãƒƒãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå]/</span><span class="k">${</span><span class="nv">TIME</span><span class="k">}</span><span class="s2">[ä»Šå›ã®ãƒ†ã‚¹ãƒˆã‚’ä¿å­˜ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª]"</span><span class="p">;</span>
<span class="nv">$ GOOGLE_PROJECT_ID</span><span class="o">=</span><span class="s2">"[PROJECT ID]"</span><span class="p">;</span>

// ã‚³ãƒãƒ³ãƒ‰ã‚’æ”¹è¡Œã™ã‚‹ã¨ãã¯æœ«å°¾ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å¿˜ã‚Œãšã«å…¥ã‚Œã¦ãã ã•ã„ã€‚
<span class="nv">$ </span>gcloud firebase <span class="nb">test </span>android run <span class="se">\</span>
 <span class="nt">--type</span> instrumentation <span class="se">\</span>
 <span class="nt">--app</span> ./app/build/outputs/apk/debug/app-debug.apk <span class="se">\</span>
 <span class="nt">--test</span> ./app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk <span class="se">\</span>
 <span class="nt">--test-targets</span> <span class="s2">"class com.example.uitestsample.MainActivityInstrumentedTest"</span> <span class="se">\</span>
 <span class="nt">--results-dir</span> <span class="nv">$BK_OBJ_NAME</span> <span class="se">\</span>
 <span class="nt">--results-bucket</span> cloud-test-<span class="k">${</span><span class="nv">GOOGLE_PROJECT_ID</span><span class="k">}</span> <span class="se">\</span>
 <span class="nt">--directories-to-pull</span> /sdcard/uitest/ <span class="se">\</span>
 <span class="nt">--device</span> <span class="nv">model</span><span class="o">=</span>Pixel2,version<span class="o">=</span>26,locale<span class="o">=</span>en_US,orientation<span class="o">=</span>portrait <span class="se">\</span>
 <span class="nt">--use-orchestrator</span> <span class="se">\</span>
 <span class="nt">--timeout</span> 120s<span class="p">;</span>
</code></pre></div></div>

<p>å®Ÿè¡Œé–‹å§‹ãŒæˆåŠŸã™ã‚‹ã¨Firebaseã®Consoleã«ã“ã‚“ãªå½¢â†“ã§1è¡Œè¿½åŠ ã•ã‚Œã¾ã™ã€‚</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-firebase-begin-test_00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<p>ãƒ†ã‚¹ãƒˆãŒçµ‚äº†ã—ã™ã‚‹ã¨ã“ã®ã‚ˆã†ãªå‡ºåŠ›ãŒã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã•ã‚Œã¾ã™ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Have questions, feedback, or issues? Get support by visiting:
  https://firebase.google.com/support/

Uploading <span class="o">[</span>./app/build/outputs/apk/debug/app-debug.apk] to Firebase Test Lab...
Uploading <span class="o">[</span>./app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk] to Firebase Test Lab...
Raw results will be stored <span class="k">in </span>your GCS bucket at <span class="o">[</span>https://console.developers.google.com/storage/browser/[PROJECT ID]/cloud-test-uitest-sample-android/20190705-xxxxxx02/]

Test <span class="o">[</span>matrix-3dp8juo0wx533] has been created <span class="k">in </span>the Google Cloud.
Firebase Test Lab will execute your instrumentation <span class="nb">test </span>on 1 device<span class="o">(</span>s<span class="o">)</span><span class="nb">.</span>
Creating individual <span class="nb">test </span>executions...done.

Test results will be streamed to <span class="o">[</span>https://console.firebase.google.com/project/[PROJECT ID]/testlab/histories/bh.xxxxxxxxx/matrices/918190477175429xxxx].
16:25:19 Test is Pending
16:25:40 Starting attempt 1.
16:25:40 Test is Running
16:26:42 Started logcat recording.
16:26:42 Preparing device.
16:27:15 Logging <span class="k">in </span>to Google account on device.
16:27:15 Installing apps.
16:27:28 Retrieving Pre-Test Package Stats information from the device.
16:27:28 Retrieving Performance Environment information from the device.
16:27:28 Started crash detection.
16:27:28 Started crash monitoring.
16:27:28 Started performance monitoring.
16:27:42 Started video recording.
16:27:42 Starting instrumentation test.
16:28:21 Completed instrumentation test.
16:28:34 Stopped performance monitoring.
16:28:41 Stopped crash monitoring.
16:28:47 Stopped logcat recording.
16:28:47 Retrieving Post-test Package Stats information from the device.
16:28:47 Logging out of Google account on device.
16:28:53 Done. Test <span class="nb">time</span> <span class="o">=</span> 51 <span class="o">(</span>secs<span class="o">)</span>
16:28:53 Starting results processing. Attempt: 1
16:29:00 Completed results processing. Time taken <span class="o">=</span> 7 <span class="o">(</span>secs<span class="o">)</span>
16:29:00 Test is Finished

Instrumentation testing complete.

More details are available at <span class="o">[</span>https://console.firebase.google.com/project/[PROJECT ID]/testlab/histories/bh.xxxxxxxxx/matrices/918190477175429xxxx].
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OUTCOME â”‚     TEST_AXIS_VALUE      â”‚     TEST_DETAILS    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Passed  â”‚ Pixel2-26-en_US-portrait â”‚ 3 <span class="nb">test </span>cases passed â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div>

<p>å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ <strong>GCS bucket</strong>ã€<strong>More details are availabl at</strong> ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãƒ†ã‚¹ãƒˆçµæœãŒæ›¸ãå‡ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚é–²è¦§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰å¯èƒ½ã§ã™ã€‚</p>

<h2 id="deploygateã‚’æº–å‚™ã™ã‚‹">DeployGateã‚’æº–å‚™ã™ã‚‹</h2>
<p><a href="https://docs.deploygate.com/docs/quickstart#section--">ã“ã“</a>ã‚’å‚è€ƒã«ã€<strong>ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—</strong>ã€<strong>ã‚¢ãƒ—ãƒªã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</strong> ã¾ã§æ¸ˆã¾ã›ã¾ã—ã‚‡ã†ã€‚</p>

<h3 id="deploygateã«ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰é…ä¿¡ã—ã¦ã¿ã‚‹">DeployGateã«ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰é…ä¿¡ã—ã¦ã¿ã‚‹</h3>
<h4 id="deplotgateã®api-keyã‚’å–å¾—"><a name="deploygateapikey">DeplotGateã®API keyã‚’å–å¾—</a></h4>
<p>DeployGateã®ã‚µã‚¤ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã—ã¦<a href="https://deploygate.com/settings">https://deploygate.com/settings</a>ã®æœ€ä¸‹æ®µã«è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-deploygate_key_00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<p>ã“ã‚Œã‚’ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚
ã¤ã„ã§ã«ãƒ¦ãƒ¼ã‚¶IDï¼ˆDeployGateã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDï¼‰ã¨APKã¸ã®Pathã‚‚ç’°å¢ƒå¤‰æ•°ã«è¨­å®šã—ã¦ã—ã¾ã„ã¾ã—ã‚‡ã†ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ DEPLOYGATE_API_KEY</span><span class="o">=</span><span class="s2">"[å–å¾—ã—ãŸAPI key]"</span><span class="p">;</span>
<span class="nv">$ USERNAME</span><span class="o">=</span><span class="s2">"[DeployGateã®ãƒ¦ãƒ¼ã‚¶ID]"</span><span class="p">;</span>
<span class="nv">$ APK_PATH</span><span class="o">=</span>app/build/outputs/apk/debug/app-debug.apk<span class="p">;</span>
</code></pre></div></div>

<h4 id="deploygateã«é…ä¿¡ã™ã‚‹"><a name="deploytodeploygate">DeployGateã«é…ä¿¡ã™ã‚‹</a></h4>
<p>ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§é…ä¿¡ã—ã¾ã™ã€‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒªãƒƒãƒã«ã™ã‚‹ãŸã‚ã«ç’°å¢ƒå¤‰æ•°ã‚’å°‘ã€…è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ TIME</span><span class="o">=</span><span class="k">$(</span>date <span class="s2">"+%Y/%m/%d %H:%M"</span><span class="k">)</span><span class="p">;</span>
<span class="nv">$ COMMIT_HASH</span><span class="o">=</span><span class="k">$(</span>git log <span class="nt">--format</span><span class="o">=</span><span class="s2">"%H"</span> <span class="nt">-n</span> 1 | cut <span class="nt">-c</span> 1-8<span class="k">)</span><span class="p">;</span>
<span class="nv">$ </span>curl <span class="nt">-F</span> <span class="s2">"file=@</span><span class="k">${</span><span class="nv">APK_PATH</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-F</span> <span class="s2">"token=</span><span class="k">${</span><span class="nv">DEPLOYGATE_API_KEY</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-F</span> <span class="s2">"message=Build by CircleCI &lt;</span><span class="k">${</span><span class="nv">COMMIT_HASH</span><span class="k">}</span><span class="s2">&gt; (</span><span class="k">${</span><span class="nv">TIME</span><span class="k">}</span><span class="s2">)"</span> https://deploygate.com/api/users/<span class="k">${</span><span class="nv">USERNAME</span><span class="k">}</span>/apps
</code></pre></div></div>

<p>ã“ã®ã‚ˆã†ãªå‡ºåŠ›ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚<code class="highlighter-rouge">"error":false</code>ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ãŸã‚‰é…ä¿¡æˆåŠŸã§ã™ã€‚</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">{</span><span class="s2">"error"</span>:false,<span class="s2">"results"</span>:<span class="o">{</span><span class="s2">"name"</span>:<span class="s2">"UITest Sample App"</span>,<span class="s2">"package_name"</span>:<span class="s2">"com.example.uitestsample"</span>,<span class="s2">"labels"</span>:<span class="o">{}</span>,<span class="s2">"os_name"</span>:<span class="s2">"Android"</span>,..../secure.gravatar.com/avatar/410d1a2cc20ac9675664df7de253156b?s<span class="o">=</span>218<span class="se">\u</span><span class="nv">0026d</span><span class="o">=</span>mm<span class="s2">"}}}
</span></code></pre></div></div>

<p>DeployGateã®ã‚¦ã‚§ãƒ–ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼ˆURLã¯<code class="highlighter-rouge">https://deploygate.com/users/[DeployGateã®ãƒ¦ãƒ¼ã‚¶ID]/apps/[ã‚¢ãƒ—ãƒªã®Packageå]</code>ï¼‰ã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«èµ¤å››è§’ã®ãƒªã‚¹ãƒˆã«ã‚¢ã‚¤ãƒ†ãƒ ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-deploygateadminconsole_00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>
<p><br />
ãƒ“ãƒ«ãƒ‰ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã‹ã‚‰æ‰‹å‹•ã§å›ã™ã“ã¨ã®ç¢ºèªã¾ã§è¡Œã„ã¾ã—ãŸã®ã§ã€CircleCIä¸Šã§å‹•ã‹ã—ã¦ã¿ã¾ã™ã€‚</p>

<h2 id="circleciã®è¨­å®šã‚’ã™ã‚‹">CircleCIã®è¨­å®šã‚’ã™ã‚‹</h2>
<p><a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/.circleci/config.yml"><code class="highlighter-rouge">.circleci/config.yml</code></a>ãŒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚Šã¾ã™ã€‚<br />
å‹•ä½œã•ã›ã‚‹ã«ã¯ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦<code class="highlighter-rouge">DEPLOYGATE_API_KEY</code>ã€<code class="highlighter-rouge">GCLOUD_SERVICE_KEY</code>ã€<code class="highlighter-rouge">GOOGLE_PROJECT_ID</code>ã®è¨­å®šãŒå¿…é ˆã§ã™ã€‚
ãã‚Œãã‚Œã®å€¤ã®å–å¾—æ–¹æ³•ã¯ä»¥ä¸‹ã«ãªã‚Šã¾ã™ã€‚</p>

<h3 id="deploygate_api_key"><code class="highlighter-rouge">DEPLOYGATE_API_KEY</code></h3>
<p>DeployGateã®ã‚µã‚¤ãƒˆã«ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã—ã¦<a href="https://deploygate.com/settings">https://deploygate.com/settings</a>ã®æœ€ä¸‹æ®µã«è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚
ï¼ˆä¸Šè¨˜ <strong><a href="#deploygateapikey">ã€ŒDeplotGateã®API keyã‚’å–å¾—ã€</a></strong> ã®é …ç›®ã§èª¬æ˜ã—ã¦ã„ã‚‹API keyã¨åŒã˜ã§ã™ï¼‰</p>

<h3 id="google_project_idgcloud_service_key"><code class="highlighter-rouge">GOOGLE_PROJECT_ID</code>ã€<code class="highlighter-rouge">GCLOUD_SERVICE_KEY</code></h3>

<p><code class="highlighter-rouge">GOOGLE_PROJECT_ID</code>ã¯JSONå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’base64ã«ã—ãŸå€¤ã§ã™ã€‚</p>

<ol>
  <li>ä¸‹â†“ã®å·¦å›³ã®ã‚ˆã†ã«(1)ã§PROJECT_IDã‚’é¸æŠã—ï¼ˆã“ã“ã§é¸æŠã—ãŸæ–‡å­—åˆ—ãŒ<code class="highlighter-rouge">GOOGLE_PROJECT_ID</code>ã¨ãªã‚Šã¾ã™ï¼‰ã€(2)ã®ã‚ˆã†ã« [IAM &amp; admin] &gt; [Service account] ã‚’é¸æŠã—ã¦ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™</li>
  <li>æ¬¡ã«[IAM &amp; admin]ã‚’è¡¨ç¤ºã—ã€ä¸‹â†“ã®å³å›³ã®ã‚ˆã†ã«å…ˆç¨‹ä½œæˆã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å³å´ã®é‰›ç­†ãƒãƒ¼ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€<strong>Firebase Test Lab Admin</strong> ã‚’è¿½åŠ ã—ã¾ã™</li>
  <li>å†åº¦[IAM &amp; admin] &gt; [Service account]ã‚’è¡¨ç¤ºã—ã¦ã€ä½œæˆã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®å³å´ã«ã‚ã‚‹3ç‚¹ãƒªãƒ¼ãƒ€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã‚­ãƒ¼ã‚’ä½œæˆã—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™</li>
</ol>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-serviceaccount_00.png" width="40%" style="border-radius:4px;border:1px solid #eeeeee; margin-right: 10px" />
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-serviceaccount_01.png" width="55%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<p>ãã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸJSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã‚­ãƒ¼ã‚’base64å½¢å¼ã«æ›¸ãå‡ºã—ã¾ã™ã€‚ã“ã®æ–‡å­—åˆ—ã‚’CircleCIã«ç’°å¢ƒå¤‰æ•°<code class="highlighter-rouge">GCLOUD_SERVICE_KEY</code>ã¨ã—ã¦ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>base64 <span class="nt">-i</span> <span class="o">[</span>PATH TO JSON FILE]<span class="p">;</span>
</code></pre></div></div>

<h2 id="cicleciã«ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦ç™»éŒ²">CicleCIã«ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦ç™»éŒ²</h2>
<p>å–å¾—ã—ãŸ3ã¤ã®å€¤ã‚’<code class="highlighter-rouge">DEPLOYGATE_API_KEY</code>ã€<code class="highlighter-rouge">GOOGLE_PROJECT_ID</code>ã€<code class="highlighter-rouge">GCLOUD_SERVICE_KEY</code>ã‚’ä»¥ä¸‹ã®å›³ã®ã‚ˆã†ã«ç™»éŒ²ã—ã¾ã™ã€‚<br />
å¯¾è±¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—[Settings]ã‚’è¡¨ç¤ºã—ã¦ã€å·¦ãƒšã‚¤ãƒ³ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰[BUILD SETTINGS] &gt; [Environment Variables]ã«ä¿å­˜ã—ã¾ã™ã€‚å®Œäº†ã™ã‚‹ã¨ä»¥ä¸‹ã®å›³ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ç”»é¢ä¸Šã¯æŒ‡å®šã—ãŸå€¤ã®æœ€å¾Œã®4æ–‡å­—ã®ã¿è¡¨ç¤ºã•ã‚ŒãŸçŠ¶æ…‹ã¨ãªã‚Šã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-circleci-stting_00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<h2 id="ãƒªãƒã‚¸ãƒˆãƒªã«pushã—ã¦circleciä¸Šã§buildã‚’å‹•ã‹ã™">ãƒªãƒã‚¸ãƒˆãƒªã«Pushã—ã¦CircleCIä¸Šã§Buildã‚’å‹•ã‹ã™</h2>

<p>è¨­å®šã¯å®Œäº†ã—ã¾ã—ãŸã®ã§ã€æº–å‚™ã—ãŸãƒªãƒã‚¸ãƒˆãƒªã®Masterãƒ–ãƒ©ãƒ³ãƒã«ã‚³ãƒ¼ãƒ‰ã‚’Pushã—ã¾ã™ã€‚<br />
Pushã™ã‚‹ã¨CircleCIä¸Šã§Buildã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå‹•ãå§‹ã‚ã¾ã™ã€‚ä»Šå¾Œã¯Masterã«Pushã€ã¾ãŸã¯Mergeã™ã‚‹ã¨Buildãƒ—ãƒ­ã‚»ã‚¹ãŒèµ°ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>

<h3 id="å®Ÿè¡Œçµæœã®ãƒ¬ãƒãƒ¼ãƒˆã‚’é–²è¦§ã™ã‚‹">å®Ÿè¡Œçµæœã®ãƒ¬ãƒãƒ¼ãƒˆã‚’é–²è¦§ã™ã‚‹</h3>
<p>ãƒ“ãƒ«ãƒ‰ã®çµæœã¯CircleCIã®ã‚µã‚¤ãƒˆã‹ã‚‰ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚æˆåŠŸã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã§ã—ã‚‡ã†ã€‚<br />
ã¾ãŸã€Unit Testã®çµæœã¯ <strong>Artifacts</strong> ã®ã‚¿ãƒ–ã‹ã‚‰ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ï¼ˆä¸‹å›³ï¼‰</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-circleci-result_00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<p>UI Testã®ã‚‚ç¢ºèªã¯å¯èƒ½ã§ã™ã€‚Successã®å ´åˆã¯ãã‚Œã§ã‚ˆã„ã®ã§ã™ãŒã€Failã—ã¦ã„ã‚‹å ´åˆã®è©³ç´°çµæœã¯ä¸‹å›³ã®ã‚ˆã†ã«Firebaseã®Consoleã‹ã‚‰ç¢ºèªã—ã¦ãã ã•ã„ã€‚ã¾ãŸã€ä¸‹å›³ã®èµ¤ä¸¸å†…ã® <strong>Test Result</strong> ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿ãŒé–²è¦§å¯èƒ½ã¨ãªã£ã¦ã„ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-firebase-access-to-gcp_00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<h3 id="deploygateã¸ã®é…ä¿¡ã‚’ç¢ºèª">DeployGateã¸ã®é…ä¿¡ã‚’ç¢ºèª</h3>
<p><strong><a href="#deploytodeploygate">ã€ŒDeployGateã«é…ä¿¡ã™ã‚‹ã€</a></strong> ã®é …ç›®ã§ã®çµæœã®ã‚ˆã†ã«ãƒªã‚¹ãƒˆã«ã‚¢ã‚¤ãƒ†ãƒ ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚</p>

<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>Androidã‚¢ãƒ—ãƒªã‚’CircleCIä¸Šã§CIã™ã‚‹æµã‚Œã‚’èª¬æ˜ã—ã¦ãã¾ã—ãŸã€‚ã“ã®æµã‚Œã§CIã‚’å›ã—ã¦ã„ãã¾ã™ã€‚é•·ããªã£ã¦ã—ã¾ã„ã¾ã—ãŸãŒã€ã„ã‹ãŒã§ã—ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿ<br />
ã“ã®æµã‚Œã‚’ä½œã‚‹ã®ã«å¤šãã®ã‚µã‚¤ãƒˆã«ãŠä¸–è©±ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã®è¨˜äº‹ã‚’ã”è¦§ã«ãªã£ã¦ã„ã‚‹æ–¹ã€…ãŒã‚µã‚¯ã£ã¨CIç’°å¢ƒã‚’ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã“ã¨ã§ã€
ä¸–ç•Œã‚’å¤‰ãˆã‚‹ã§ã‚ã‚ã†ç´ æ™´ã‚‰ã—ã„ã‚¢ãƒ—ãƒªã®é–‹ç™ºã«æ™‚é–“ã‚’æ³¨ãã“ã¨ã«å°‘ã—ã§ã‚‚ãŠåŠ›ã«ãªã‚ŒãŸã‚‰å¬‰ã—ã„ã§ã™ã€‚<br />
ãªãŠã€ä»Šå›ã®UI Testã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã«ä¾å­˜ã™ã‚‹éƒ¨åˆ†ãŒå°‘ãªã‹ã£ãŸã®ã§ã™ãŒã€ãã†ã§ãªã„å ´åˆã¯çµæœãŒä¸å®‰å®šã«ãªã‚ŠãŒã¡ã§ã™ã®ã§ã€é€šä¿¡ä¸­ãªã®ã‹ã€é€šä¿¡ã¯å®Œäº†ã—ã¦ã„ã‚‹ã®ã‹ã«ã¤ã„ã¦ã®ä½•ã‚‰ã‹ã®ç›®å°ã‚’ã¤ã‘ã‚‹ã€ã ã£ãŸã‚Šãã®ä»–ã®å·¥å¤«ãŒå¿…è¦ã«ãªã‚Šã¾ã™ã€‚ãã†ã„ã£ãŸã¨ã“ã‚ã‚‚ä½•ã‚‰ã‹ã®å½¢ã§å…±æœ‰ã—ã¦ã„ããŸã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚</p>

<p>ãã‚Œã§ã¯ã€å¼•ãç¶šãè©³ç´°ãªè§£èª¬ã«ã¤ã„ã¦ã‚‚ãŒã‚“ã°ã£ã¦æ›¸ã„ã¦ã„ãã¾ã™ã®ã§ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-06-29T20:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/06/29/bourbon-chicken.html">June 29, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/06/29/bourbon-chicken.html" rel="bookmark" title="ã‚¢ãƒ¡ãƒªã‚«ãƒ³ä¸­è¯ã®ä»£è¡¨æ ¼ï¼Ÿã®ãƒãƒ¼ãƒœãƒ³ãƒã‚­ãƒ³ã‚’ä½œã£ã¦ã¿ãŸ" itemprop="url">ã‚¢ãƒ¡ãƒªã‚«ãƒ³ä¸­è¯ã®ä»£è¡¨æ ¼ï¼Ÿã®ãƒãƒ¼ãƒœãƒ³ãƒã‚­ãƒ³ã‚’ä½œã£ã¦ã¿ãŸ</a></h1>
    
  </header>
  <div class="entry-content">
    <div> </div>

<div class="post-image-center">
  <img src="https://ryoyakawai.com/blog/images/2019/06/20190629-bourbonchicken.jpg" width="60%" />
</div>

<p>ã‚¢ãƒ¡ãƒªã‚«ãƒ³ä¸­è¯ã®ä»£è¡¨æ ¼ã‹ãªï¼Ÿã£ã¦æ€ã£ã¦ã‚‹ãƒãƒ¼ãƒœãƒ³ãƒã‚­ãƒ³ã€‚å¾®å¦™ã«ç„¦ãŒã™ã®ãŒãƒã‚¤ãƒ³ãƒˆãªæ–™ç†ã€‚ãŸã¾ã«ç„¡æ€§ã«é£Ÿã¹ãŸããªã‚‹ã®ã§ä½œã£ã¦ã¿ã¾ã—ãŸã€‚<br />
<a href="http://bit.ly/31S62b4">ã‚‚ã¨ãƒã‚¿ã®ãƒ¬ã‚·ãƒ”</a>ã‹ã‚‰èª¿å‘³æ–™ï¼ˆç‰¹ã«ã€ç ‚ç³–ã®é‡ï¼ï¼‰ã‚’ã‚¢ãƒ¬ãƒ³ã‚¸ã—ã¦ã„ã¾ã™ã€‚<br />
ã‚‚ã—ã‚ˆã‹ã£ãŸã‚‰ä½œã£ã¦ã¿ã¦ãã ã•ã„ï¼ç™½ã„ã”é£¯ã«è¼‰ã›ã¦é£Ÿã¹ã‚‹ã¨ç¾å‘³ã—ã„ã§ã™ğŸ˜‹</p>

<h3 id="ãƒãƒ¼ãƒœãƒ³ãƒã‚­ãƒ³ã‚¢ãƒ¡ãƒªã‚«ãƒ³ä¸­è¯">ãƒãƒ¼ãƒœãƒ³ãƒã‚­ãƒ³ï¼ˆã‚¢ãƒ¡ãƒªã‚«ãƒ³ä¸­è¯ï¼Ÿï¼‰</h3>
<div class="post-image-center">
<script src="https://widgets.cookpad.com/recipes/5719021.js?k=5ba150f3" type="text/javascript"></script>
</div>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    
      
        <li><a href="https://ryoyakawai.com/blog/page2/" class="btn">Previous</a></li>
      
    

    
    
      <li><a href="https://ryoyakawai.com/blog">1</a></li>
    

    
    

    
    
    

    
      
        
        
        
        <li><a href="https://ryoyakawai.com/blog/page2/">2</a></li>
      
    
      
        <li><strong class="current-page">3</strong></li>
      
    
      
        
        
        
        <li><a href="https://ryoyakawai.com/blog/page4/">4</a></li>
      
    
      
        
        
        
        <li><a href="https://ryoyakawai.com/blog/page5/">5</a></li>
      
    

    
    
      <li>â€¦</li>
    

    
      <li><a href="https://ryoyakawai.com/blog/page18/">18</a></li>
    

    
    
      <li><a href="https://ryoyakawai.com/blog/page4/" class="btn">Next</a></li>
    
  </ul>
</div>


</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2021 Ryoya Kawai.</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://ryoyakawai.com/blog/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://ryoyakawai.com/blog/assets/js/scripts.min.js"></script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116678332-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116678332-1');
</script>





<script type="text/javascript" src="https://ryoyakawai.com/blog/assets/js/header-title-post-index.js"></script>

</body>
</html>

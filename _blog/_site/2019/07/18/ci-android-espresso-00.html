<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>

<meta charset="utf-8">
<title>Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã &#8211; Delicious Days</title>
<meta name="description" content="">
<meta name="keywords" content="Android, UI Test, Espresso, UI Automator">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@ryoyakawai">
<meta name="twitter:title" content="Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã">
<meta name="twitter:text:title" content="Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã">
<meta name="twitter:creator" content="@ryoyakawai">
<meta name="twitter:image" content="https://ryoyakawai.com/blog/images/background_sf_pano_300x300.jpg">
<meta name="twitter:description" content="">


<!-- Open Graph -->
<meta property="og:locale" content="ja_JP">
<meta property="og:type" content="summary">
<meta property="og:image" content="https://ryoyakawai.com/blog/images/background_sf_pano_300x300.jpg">
<meta property="og:title" content="Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã">
<meta property="og:description" content="">
<meta property="og:url" content="https://ryoyakawai.com/blog/2019/07/18/ci-android-espresso-00.html">
<meta property="og:site_name" content="Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã">





<link rel="canonical" href="https://ryoyakawai.com/blog/2019/07/18/ci-android-espresso-00.html">
<link href="https://ryoyakawai.com/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Delicious Days Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://ryoyakawai.com/blog/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://ryoyakawai.com/blog/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Polymer -->
<script src="https://polygit.org/components/webcomponentsjs/webcomponents-loader.js"></script>
<link rel="import" href="https://ryoyakawai.com/blog/assets/components/youtube-play.html">
<link rel="import" href="https://ryoyakawai.com/blog/assets/components/language-selector.html">

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://ryoyakawai.com/blog/images/profile_photo.jpg">
<link rel="icon" type="image/jpeg" href="https://ryoyakawai.com/blog/images/profile_photo.jpg">



<!-- AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9891854265132215",
    enable_page_level_ads: true
  });
</script>




  <link rel="stylesheet" type="text/css" href="https://ryoyakawai.com/blog/assets/css/header-title.css">
  <link rel="stylesheet" type="text/css" href="https://ryoyakawai.com/blog/assets/css/post.css">
</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="https://ryoyakawai.com/blog/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="https://ryoyakawai.com/blog/images/avatar.jpg" alt="Ryoya Kawai photo" class="author-photo">
					<h4>Ryoya Kawai</h4>
					<p></p>
				</li>
				<li><a href="https://ryoyakawai.com/blog/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:blog@ryoyakawai.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/ryoyakawai"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/ryoyakawai"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				<li>
					<a href="https://google.com/+ryoyakawai"><i class="fa fa-fw fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="https://linkedin.com/in/ryoya-kawai-11342b57"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/ryoyakawai"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="https://ryoyakawai.com/blog/posts/">Order by Date</a></li>
				<li><a href="https://ryoyakawai.com/blog/tags/">Group By Tag</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap entry-header">
        
          <h1 class="entry-title entry-title-post header-title-text"><a href="https://ryoyakawai.com/blog/2019/07/18/ci-android-espresso-00.html" rel="bookmark" title="Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã">Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã</a></h1>
        
        <h2><span class="entry-date date published"><time datetime="2019-07-18T00:00:00+09:00">July 18, 2019</time></span></h2>
<!--
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
Reading time ~1 minute

        </p>--><!-- /.entry-reading-time -->
        <!---->
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <script type="text/javascript" src="//b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<script src="//apis.google.com/js/platform.js" async defer>{lang: 'ja'}</script>
<script id="pocket-btn-js" src="//widgets.getpocket.com/v1/j/btn.js?v=1"></script>

<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.12&appId=611626902509108&autoLogAppEvents=1';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

<div class="social-share">
  <style>
    .pocket-btn {display:inline-block; height:20px; vertical-align:top;}
    .fb-like span {vertical-align: inherit !important}
  </style>
  <a href="http://b.hatena.ne.jp/entry/https://ryoyakawai.com/blog/2019/07/18/ci-android-espresso-00.html" class="hatena-bookmark-button" data-hatena-bookmark-title="Delicious Days" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="ã“ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ "><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="ã“ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã‚’ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã«è¿½åŠ " width="20" height="20" style="border: none;" /></a>
  <a class="twitter-share-button" href="https://twitter.com/share" data-via="ryoyakawai">Tweet</a>
  <div class="fb-like" data-href="https://ryoyakawai.com/blog/2019/07/18/ci-android-espresso-00.html" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>
  <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a>
</div>


      <h2 id="ã“ã‚Œã¯ä½•">ã“ã‚Œã¯ä½•ï¼Ÿ</h2>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®UI Testã®æ›¸ãæ–¹ã«ã¤ã„ã¦èª¬æ˜ã—ãŸè¨˜äº‹ã§ã™ã€‚
å…·ä½“çš„ã«ã¯<a href="https://github.com/ryoyakawai/uitest_sample_android">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª</a>ã®<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">UI Testã§ã‚ã‚‹ã“ã‚Œ</a>ã®èª¬æ˜ã§ã™ã€‚</p>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>
<h3 id="androidã§ui-testã‚’æ›¸ã">Androidã§UI Testã‚’æ›¸ã</h3>
<p>AndroidãŒå…¬å¼ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹UI Testã®ãƒ„ãƒ¼ãƒ«ã¯ <a href="https://developer.android.com/training/testing/espresso">Espresso</a>ã€
<a href="https://developer.android.com/training/testing/ui-automator">UI Automator</a> ã®2ç¨®é¡ã‚ã‚Šã¾ã™ã€‚
ãã‚Œãã‚Œä»¥ä¸‹ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã®ã§ã€Œã©ã¡ã‚‰ã‚’ä½¿ã†ã‹ï¼Ÿã€ã«ã¤ã„ã¦ã¯ã€Œã©ã¡ã‚‰ã‚‚ä½µç”¨ã—ã¦ä½¿ã†ã€ã®ãŒã„ã„ã‚ˆã†ã«æ„Ÿã˜ã¦ã„ã¾ã™ã€‚</p>

<h4 id="espresso">Espresso</h4>
<p>ã€Œto write concise, beautiful, and reliable Android UI testsã€ã¨å…¬å¼ã‚µã‚¤ãƒˆã«ã¯èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹å®šã®ã‚¢ãƒ—ãƒªã®UIã«å¯¾ã—ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹•ä½œã‚’ã•ã›ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚å˜ä¸€ã®ã‚¢ãƒ—ãƒªã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹å ´åˆã«ä½¿ã†ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚Googleç¤¾ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã®ã§ã€Anroidã®å…¬å¼ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¨è¨€ã£ã¦ã‚ˆã„ã§ã—ã‚‡ã†ã€‚<br />
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ã‚¢ãƒ—ãƒªã®æ“ä½œã®ã™ã¹ã¦ã‚’Espressoã§æ›¸ã„ã¦ã„ã¾ã™ã€‚</p>

<h4 id="ui-automator">UI Automator</h4>
<p>ã€Œsuitable for cross-app functional UI testing across system and installed apps.ã€ã¨å…¬å¼ã‚µã‚¤ãƒˆã«èª¬æ˜ã•ã‚Œã¦ã„ã‚‹é€šã‚Šã§ã€Espressoã¨æ¯”ã¹ã‚‹ã¨ã€ã‚ˆã‚ŠAndroidã®OSã«è¿‘ã„å´ã«ä½ç½®ã—ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€è¤‡æ•°ã‚¢ãƒ—ãƒªã‚’è¡Œãæ¥ã™ã‚‹ã‚ˆã†å‹•ä½œã‚’ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®šç¾©ã™ã‚‹ã“ã¨ã®å¯èƒ½ã§ã™ã€‚Espressoã¨ã¯é•ã„ã€è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹å ´åˆã«ä½¿ã†ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚ã“ã¡ã‚‰ã‚‚Espressoã¨åŒã˜ãGoogleç¤¾ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã®ã§ã€Anroidã®å…¬å¼ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¨è¨€ã£ã¦ã‚ˆã„ã§ã—ã‚‡ã†ã€‚<br />
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®æ’®å½±ã€Permissionãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®æ“ä½œã®2ã¤ã‚’UI Automatorã§æ›¸ã„ã¦ã„ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-uitesttool_00.png" width="50%" />
</div>

<h3 id="espressoui-automatorã§testã‚’æ›¸ãæº–å‚™ã‚’ã™ã‚‹">Espressoã€UI Automatorã§Testã‚’æ›¸ãæº–å‚™ã‚’ã™ã‚‹</h3>
<p>ä»¥ä¸‹ã®2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¦æº–å‚™å®Œäº†ã§ã™ã€‚</p>

<h4 id="-buildgradle-ã«ä»¥ä¸‹ã‚’è¿½åŠ ">ï¼ <code class="highlighter-rouge">build.gradle</code> ã«ä»¥ä¸‹ã‚’è¿½åŠ </h4>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="n">allprojects</span> <span class="p">{</span>
<span class="o">....</span>
  <span class="n">tasks</span><span class="p">.</span><span class="n">matching</span> <span class="p">{</span><span class="n">it</span> <span class="n">instanceof</span> <span class="n">Test</span><span class="p">}.</span><span class="n">all</span> <span class="p">{</span>
    <span class="n">testLogging</span><span class="p">.</span><span class="n">events</span> <span class="p">=</span> <span class="p">[</span><span class="s">"failed"</span><span class="p">,</span> <span class="s">"passed"</span><span class="p">,</span> <span class="s">"skipped"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="o">....</span>
<span class="p">}</span>
<span class="o">....</span>
</code></pre></div></div>

<h4 id="-appbuildgradle-ã«ä»¥ä¸‹ã‚’è¿½åŠ "><code class="highlighter-rouge">ï¼ app/build.gradle</code> ã«ä»¥ä¸‹ã‚’è¿½åŠ </h4>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="n">dependencies</span> <span class="p">{</span>
<span class="o">....</span>
  <span class="c1">// for connected Android test
</span>  <span class="n">androidTestUtil</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">:</span><span class="n">orchestrator</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">:</span><span class="n">runner</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">espresso</span><span class="p">:</span><span class="n">espresso</span><span class="p">-</span><span class="n">core</span><span class="p">:</span><span class="m">3.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">espresso</span><span class="p">:</span><span class="n">espresso</span><span class="p">-</span><span class="n">intents</span><span class="p">:</span><span class="m">3.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">uiautomator</span><span class="p">:</span><span class="n">uiautomator</span><span class="p">-</span><span class="n">v18</span><span class="p">:</span><span class="m">2.1</span><span class="p">.</span><span class="m">3</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">:</span><span class="n">rules</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">junit</span><span class="p">:</span><span class="n">junit</span><span class="p">:</span><span class="m">4.12</span><span class="err">'</span>
<span class="o">....</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ãƒ†ã‚¹ãƒˆã‚’æ›¸ã">ãƒ†ã‚¹ãƒˆã‚’æ›¸ã</h3>
<p>ãƒ†ã‚¹ãƒˆã¯<code class="highlighter-rouge">app/src/androidTest/[Packageå]</code>ä»¥ä¸‹ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚<br />
ä»Šå›ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ <code class="highlighter-rouge">com.example.uitestsample</code> 
ã§ã™ã®ã§ <a href="app/src/androidTest/java/com/example/uitestsample/"><code class="highlighter-rouge">app/src/androidTest/java/com/example/uitestsample/</code></a>
ä»¥ä¸‹ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚<br />
ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã®ç²’åº¦ã¯Activityæ¯ã€Fragmentæ¯ã€æ©Ÿèƒ½æ¯ç­‰ã€è‡ªç”±ã«ã¾ã¨ã‚ã¦ã—ã¾ã£ã¦å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯Activityæ¯ã§ã¾ã¨ã‚ã¦<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">MainActivityInstrumentedTest.kt</a>ã«æ›¸ã„ã¦ã„ã¾ã™ã€‚</p>

<h4 id="å‰æº–å‚™">å‰æº–å‚™</h4>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">@RunWith</span><span class="p">(</span><span class="n">AndroidJUnit4</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="n">@SdkSuppress</span><span class="p">(</span><span class="n">minSdkVersion</span> <span class="p">=</span> <span class="m">26</span><span class="p">)</span>
<span class="n">@LargeTest</span>
<span class="kd">class</span> <span class="nc">MainActivityInstrumentedTest</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">_packageName</span> <span class="p">=</span> <span class="s">"com.example.uitestsample"</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">mUTs</span><span class="p">:</span> <span class="n">UiTestUtils</span> <span class="p">=</span> <span class="n">UiTestUtils</span><span class="p">()</span>
    <span class="c1">// ^^^ ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ– ^^^
</span>
    <span class="n">@Rule</span>
    <span class="n">@JvmField</span>
    <span class="kd">val</span> <span class="py">mActivityTestRule</span><span class="p">:</span> <span class="n">ActivityTestRule</span><span class="p">&lt;</span><span class="n">MainActivity</span><span class="p">&gt;</span> <span class="p">=</span>
        <span class="n">ActivityTestRule</span><span class="p">(</span><span class="n">MainActivity</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>

    <span class="n">@Rule</span>
    <span class="n">@JvmField</span>
    <span class="kd">val</span> <span class="py">cGrantPermissionRule</span><span class="p">:</span> <span class="n">GrantPermissionRule</span> <span class="p">=</span>
        <span class="n">GrantPermissionRule</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="n">Manifest</span><span class="p">.</span><span class="n">permission</span><span class="p">.</span><span class="n">WRITE_EXTERNAL_STORAGE</span><span class="p">)</span>
    <span class="c1">// ^^^ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¿å­˜ã®ç‚ºã«STORAGEã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¼·åˆ¶çš„ã«è¨±å¯ ^^^
</span>
    <span class="n">@Rule</span>
    <span class="n">@JvmField</span>
    <span class="kd">val</span> <span class="py">screenshotRule</span> <span class="p">=</span> <span class="n">ScreenshotTakingRule</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">)</span>
    <span class="c1">// ^^^ Testå¤±æ•—æ™‚ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±ã™ã‚‹ã‚ˆã†ã«æŒ‡å®š ^^^
</span>
    <span class="n">@Before</span>
    <span class="k">fun</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">setActivity</span><span class="p">(</span><span class="n">mActivityTestRule</span><span class="p">.</span><span class="n">activity</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">@After</span>
    <span class="k">fun</span> <span class="nf">teardown</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

<span class="o">....</span>

<span class="p">}</span>
</code></pre></div></div>
<p>ã€ŒTestå¤±æ•—æ™‚ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ã®å‹•ä½œã¯ <code class="highlighter-rouge">uitestutils/UiTestUtils.kt</code> ã®æœ€å¾Œã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="kd">class</span> <span class="nc">ScreenshotTakingRule</span><span class="p">(</span><span class="n">mUTs</span><span class="p">:</span> <span class="n">UiTestUtils</span><span class="p">)</span> <span class="p">:</span> <span class="n">TestWatcher</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">mUTs</span> <span class="p">=</span> <span class="n">mUTs</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">failed</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Throwable</span><span class="p">?,</span> <span class="n">description</span><span class="p">:</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">runner</span><span class="p">.</span><span class="n">Description</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="n">failed</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">mUTs</span><span class="p">.</span><span class="n">screenShot</span><span class="p">(</span><span class="s">"FAIL-$description"</span><span class="p">)</span>
        <span class="n">mUTs</span><span class="p">.</span><span class="n">log_d</span><span class="p">(</span><span class="s">"&gt;&gt;&gt; !!! TEST FAILED !!! &lt;&lt;&lt; ScreenShot Taken method=[$description] filename=[$path]"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>
<h4 id="ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹">ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹</h4>
<p>ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®3ã¤ã§ã™ã€‚
ã€Œã‚±ãƒ¼ã‚¹ã¨ã—ã¦è¶³ã‚Šãªã„ï¼ã€ã¨ã‹ãƒ„ãƒƒã‚³ãƒŸã¯ã‚ã‚Šã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€UI Testã‚’å‹•ã‹ã™ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã®ã§ã”å®¹èµ¦ãã ã•ã„ã€‚</p>

<ul>
  <li><code class="highlighter-rouge">useAppContext()</code>ï¼šãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’ç¢ºèª</li>
  <li><code class="highlighter-rouge">checkTextHelloWorld()</code>ï¼šã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã€ä¸­å¿ƒã®ã€ŒHello World!ã€ã®è¡¨ç¤ºã‚’ç¢ºèª</li>
  <li><code class="highlighter-rouge">checkButtonIncrementFloating()</code>ï¼šç”»é¢å³ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨è¡¨ç¤ºã—ã¦ã„ã‚‹æ•°å­—ãŒã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—SnackbarãŒè¡¨ç¤ºã•ã‚Œã€ã¾ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰Resetã™ã‚‹ã¨ã‚¼ãƒ­ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª</li>
</ul>

<p><code class="highlighter-rouge">checkButtonIncrementFloating()</code> ã®ãƒã‚¤ãƒ³ãƒˆã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§èª¬æ˜ã—ã¾ã™ã€‚<br />
<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">Testã®ã‚³ãƒ¼ãƒ‰å…¨ä½“ã¯ã“ã¡ã‚‰</a>ã«ãªã‚Šã¾ã™ã®ã§åˆã‚ã›ã¦å¾¡è¦§ãã ã•ã„ã€‚</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">....</span>
<span class="n">@Test</span>
<span class="k">fun</span> <span class="nf">checkButtonIncrementFloating</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// false ã«ã™ã‚‹ã“ã¨ã§TestãŒæˆåŠŸã—ãŸå ´åˆã§ã‚‚ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ®‹ã›ã¾ã™ã€‚
</span>    <span class="c1">// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€TestãŒæˆåŠŸã™ã‚‹ã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¯å…¨å‰Šé™¤ã¨ãªã‚Šã¾ã™ã€‚
</span>    <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">prepareScreenShot</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>

<span class="o">....</span>

    <span class="kd">val</span> <span class="py">willTap</span> <span class="p">=</span> <span class="m">5</span>
    <span class="c1">// å³ä¸‹ã®èµ¤è‰²ã®Fabã‚’æŒ‡å®š
</span>    <span class="kd">val</span> <span class="py">incrementButton</span> <span class="p">=</span>  <span class="n">withId</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">increment_fab_text</span><span class="p">)</span>

    <span class="c1">// ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’å¢—åŠ ã•ã›ã¦è¡¨ç¤ºãŒæƒ³å®šé€šã‚Šã§ã‚ã‚‹ã‹ç¢ºèªã™ã‚‹
</span>    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">..</span><span class="n">willTap</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±
</span>        <span class="n">mUTs</span><span class="p">.</span><span class="n">screenShot</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"BEFORE &gt;&gt;&gt; ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼šã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ IDX=[$i]"</span><span class="p">)</span>
        <span class="c1">// æŒ‡å®šã—ãŸèµ¤è‰²ã®Fabã‚’ã‚¿ãƒƒãƒ—
</span>        <span class="n">onView</span><span class="p">(</span><span class="n">incrementButton</span><span class="p">).</span><span class="n">perform</span><span class="p">(</span><span class="n">click</span><span class="p">())</span>

        <span class="c1">// Permissionãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‡ºã¦ãŸã‚‰è¨±å¯ï¼ˆã“ã®ãƒ†ã‚¹ãƒˆä¸­ã¯å‡ºãªã„ã¯ãšï¼‰
</span>        <span class="n">mUTs</span><span class="p">.</span><span class="n">allowPermissionsIfNeeded</span><span class="p">()</span>

        <span class="c1">// ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±
</span>        <span class="n">mUTs</span><span class="p">.</span><span class="n">screenShot</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"AFTER &gt;&gt;&gt; ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼šã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ IDX=[$i]"</span><span class="p">)</span>
        <span class="c1">// è¦ç´ å†…ã®æ–‡å­—åˆ—ã‚’å–å¾—
</span>        <span class="n">actualCount</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">getText</span><span class="p">(</span><span class="n">withId</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">main_content_text</span><span class="p">))</span>
        <span class="c1">// ãƒ­ã‚°ã‚’æ®‹ã™
</span>        <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">log_d</span><span class="p">(</span><span class="s">"[Counter SEQ] ğŸğŸ expected=[$i] actual=[$actualCount]"</span><span class="p">)</span>
        <span class="c1">// æ–‡å­—åˆ—ã‚’Assert
</span>        <span class="n">assertEquals</span><span class="p">(</span><span class="s">"[Counter SEQ] ğŸğŸ"</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">toString</span><span class="p">(),</span> <span class="n">actualCount</span><span class="p">)</span>

        <span class="c1">// Snackbarã®æ–‡è¨€ãƒã‚§ãƒƒã‚¯
</span>        <span class="kd">val</span> <span class="py">snackBarTapped</span> <span class="p">=</span> <span class="n">allOf</span><span class="p">(</span><span class="n">withId</span><span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">design</span><span class="p">.</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">snackbar_text</span><span class="p">),</span> <span class="n">withText</span><span class="p">(</span><span class="s">"Tapped $i times."</span><span class="p">))</span>
        <span class="c1">// SnackbarãŒã‹ã‚‰æ¶ˆãˆã‚‹ã®ã‚’å¾…ã¤
</span>        <span class="n">waitForSnackbarDisappear</span><span class="p">(</span><span class="n">snackBarTapped</span><span class="p">)</span>
        <span class="c1">// Sleepã™ã‚‹
</span>        <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="s">"SHR"</span><span class="p">)</span>
    <span class="p">}</span>

<span class="o">....</span>

    <span class="c1">// this.mUTs.prepareScreenShot() ã« false ã‚’ã‚»ãƒƒãƒˆã—ã¦ã„ãªã‘ã‚Œã°
</span>    <span class="c1">// ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å‰Šé™¤ã™ã‚‹ï¼ˆï¼‰
</span>    <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">removeSuccessScreenShots</span><span class="p">()</span>

<span class="o">....</span>

<span class="p">}</span>
<span class="o">....</span>
</code></pre></div></div>

<h3 id="idãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®æŒ‡å®šæ–¹æ³•">IDãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®æŒ‡å®šæ–¹æ³•</h3>
<p>ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã«å¯¾ã—ã¦IDãŒæŒ¯ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã¯å¤§æŠµã®å ´åˆãã®IDã‚’ä½¿ã†ã“ã¨ã§æŒ‡å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ãŒã€
æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ <strong>Layout Inspector</strong> ï¼ˆ<a href="https://developer.android.com/studio/debug/layout-inspector">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ï¼‰ã§éšå±¤æ§‹é€ ã‚’å–å¾—
ã—ã¦è§£æã‚’ã—ã¦ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã‚’è¡Œã„ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190718-layoutinspector-00.png" width="90%" />
</div>

<p>Fragmentã®é‡ãªã‚Šæ–¹ãŒæ“ä½œã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹å ´åˆãŒã‚ã‚Šã€è¡¨ç¤ºã¯åŒã˜ã§ã‚‚éšå±¤ãŒé•ã†å ´åˆãŒå¤šã€…ç™ºç”Ÿã—ã¾ã™ã€‚
ã§ã™ã®ã§ã€Layout Inspectorã§éšå±¤æ§‹é€ ã‚’å–å¾—ã™ã‚‹ã¨ãã¯UI Testã§ã®ã‚·ãƒŠãƒªã‚ªé€šã‚Šã«ä¸€åº¦ç”»é¢ã‚’é·ç§»ã•ã›ã¦ã€ãã‚Œã‹ã‚‰å–å¾—ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚</p>

<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>iOSæ¨™æº–ã®UI Testãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹<a href="https://developer.apple.com/documentation/xctest">XCTest</a>ã«æ¯”ã¹ã‚‹ã¨
ç™–ãŒå°‘ã—å¼·ã„ã§ã™ã€‚ã¨ã£ã¤ãã«ãã„ã¨ã“ã‚ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãã“ã¾ã§é›£ã—ãã¯ãªã„ã®ã§æ°—ã«ãªã£ã¦ã„ã‚‹å ´åˆã¯æŒ‘æˆ¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚<br />
è‡ªåˆ†ã®ä½œã£ãŸã‚¢ãƒ—ãƒªãŒè‡ªå‹•ã§å‹•ãã®ã‚’è¦‹ã‚‹ã®ã‚‚æ¥½ã—ã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h2 id="reference">Reference</h2>
<ul>
  <li><a href="https://developer.android.com/training/testing/espresso">Espresso -  Android Developers</a></li>
  <li><a href="https://developer.android.com/training/testing/ui-automator">UI Automator - Android Developers</a></li>
</ul>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="https://ryoyakawai.com/blog/tags/#Android" title="Pages tagged Android" class="tag"><span class="term">Android</span></a><a href="https://ryoyakawai.com/blog/tags/#UI Test" title="Pages tagged UI Test" class="tag"><span class="term">UI Test</span></a><a href="https://ryoyakawai.com/blog/tags/#Espresso" title="Pages tagged Espresso" class="tag"><span class="term">Espresso</span></a><a href="https://ryoyakawai.com/blog/tags/#UI Automator" title="Pages tagged UI Automator" class="tag"><span class="term">UI Automator</span></a></span>
        <span>Updated on <span class="entry-date date updated"><time datetime="2019-07-18">July 18, 2019</time></span></span>
        <span class="author vcard"><span class="fn">Ryoya Kawai</span></span>
      </footer>
    </div><!-- /.entry-content -->

    <div class="read-more">
  
  <div class="read-more-header">
    <a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html" class="read-more-btn">Read More</a>
  </div><!-- /.read-more-header -->
  <div class="read-more-content">
    <h3 class="read-more-next"><a href="https://ryoyakawai.com/blog/2022/09/02/canele-marathon-04.html" title="ã‚«ãƒŒãƒ¬ãƒãƒ©ã‚½ãƒ³ ï¼ƒ4">ã‚«ãƒŒãƒ¬ãƒãƒ©ã‚½ãƒ³ ï¼ƒ4</a></h3>
    <span class="read-more-next">Published on September 02, 2022</span>
    <p> <a href="https://ryoyakawai.com/blog/2022/09/02/canele-marathon-04.html">Continue reading</a></p>
  </div><!-- /.read-more-content -->
  <!-- Adsense -->
  <!-- Here to paste Adsense -->
  <!-- Adsense -->
  
  <div class="read-more-list">
    
    <div class="list-item">
      <h4><a href="https://ryoyakawai.com/blog/2022/09/01/canele-marathon-02.html" title="ã‚«ãƒŒãƒ¬ãƒãƒ©ã‚½ãƒ³ ï¼ƒ2">ã‚«ãƒŒãƒ¬ãƒãƒ©ã‚½ãƒ³ ï¼ƒ2</a></h4>
      <span>Published on September 01, 2022</span>
    </div><!-- /.list-item -->
    
    <div class="list-item">
      <h4><a href="https://ryoyakawai.com/blog/2022/08/21/canele-marathon.html" title="ã‚«ãƒŒãƒ¬ãƒãƒ©ã‚½ãƒ³ã¯ã˜ã‚ã¾ã—ãŸ">ã‚«ãƒŒãƒ¬ãƒãƒ©ã‚½ãƒ³ã¯ã˜ã‚ã¾ã—ãŸ</a></h4>
      <span>Published on August 21, 2022</span>
    </div><!-- /.list-item -->
    
  </div><!-- /.read-more-list -->

</div><!-- /.read-more -->
 
    
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2022 Ryoya Kawai.</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://ryoyakawai.com/blog/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://ryoyakawai.com/blog/assets/js/scripts.min.js"></script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116678332-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116678332-1');
</script>



<!--
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ç¾å‘³ã—ã„æ¯æ—¥ã®ãƒ–ãƒ­ã‚°'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script'); s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
-->


	        

<script type="text/javascript" src="https://ryoyakawai.com/blog/assets/js/header-title-post.js"></script>

</body>
</html>

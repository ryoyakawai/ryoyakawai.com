<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>

<meta charset="utf-8">
<title>Delicious Days &#8211; Delicious Days</title>
<meta name="description" content="Ryoya Kawai's Life Blog">
<meta name="keywords" content="blog, ryoya, kawai, life">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://ryoyakawai.com/blog/images/background_sf_pano.jpg">

<meta name="twitter:description" content="Ryoya Kawai's Life Blog">


<!-- Open Graph -->
<meta property="og:locale" content="ja_JP">
<meta property="og:type" content="summary">
<meta property="og:image" content="https://ryoyakawai.com/blog/images/background_sf_pano_300x300.jpg">
<meta property="og:title" content="Delicious Days">
<meta property="og:description" content="Ryoya Kawai's Life Blog">
<meta property="og:url" content="https://ryoyakawai.com/blog/">
<meta property="og:site_name" content="Delicious Days">





<link rel="canonical" href="https://ryoyakawai.com/blog/">
<link href="https://ryoyakawai.com/blog/feed.xml" type="application/atom+xml" rel="alternate" title="Delicious Days Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://ryoyakawai.com/blog/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://ryoyakawai.com/blog/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Polymer -->
<script src="https://polygit.org/components/webcomponentsjs/webcomponents-loader.js"></script>
<link rel="import" href="https://ryoyakawai.com/blog/assets/components/youtube-play.html">
<link rel="import" href="https://ryoyakawai.com/blog/assets/components/language-selector.html">

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://ryoyakawai.com/blog/images/profile_photo.jpg">
<link rel="icon" type="image/jpeg" href="https://ryoyakawai.com/blog/images/profile_photo.jpg">



<!-- AdSense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9891854265132215",
    enable_page_level_ads: true
  });
</script>




  <link rel="stylesheet" type="text/css" href="https://ryoyakawai.com/blog/assets/css/header-title.css">
  <link rel="stylesheet" type="text/css" href="https://ryoyakawai.com/blog/assets/css/post.css">

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
   (adsbygoogle = window.adsbygoogle || []).push({
     google_ad_client: "ca-pub-9891854265132215",
     enable_page_level_ads: true
   });
  </script>
</head>

<body id="post-index" class="feature">

<!-- register service worker-->
<script type="text/javascript" src="register_sw.js"></script>

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="https://ryoyakawai.com/blog/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="https://ryoyakawai.com/blog/images/avatar.jpg" alt="Ryoya Kawai photo" class="author-photo">
					<h4>Ryoya Kawai</h4>
					<p></p>
				</li>
				<li><a href="https://ryoyakawai.com/blog/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:blog@ryoyakawai.com"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/ryoyakawai"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="https://facebook.com/ryoyakawai"><i class="fa fa-fw fa-facebook"></i> Facebook</a>
				</li>
				<li>
					<a href="https://google.com/+ryoyakawai"><i class="fa fa-fw fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="https://linkedin.com/in/ryoya-kawai-11342b57"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/ryoyakawai"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="https://ryoyakawai.com/blog/posts/">Order by Date</a></li>
				<li><a href="https://ryoyakawai.com/blog/tags/">Group By Tag</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  
  
    <div class="entry-image">
      <img class="entry-raw-image" src="https://ryoyakawai.com/blog/images/background_sf_pano.jpg">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1 class="header-title-text">Delicious Days</h1>
      <!--h2>Delicious Days</h2-->
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-08-04T00:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/08/04/pandaex-chowmein.html">August 04, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/08/04/pandaex-chowmein.html" rel="bookmark" title="ãƒ‘ãƒ³ãƒ€ã‚¨ã‚¯ã‚¹ãƒ—ãƒ¬ã‚¹ã®Chow Meinï¼ˆä¸­è¯é¢¨ç„¼ããã°ï¼‰é¢¨ãªãƒ¬ã‚·ãƒ”ã‚’è¿½åŠ ï¼" itemprop="url">ãƒ‘ãƒ³ãƒ€ã‚¨ã‚¯ã‚¹ãƒ—ãƒ¬ã‚¹ã®Chow Meinï¼ˆä¸­è¯é¢¨ç„¼ããã°ï¼‰é¢¨ãªãƒ¬ã‚·ãƒ”ã‚’è¿½åŠ ï¼</a></h1>
    
  </header>
  <div class="entry-content">
    <div> </div>

<p>ã‚„ã£ã¨è¿½åŠ ã®ã¿ã‚“ãªå¤§å¥½ããƒ‘ãƒ³ãƒ€ã‚¨ã‚¯ã‚¹ãƒ—ãƒ¬ã‚¹ã®ã€Œ<a href="https://cookpad.com/recipe/5771364">Chow Meinã€ã‚„ããã°ã€ãƒãƒ§ãƒ¼ãƒ¡ãƒ³</a>ã€ï¼ï¼<br />
è‡ªåˆ†ã§è¨€ã†ã®ã‚‚ã‚¢ãƒ¬ã§ã™ãŒã€ãƒ‘ãƒ³ãƒ€ã®ãã‚Œã‚ˆã‚Šã‚‚å°‘ã—ä¸Šå“ãªå‘³ã«ãªã£ã¦ã‚‹ã‹ã‚‚ğŸ˜…<br />
BBQã¨ã‹å®šç•ªã®ã€Œã‚½ãƒ¼ã‚¹ç„¼ããã°ã€ã«é£½ããŸã‚‰æ˜¯éï¼æˆ‘ãŒå®¶ã‚‚ã€Œç„¼ããã°ã€ã¯ã€Œã‚½ãƒ¼ã‚¹ã€ã ã£ãŸã®ãŒã€å¹…ãŒåºƒãŒã‚Šã¾ã—ãŸï¼<br />
ï¼ˆæœ¬å®¶ãƒ‘ãƒ³ãƒ€ã‚¨ã‚¯ã‚¹ãƒ—ãƒ¬ã‚¹ã®<a href="https://www.pandaexpress.com/menu/sides/chow-mein">Chow Meinã¯ã“ã¡ã‚‰</a>ï¼‰</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/08/20190804-chowmein_00.jpg" width="90%" style="border-radius:4px;" />
</div>

<h3 id="ç„¼ããã°-chowmein-ãƒãƒ§ãƒ¼ãƒ¡ãƒ³">ç„¼ããã°-ChowMein-ãƒãƒ§ãƒ¼ãƒ¡ãƒ³</h3>
<div class="post-image-center">
<script src="https://widgets.cookpad.com/recipes/5771364.js?k=fcd0a8a9" type="text/javascript"></script>
</div>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-07-25T00:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/07/25/ci-android-bitrise-00.html">July 25, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/07/25/ci-android-bitrise-00.html" rel="bookmark" title="Androidã‚¢ãƒ—ãƒªã‚’Bitriseã§CIã™ã‚‹ã€‚" itemprop="url">Androidã‚¢ãƒ—ãƒªã‚’Bitriseã§CIã™ã‚‹ã€‚</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="ã“ã‚Œã¯ä½•">ã“ã‚Œã¯ä½•ï¼Ÿ</h2>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®CircleCIã‚’Bitriseã«å¤‰æ›´ã—ãŸæ™‚ã®ãƒ¡ãƒ¢ã§ã™ã€‚<br />
Bitriseã®è¨­å®šã®ã¿ã‚’æ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã®ã§ã€è©³ç´°ã¯ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã‚’å¾¡è¦§ãã ã•ã„ã€‚</p>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>
<h3 id="bitrise">Bitrise</h3>
<p><a href="https://go.bitrise.io/bitrise-japan">Bitrise</a>ã¯CircleCIã¨åŒã˜ç¨®é¡ã®ã‚¯ãƒ©ã‚¦ãƒ‰å‹ã®CIã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚
ãƒ­ãƒ³ãƒ‰ãƒ³ã¨<a href="https://goo.gl/maps/Yi3Q5G6hDY6qgyAK8">ãƒ–ãƒ€ãƒšã‚¹ãƒˆï¼ˆãƒãƒ³ã‚¬ãƒªãƒ¼ï¼‰</a>ã«ã‚ªãƒ•ã‚£ã‚¹ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ã‚·ãƒªã‚³ãƒ³ãƒãƒ¬ãƒ¼ã˜ã‚ƒãªã„ã®ãŒæ–°é®®ã§ã—ãŸã€‚<br />
<br /></p>

<h4 id="ã§ãã‚‹ã“ã¨">ã§ãã‚‹ã“ã¨</h4>
<p>Bitriseã¯iOSã€Androidã€Swiftã€React Nativeã‚’ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€Androidã®ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã‚’ã¿ã¦ã„ãã¾ã™ã€‚</p>

<h4 id="ä¾¡æ ¼">ä¾¡æ ¼</h4>
<p><a href="https://www.bitrise.io/pricing/teams">è©³ã—ã„ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ã“ã¡ã‚‰</a>ã§ã™ã€‚å°ã•ãªçµ„ç¹”å‘ã‘ã¨ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºå‘ã‘ãŒç”¨æ„ã•ã‚Œã¦ã¾ã™ã€‚
å°ã•ãªçµ„ç¹”å‘ã‘ã®1éƒ¨ã¯ã“ã‚“ãªæ„Ÿã§ã™ã€‚ï¼ˆ2019å¹´7æœˆç¾åœ¨ï¼‰</p>
<ul>
  <li>Hobbyï¼ˆç„¡æ–™ï¼‰ï¼šè¤‡æ•°åŒæ™‚ãƒ“ãƒ«ãƒ‰ã¯ä¸å¯ã€ãƒ“ãƒ«ãƒ‰æ™‚é–“ã¯10åˆ†ã€æœˆã«200å›ãƒ“ãƒ«ãƒ‰ã¾ã§ã€ä½¿ãˆã‚‹ã®ã¯æ¨™æº–ãƒã‚·ãƒ¼ãƒ³ã€è¿½åŠ å¯èƒ½ãªãƒ¡ãƒ³ãƒãƒ¼ã¯2å</li>
  <li>Developerï¼ˆ$36/moï¼‰ï¼šè¤‡æ•°åŒæ™‚ãƒ“ãƒ«ãƒ‰ã¯ä¸å¯ã€ãƒ“ãƒ«ãƒ‰æ™‚é–“ã¯45åˆ†ã€ãƒ“ãƒ«ãƒ‰å›æ•°ã¯ç„¡åˆ¶é™ã€ä½¿ãˆã‚‹ã®ã¯æ¨™æº–ãƒã‚·ãƒ¼ãƒ³ã€ãƒ¡ãƒ³ãƒãƒ¼ã®ç„¡åˆ¶é™è¿½åŠ å¯èƒ½</li>
</ul>

<h2 id="ã•ã£ããä½¿ã£ã¦ã¿ã‚‹">ã•ã£ããä½¿ã£ã¦ã¿ã‚‹</h2>
<p>GitHubã¨Bitriseã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒå¿…é ˆã§ã™ã®ã§ã”ç”¨æ„ã—ã¦ãã ã•ã„ã€‚<br />
ã“ã®è¨˜äº‹ã§ã¯<a href="https://github.com/ryoyakawai/uitest_sample_android/">ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰</a>ã‚’ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ä½¿ã„ã¾ã™ã®ã§ã€
Forkã‚‚ã—ãã¯Cloneã—ã¦ãƒªãƒã‚¸ãƒˆãƒªã«è¿½åŠ ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚<br />
ãã‚Œã§ã¯è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚</p>

<h3 id="ã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã™ã‚‹">ã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã™ã‚‹</h3>
<p>ä¸‹å³å›³ã®ã‚ˆã†ã«ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ãªã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’æŒ‡å®šã—ã¦ã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190726_bitrise_00.png" width="48%" style="border-radius:4px; border:1px solid #eeeeee; margin-right: 5px" />
<img src="https://ryoyakawai.com/blog/images/2019/07/20190726_bitrise_01.png" width="48%" />
</div>

<h3 id="workflowã®è¨­å®šç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹">Workflowã®è¨­å®šç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹</h3>
<p>ã‚¢ãƒ—ãƒªã®è¿½åŠ ãŒå®Œäº†ã™ã‚‹ã¨åŒæ™‚ã«ãƒ“ãƒ«ãƒ‰ã‚’èµ°ã‚‰ã›ã¦ãã‚Œã¾ã™ã€‚<br />
ãŒã€å–ã‚Šæ€¥ãWorkflowã®è¨­å®šç”»é¢ã‚’é–‹ã„ã¦ã—ã¾ã„ã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆä¸‹å›³(1)ï¼‰ã—ã¦
æ¬¡ã«Workflowã®ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆä¸‹å›³(2)ï¼‰ã—ã¦è¡¨ç¤ºã—ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190726_bitrise_workflow00.png" width="80%" style="border-radius:4px; border:1px solid #eeeeee;" />
</div>

<h3 id="ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã™ã‚‹">ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ ã™ã‚‹</h3>
<p>ã‚¢ãƒ—ãƒªã‚’è¿½åŠ ã—ãŸçŠ¶æ…‹ã§ã¯UIãƒ†ã‚¹ãƒˆã¯è¿½åŠ ã•ã‚Œã¾ã›ã‚“ã®ã§ã€UIãƒ†ã‚¹ãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
è¿½åŠ ã™ã‚‹ã‚¿ã‚¹ã‚¯ã¯ä»¥ä¸‹ã®2ã¤ã§ã™ã€‚</p>

<ul>
  <li>Gradle Runner</li>
  <li>[BETA] Virtual Device Testing for Android</li>
</ul>

<p>èµ¤å››è§’ã®ä¸­ã®2ã¤ã‚’è¿½åŠ ã™ã‚‹ã€‚</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190725_bitrise_addtask00.png" width="30%" style="border-radius:4px; border:1px solid #eeeeee;" />
</div>

<h4 id="-gradle-runnerã®è¿½åŠ ">ï¼ Gradle Runnerã®è¿½åŠ </h4>
<p><strong>Android Unit Test</strong> ã®ã‚¢ã‚¤ã‚³ãƒ³ã®ç›´ä¸‹ã«ã‚ã‚‹ã€Œï¼‹ã€ãƒœã‚¿ãƒ³ï¼ˆä¸‹å›³ï¼ˆ1ï¼‰ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã€ŒGradle Runnerã€ã§æ¤œç´¢ã™ã‚‹ã¨çµè¾¼ã¾ã‚Œã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§
ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚ï¼ˆä¸‹å›³(2)ï¼‰</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190726_bitrise_gradlerunner00.png" width="80%" style="border-radius:4px; border:1px solid #eeeeee;" />
</div>

<p>è¿½åŠ ã™ã‚‹ã¨è¨­å®šç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ä»¥ä¸‹ã®2ã¤ã®å››è§’ã‚’å¤‰æ›´ã—ã¾ã™ã€‚</p>

<ul>
  <li><strong>Gradle task to run</strong> ï¼š <code class="highlighter-rouge">assembleDebug assembleDebugAndroidTest</code></li>
  <li><strong>gradlew file path</strong> ï¼š <code class="highlighter-rouge">./gradlew</code></li>
</ul>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190726_bitrise_gradlerunner01.png" width="80%" style="border-radius:4px; border:1px solid #eeeeee;" />
</div>

<h4 id="-beta-virtual-device-testing-for-androidã®è¿½åŠ ">ï¼ [BETA] Virtual Device Testing for Androidã®è¿½åŠ </h4>
<p>å…ˆç¨‹è¿½åŠ ã—ãŸ<strong>Gradle Runner</strong> ã®æ¬¡ã«è¿½åŠ ã—ã¾ã™ã®ã§ã€ç›´ä¸‹ã«ã‚ã‚‹ã€Œï¼‹ã€ãƒœã‚¿ãƒ³ï¼ˆä¸‹å›³ï¼ˆ1ï¼‰ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ã€Œ[BETA] Virtualã€ã§æ¤œç´¢ã—ã¾ã™ã€‚ã™ã‚‹ã¨çµè¾¼ã¾ã‚Œã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§
ã‚¯ãƒªãƒƒã‚¯ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚ï¼ˆä¸‹å›³(2)ï¼‰</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190726_bitrise_virtualdevice00.png" width="80%" style="border-radius:4px; border:1px solid #eeeeee;" />
</div>

<p>è¿½åŠ ã™ã‚‹ã¨è¨­å®šç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã®ã§ä»¥ä¸‹ã®2ã¤ã®å››è§’ã‚’å¤‰æ›´ã—ã¾ã™ã€‚</p>

<ul>
  <li><strong>Test devices</strong> ï¼š <code class="highlighter-rouge">Pixel2,28,en,portrait</code></li>
  <li><strong>Test type</strong> ï¼š <code class="highlighter-rouge">instrumentation</code></li>
</ul>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190726_bitrise_virtualdevice01.png" width="80%" style="border-radius:4px; border:1px solid #eeeeee;" />
</div>

<p>ãªãŠã€<strong>Test devices</strong> ã¯ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã« <code class="highlighter-rouge">minSdkVersion 26</code> ã¨æŒ‡å®šã—ã¦ã„ã‚‹ã®ã§26ä»¥ä¸Šã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚<br />
ã¾ãŸã€å…ˆç¨‹å¤‰æ›´ã—ãŸ <strong>Gradle Runner</strong> ã® <strong>Gradle task to run</strong> ã® <code class="highlighter-rouge">assembleDebug assembleDebugAndroidTest</code> ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® <code class="highlighter-rouge">assemble</code> ã®ã¾ã¾ã«ãªã£ã¦ã„ã‚‹ã¨
ãƒ†ã‚¹ãƒˆç”¨ã®APK(<code class="highlighter-rouge">app-debug-androidTest.apk</code>)ãŒä½œæˆã•ã‚Œãšã€<strong>API path</strong> ã§ä½¿ã†ç’°å¢ƒå¤‰æ•°ã® <strong>$BITRISE_APK_PATH</strong> ã« <code class="highlighter-rouge">app-release-unsigned.apk</code>ç­‰ã«æŒ‡å®šã‚ã‚Œã¦ã—ã¾ã„
<strong>[BETA] Virtual Device Testing for Android</strong> ãŒå‹•ä½œã§ããšã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã®ã§ã€ç¢ºå®Ÿã«å¤‰æ›´ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚</p>

<p>ã¡ãªã¿ã«ã€ã“ã® <strong>[BETA] Virtual Device Testing for Android</strong> ã¯ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html">Firebase Test Labã§UI Testã‚’å®Ÿè¡Œã™ã‚‹</a>ã€
ã§ã‚‚ç´¹ä»‹ã—ã¦ã„ã‚‹ã®ã¨åŒã˜ãGCPã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰ <a href="https://console.cloud.google.com/marketplace/details/google/testing.googleapis.com">Cloud Testing API(Firebase Test Lab)</a> ã‚’ãƒ©ãƒƒãƒ—ã—ã¦ä½¿ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚</p>

<h3 id="å®Ÿè¡Œã™ã‚‹">å®Ÿè¡Œã™ã‚‹</h3>
<p>ä»¥ä¸Šã§UI Testã¾ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã¯ãšãªã®ã§ç”»é¢å†…ã«ã‚ã‚‹ <strong>[Start/Schedule a Build]</strong> ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190726_bitrise_start_button00.png" width="30%" style="border-radius:4px; border:1px solid #eeeeee;" />
</div>

<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>ã‚¬ã‚¬ã£ã¨ãƒªãƒã‚¸ãƒˆãƒªã‚’èª­ã‚“ã§ã€è¨­å®šä½œã£ã¦ãã‚Œã‚‹ã¨ã“ã‚ã¯æ¥½ãƒãƒ³ã§ã‚ˆã‹ã£ãŸã§ã™ãŒã€
<strong>Gradle Runner</strong> ã® <strong>Gradle task to run</strong>  ç’°å¢ƒå¤‰æ•° <strong>$BITRISE_APK_PATH</strong> ã®è¨­å®šã§
ãƒãƒã‚Šã¾ã—ãŸã€‚Firebase Test Labã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦‹ã‚‰ã‚Œã‚‹ã¨è‰¯ã„ã‹ã‚‚ãªã€œã€ã¨æ„Ÿã˜ã¦ã„ã¾ã™ã€‚</p>

<h4 id="ä»Šå›ã®bitriseyml">ä»Šå›ã®<code class="highlighter-rouge">bitrise.yml</code></h4>
<p>ä»Šå›ã§ãã‚ãŒã£ãŸ <code class="highlighter-rouge">bitrise.yml</code> ã‚‚ã‚³ã‚³ã«è²¼ã£ã¦ãŠãã¾ã™ã€‚å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚</p>

<div class="language-yml highlighter-rouge"><pre class="highlight"><code><span class="nn">---</span>
<span class="s">format_version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">8'</span>
<span class="s">default_step_lib_source</span><span class="pi">:</span> <span class="s">https://github.com/bitrise-io/bitrise-steplib.git</span>
<span class="s">project_type</span><span class="pi">:</span> <span class="s">android</span>
<span class="s">trigger_map</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">push_branch</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
  <span class="s">workflow</span><span class="pi">:</span> <span class="s">primary</span>
<span class="pi">-</span> <span class="s">pull_request_source_branch</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
  <span class="s">workflow</span><span class="pi">:</span> <span class="s">primary</span>
<span class="s">workflows</span><span class="pi">:</span>
  <span class="s">deploy</span><span class="pi">:</span>
    <span class="s">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">activate-ssh-key@4.0.3</span><span class="pi">:</span>
        <span class="s">run_if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">'</span>
    <span class="pi">-</span> <span class="s">git-clone@4.0.14</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="pi">-</span> <span class="s">cache-pull@2.0.1</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="pi">-</span> <span class="s">script@1.1.5</span><span class="pi">:</span>
        <span class="s">title</span><span class="pi">:</span> <span class="s">Do anything with Script step</span>
    <span class="pi">-</span> <span class="s">install-missing-android-tools@2.3.5</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">gradlew_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$PROJECT_LOCATION/gradlew"</span>
    <span class="pi">-</span> <span class="s">change-android-versioncode-and-versionname@1.1.1</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">build_gradle_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$PROJECT_LOCATION/$MODULE/build.gradle"</span>
    <span class="pi">-</span> <span class="s">android-lint@0.9.6</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">project_location</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$PROJECT_LOCATION"</span>
        <span class="pi">-</span> <span class="s">module</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$MODULE"</span>
        <span class="pi">-</span> <span class="s">variant</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$VARIANT"</span>
    <span class="pi">-</span> <span class="s">android-unit-test@0.11.1</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">project_location</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$PROJECT_LOCATION"</span>
        <span class="pi">-</span> <span class="s">module</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$MODULE"</span>
        <span class="pi">-</span> <span class="s">variant</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$VARIANT"</span>
    <span class="pi">-</span> <span class="s">android-build@0.10.0</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">project_location</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$PROJECT_LOCATION"</span>
        <span class="pi">-</span> <span class="s">module</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$MODULE"</span>
        <span class="pi">-</span> <span class="s">variant</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$VARIANT"</span>
    <span class="pi">-</span> <span class="s">sign-apk@1.3.1</span><span class="pi">:</span>
        <span class="s">run_if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">'</span>
    <span class="pi">-</span> <span class="s">deploy-to-bitrise-io@1.6.0</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="pi">-</span> <span class="s">cache-push@2.2.0</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="s">primary</span><span class="pi">:</span>
    <span class="s">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">activate-ssh-key@4.0.3</span><span class="pi">:</span>
        <span class="s">run_if</span><span class="pi">:</span> <span class="s1">'</span><span class="s">'</span>
    <span class="pi">-</span> <span class="s">git-clone@4.0.14</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="pi">-</span> <span class="s">cache-pull@2.0.1</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="pi">-</span> <span class="s">script@1.1.5</span><span class="pi">:</span>
        <span class="s">title</span><span class="pi">:</span> <span class="s">Do anything with Script step</span>
    <span class="pi">-</span> <span class="s">install-missing-android-tools@2.3.5</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">gradlew_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$PROJECT_LOCATION/gradlew"</span>
    <span class="pi">-</span> <span class="s">android-lint@0.9.6</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">project_location</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$PROJECT_LOCATION"</span>
        <span class="pi">-</span> <span class="s">module</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$MODULE"</span>
        <span class="pi">-</span> <span class="s">variant</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$VARIANT"</span>
    <span class="pi">-</span> <span class="s">android-unit-test@0.11.1</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">project_location</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$PROJECT_LOCATION"</span>
        <span class="pi">-</span> <span class="s">module</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$MODULE"</span>
        <span class="pi">-</span> <span class="s">variant</span><span class="pi">:</span> <span class="s2">"</span><span class="s">$VARIANT"</span>
    <span class="pi">-</span> <span class="s">gradle-runner@1.9.0</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">gradlew_path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">./gradlew"</span>
        <span class="pi">-</span> <span class="s">gradle_task</span><span class="pi">:</span> <span class="s">assembleDebug assembleDebugAndroidTest</span>
    <span class="pi">-</span> <span class="s">virtual-device-testing-for-android@1.0.5</span><span class="pi">:</span>
        <span class="s">inputs</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">test_type</span><span class="pi">:</span> <span class="s">instrumentation</span>
        <span class="pi">-</span> <span class="s">test_devices</span><span class="pi">:</span> <span class="s">Pixel2,28,en,portrait</span>
    <span class="pi">-</span> <span class="s">deploy-to-bitrise-io@1.6.0</span><span class="pi">:</span> <span class="pi">{}</span>
    <span class="pi">-</span> <span class="s">cache-push@2.2.0</span><span class="pi">:</span> <span class="pi">{}</span>
<span class="s">app</span><span class="pi">:</span>
  <span class="s">envs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">opts</span><span class="pi">:</span>
      <span class="s">is_expand</span><span class="pi">:</span> <span class="s">false</span>
    <span class="s">PROJECT_LOCATION</span><span class="pi">:</span> <span class="s2">"</span><span class="s">."</span>
  <span class="pi">-</span> <span class="s">opts</span><span class="pi">:</span>
      <span class="s">is_expand</span><span class="pi">:</span> <span class="s">false</span>
    <span class="s">MODULE</span><span class="pi">:</span> <span class="s">app</span>
  <span class="pi">-</span> <span class="s">opts</span><span class="pi">:</span>
      <span class="s">is_expand</span><span class="pi">:</span> <span class="s">false</span>
    <span class="s">VARIANT</span><span class="pi">:</span> <span class="s1">'</span><span class="s">'</span>
</code></pre>
</div>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-07-18T00:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/07/18/ci-android-espresso-00.html">July 18, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/07/18/ci-android-espresso-00.html" rel="bookmark" title="Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã" itemprop="url">Espresso, UI Automatorã§Androidã®UI Testã‚’æ›¸ã</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="ã“ã‚Œã¯ä½•">ã“ã‚Œã¯ä½•ï¼Ÿ</h2>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®UI Testã®æ›¸ãæ–¹ã«ã¤ã„ã¦èª¬æ˜ã—ãŸè¨˜äº‹ã§ã™ã€‚
å…·ä½“çš„ã«ã¯<a href="https://github.com/ryoyakawai/uitest_sample_android">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª</a>ã®<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">UI Testã§ã‚ã‚‹ã“ã‚Œ</a>ã®èª¬æ˜ã§ã™ã€‚</p>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>
<h3 id="androidã§ui-testã‚’æ›¸ã">Androidã§UI Testã‚’æ›¸ã</h3>
<p>AndroidãŒå…¬å¼ã«ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹UI Testã®ãƒ„ãƒ¼ãƒ«ã¯ <a href="https://developer.android.com/training/testing/espresso">Espresso</a>ã€
<a href="https://developer.android.com/training/testing/ui-automator">UI Automator</a> ã®2ç¨®é¡ã‚ã‚Šã¾ã™ã€‚
ãã‚Œãã‚Œä»¥ä¸‹ã®ç‰¹å¾´ãŒã‚ã‚Šã¾ã™ã®ã§ã€Œã©ã¡ã‚‰ã‚’ä½¿ã†ã‹ï¼Ÿã€ã«ã¤ã„ã¦ã¯ã€Œã©ã¡ã‚‰ã‚‚ä½µç”¨ã—ã¦ä½¿ã†ã€ã®ãŒã„ã„ã‚ˆã†ã«æ„Ÿã˜ã¦ã„ã¾ã™ã€‚</p>

<h4 id="espresso">Espresso</h4>
<p>ã€Œto write concise, beautiful, and reliable Android UI testsã€ã¨å…¬å¼ã‚µã‚¤ãƒˆã«ã¯èª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹å®šã®ã‚¢ãƒ—ãƒªã®UIã«å¯¾ã—ã¦ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹•ä½œã‚’ã•ã›ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚å˜ä¸€ã®ã‚¢ãƒ—ãƒªã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹å ´åˆã«ä½¿ã†ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚Googleç¤¾ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã®ã§ã€Anroidã®å…¬å¼ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¨è¨€ã£ã¦ã‚ˆã„ã§ã—ã‚‡ã†ã€‚<br />
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ã‚¢ãƒ—ãƒªã®æ“ä½œã®ã™ã¹ã¦ã‚’Espressoã§æ›¸ã„ã¦ã„ã¾ã™ã€‚</p>

<h4 id="ui-automator">UI Automator</h4>
<p>ã€Œsuitable for cross-app functional UI testing across system and installed apps.ã€ã¨å…¬å¼ã‚µã‚¤ãƒˆã«èª¬æ˜ã•ã‚Œã¦ã„ã‚‹é€šã‚Šã§ã€Espressoã¨æ¯”ã¹ã‚‹ã¨ã€ã‚ˆã‚ŠAndroidã®OSã«è¿‘ã„å´ã«ä½ç½®ã—ã¦ã„ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã€è¤‡æ•°ã‚¢ãƒ—ãƒªã‚’è¡Œãæ¥ã™ã‚‹ã‚ˆã†å‹•ä½œã‚’ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å®šç¾©ã™ã‚‹ã“ã¨ã®å¯èƒ½ã§ã™ã€‚Espressoã¨ã¯é•ã„ã€è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã®æ“ä½œã‚’è‡ªå‹•åŒ–ã™ã‚‹å ´åˆã«ä½¿ã†ã¨ã‚ˆã„ã§ã—ã‚‡ã†ã€‚ã“ã¡ã‚‰ã‚‚Espressoã¨åŒã˜ãGoogleç¤¾ãŒé–‹ç™ºã—ã¦ã„ã¾ã™ã®ã§ã€Anroidã®å…¬å¼ã®ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã¨è¨€ã£ã¦ã‚ˆã„ã§ã—ã‚‡ã†ã€‚<br />
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®æ’®å½±ã€Permissionãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®æ“ä½œã®2ã¤ã‚’UI Automatorã§æ›¸ã„ã¦ã„ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-uitesttool_00.png" width="50%" />
</div>

<h3 id="espressoui-automatorã§testã‚’æ›¸ãæº–å‚™ã‚’ã™ã‚‹">Espressoã€UI Automatorã§Testã‚’æ›¸ãæº–å‚™ã‚’ã™ã‚‹</h3>
<p>ä»¥ä¸‹ã®2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã—ã¦æº–å‚™å®Œäº†ã§ã™ã€‚</p>

<h4 id="-buildgradle-ã«ä»¥ä¸‹ã‚’è¿½åŠ ">ï¼ <code class="highlighter-rouge">build.gradle</code> ã«ä»¥ä¸‹ã‚’è¿½åŠ </h4>
<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="o">....</span>
<span class="n">allprojects</span> <span class="p">{</span>
<span class="o">....</span>
  <span class="n">tasks</span><span class="p">.</span><span class="n">matching</span> <span class="p">{</span><span class="n">it</span> <span class="n">instanceof</span> <span class="n">Test</span><span class="p">}.</span><span class="n">all</span> <span class="p">{</span>
    <span class="n">testLogging</span><span class="p">.</span><span class="n">events</span> <span class="p">=</span> <span class="p">[</span><span class="s">"failed"</span><span class="p">,</span> <span class="s">"passed"</span><span class="p">,</span> <span class="s">"skipped"</span><span class="p">]</span>
  <span class="p">}</span>
<span class="o">....</span>
<span class="p">}</span>
<span class="o">....</span>
</code></pre>
</div>

<h4 id="-appbuildgradle-ã«ä»¥ä¸‹ã‚’è¿½åŠ "><code class="highlighter-rouge">ï¼ app/build.gradle</code> ã«ä»¥ä¸‹ã‚’è¿½åŠ </h4>
<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="o">....</span>
<span class="n">dependencies</span> <span class="p">{</span>
<span class="o">....</span>
  <span class="c1">// for connected Android test
</span>  <span class="n">androidTestUtil</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">:</span><span class="n">orchestrator</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">:</span><span class="n">runner</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">espresso</span><span class="p">:</span><span class="n">espresso</span><span class="p">-</span><span class="n">core</span><span class="p">:</span><span class="m">3.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">espresso</span><span class="p">:</span><span class="n">espresso</span><span class="p">-</span><span class="n">intents</span><span class="p">:</span><span class="m">3.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">.</span><span class="n">uiautomator</span><span class="p">:</span><span class="n">uiautomator</span><span class="p">-</span><span class="n">v18</span><span class="p">:</span><span class="m">2.1</span><span class="p">.</span><span class="m">3</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">test</span><span class="p">:</span><span class="n">rules</span><span class="p">:</span><span class="m">1.0</span><span class="p">.</span><span class="m">2</span><span class="err">'</span>
  <span class="n">androidTestImplementation</span> <span class="err">'</span><span class="n">junit</span><span class="p">:</span><span class="n">junit</span><span class="p">:</span><span class="m">4.12</span><span class="err">'</span>
<span class="o">....</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="ãƒ†ã‚¹ãƒˆã‚’æ›¸ã">ãƒ†ã‚¹ãƒˆã‚’æ›¸ã</h3>
<p>ãƒ†ã‚¹ãƒˆã¯<code class="highlighter-rouge">app/src/androidTest/[Packageå]</code>ä»¥ä¸‹ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚<br />
ä»Šå›ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã¯ <code class="highlighter-rouge">com.example.uitestsample</code> 
ã§ã™ã®ã§ <a href="app/src/androidTest/java/com/example/uitestsample/"><code class="highlighter-rouge">app/src/androidTest/java/com/example/uitestsample/</code></a>
ä»¥ä¸‹ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚<br />
ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã®ç²’åº¦ã¯Activityæ¯ã€Fragmentæ¯ã€æ©Ÿèƒ½æ¯ç­‰ã€è‡ªç”±ã«ã¾ã¨ã‚ã¦ã—ã¾ã£ã¦å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯Activityæ¯ã§ã¾ã¨ã‚ã¦<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">MainActivityInstrumentedTest.kt</a>ã«æ›¸ã„ã¦ã„ã¾ã™ã€‚</p>

<h4 id="å‰æº–å‚™">å‰æº–å‚™</h4>
<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="n">@RunWith</span><span class="p">(</span><span class="n">AndroidJUnit4</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="n">@SdkSuppress</span><span class="p">(</span><span class="n">minSdkVersion</span> <span class="p">=</span> <span class="m">26</span><span class="p">)</span>
<span class="n">@LargeTest</span>
<span class="kd">class</span> <span class="nc">MainActivityInstrumentedTest</span> <span class="p">{</span>

    <span class="k">private</span> <span class="kd">val</span> <span class="py">_packageName</span> <span class="p">=</span> <span class="s">"com.example.uitestsample"</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">mUTs</span><span class="p">:</span> <span class="n">UiTestUtils</span> <span class="p">=</span> <span class="n">UiTestUtils</span><span class="p">()</span>
    <span class="c1">// ^^^ ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ– ^^^
</span>
    <span class="n">@Rule</span>
    <span class="n">@JvmField</span>
    <span class="kd">val</span> <span class="py">mActivityTestRule</span><span class="p">:</span> <span class="n">ActivityTestRule</span><span class="p">&lt;</span><span class="n">MainActivity</span><span class="p">&gt;</span> <span class="p">=</span>
        <span class="n">ActivityTestRule</span><span class="p">(</span><span class="n">MainActivity</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span>

    <span class="n">@Rule</span>
    <span class="n">@JvmField</span>
    <span class="kd">val</span> <span class="py">cGrantPermissionRule</span><span class="p">:</span> <span class="n">GrantPermissionRule</span> <span class="p">=</span>
        <span class="n">GrantPermissionRule</span><span class="p">.</span><span class="n">grant</span><span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="n">Manifest</span><span class="p">.</span><span class="n">permission</span><span class="p">.</span><span class="n">WRITE_EXTERNAL_STORAGE</span><span class="p">)</span>
    <span class="c1">// ^^^ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä¿å­˜ã®ç‚ºã«STORAGEã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¼·åˆ¶çš„ã«è¨±å¯ ^^^
</span>
    <span class="n">@Rule</span>
    <span class="n">@JvmField</span>
    <span class="kd">val</span> <span class="py">screenshotRule</span> <span class="p">=</span> <span class="n">ScreenshotTakingRule</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">)</span>
    <span class="c1">// ^^^ Testå¤±æ•—æ™‚ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±ã™ã‚‹ã‚ˆã†ã«æŒ‡å®š ^^^
</span>
    <span class="n">@Before</span>
    <span class="k">fun</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">setActivity</span><span class="p">(</span><span class="n">mActivityTestRule</span><span class="p">.</span><span class="n">activity</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="n">@After</span>
    <span class="k">fun</span> <span class="nf">teardown</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>

<span class="o">....</span>

<span class="p">}</span>
</code></pre>
</div>
<p>ã€ŒTestå¤±æ•—æ™‚ã‚’ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ã®å‹•ä½œã¯ <code class="highlighter-rouge">uitestutils/UiTestUtils.kt</code> ã®æœ€å¾Œã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="o">....</span>
<span class="kd">class</span> <span class="nc">ScreenshotTakingRule</span><span class="p">(</span><span class="n">mUTs</span><span class="p">:</span> <span class="n">UiTestUtils</span><span class="p">)</span> <span class="p">:</span> <span class="n">TestWatcher</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">mUTs</span> <span class="p">=</span> <span class="n">mUTs</span>

    <span class="k">override</span> <span class="k">fun</span> <span class="nf">failed</span><span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="n">Throwable</span><span class="p">?,</span> <span class="n">description</span><span class="p">:</span> <span class="n">org</span><span class="p">.</span><span class="n">junit</span><span class="p">.</span><span class="n">runner</span><span class="p">.</span><span class="n">Description</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="n">failed</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="kd">val</span> <span class="py">path</span> <span class="p">=</span> <span class="n">mUTs</span><span class="p">.</span><span class="n">screenShot</span><span class="p">(</span><span class="s">"FAIL-$description"</span><span class="p">)</span>
        <span class="n">mUTs</span><span class="p">.</span><span class="n">log_d</span><span class="p">(</span><span class="s">"&gt;&gt;&gt; !!! TEST FAILED !!! &lt;&lt;&lt; ScreenShot Taken method=[$description] filename=[$path]"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre>
</div>
<h4 id="ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹">ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹</h4>
<p>ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã§ã¯ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã¯ä»¥ä¸‹ã®3ã¤ã§ã™ã€‚
ã€Œã‚±ãƒ¼ã‚¹ã¨ã—ã¦è¶³ã‚Šãªã„ï¼ã€ã¨ã‹ãƒ„ãƒƒã‚³ãƒŸã¯ã‚ã‚Šã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€UI Testã‚’å‹•ã‹ã™ã“ã¨ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã®ã§ã”å®¹èµ¦ãã ã•ã„ã€‚</p>

<ul>
  <li><code class="highlighter-rouge">useAppContext()</code>ï¼šãƒ†ã‚¹ãƒˆã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åã‚’ç¢ºèª</li>
  <li><code class="highlighter-rouge">checkTextHelloWorld()</code>ï¼šã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã€ä¸­å¿ƒã®ã€ŒHello World!ã€ã®è¡¨ç¤ºã‚’ç¢ºèª</li>
  <li><code class="highlighter-rouge">checkButtonIncrementFloating()</code>ï¼šç”»é¢å³ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨è¡¨ç¤ºã—ã¦ã„ã‚‹æ•°å­—ãŒã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—SnackbarãŒè¡¨ç¤ºã•ã‚Œã€ã¾ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰Resetã™ã‚‹ã¨ã‚¼ãƒ­ã«ãªã‚‹ã“ã¨ã‚’ç¢ºèª</li>
</ul>

<p><code class="highlighter-rouge">checkButtonIncrementFloating()</code> ã®ãƒã‚¤ãƒ³ãƒˆã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§èª¬æ˜ã—ã¾ã™ã€‚<br />
<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">Testã®ã‚³ãƒ¼ãƒ‰å…¨ä½“ã¯ã“ã¡ã‚‰</a>ã«ãªã‚Šã¾ã™ã®ã§åˆã‚ã›ã¦å¾¡è¦§ãã ã•ã„ã€‚</p>
<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="o">....</span>
<span class="n">@Test</span>
<span class="k">fun</span> <span class="nf">checkButtonIncrementFloating</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// false ã«ã™ã‚‹ã“ã¨ã§TestãŒæˆåŠŸã—ãŸå ´åˆã§ã‚‚ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ®‹ã›ã¾ã™ã€‚
</span>    <span class="c1">// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€TestãŒæˆåŠŸã™ã‚‹ã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã¯å…¨å‰Šé™¤ã¨ãªã‚Šã¾ã™ã€‚
</span>    <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">prepareScreenShot</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>

<span class="o">....</span>

    <span class="kd">val</span> <span class="py">willTap</span> <span class="p">=</span> <span class="m">5</span>
    <span class="c1">// å³ä¸‹ã®èµ¤è‰²ã®Fabã‚’æŒ‡å®š
</span>    <span class="kd">val</span> <span class="py">incrementButton</span> <span class="p">=</span>  <span class="n">withId</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">increment_fab_text</span><span class="p">)</span>

    <span class="c1">// ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’å¢—åŠ ã•ã›ã¦è¡¨ç¤ºãŒæƒ³å®šé€šã‚Šã§ã‚ã‚‹ã‹ç¢ºèªã™ã‚‹
</span>    <span class="k">for</span><span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">1</span><span class="o">..</span><span class="n">willTap</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±
</span>        <span class="n">mUTs</span><span class="p">.</span><span class="n">screenShot</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"BEFORE &gt;&gt;&gt; ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼šã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ IDX=[$i]"</span><span class="p">)</span>
        <span class="c1">// æŒ‡å®šã—ãŸèµ¤è‰²ã®Fabã‚’ã‚¿ãƒƒãƒ—
</span>        <span class="n">onView</span><span class="p">(</span><span class="n">incrementButton</span><span class="p">).</span><span class="n">perform</span><span class="p">(</span><span class="n">click</span><span class="p">())</span>

        <span class="c1">// Permissionãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå‡ºã¦ãŸã‚‰è¨±å¯ï¼ˆã“ã®ãƒ†ã‚¹ãƒˆä¸­ã¯å‡ºãªã„ã¯ãšï¼‰
</span>        <span class="n">mUTs</span><span class="p">.</span><span class="n">allowPermissionsIfNeeded</span><span class="p">()</span>

        <span class="c1">// ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’æ’®å½±
</span>        <span class="n">mUTs</span><span class="p">.</span><span class="n">screenShot</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"AFTER &gt;&gt;&gt; ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼šã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ IDX=[$i]"</span><span class="p">)</span>
        <span class="c1">// è¦ç´ å†…ã®æ–‡å­—åˆ—ã‚’å–å¾—
</span>        <span class="n">actualCount</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">getText</span><span class="p">(</span><span class="n">withId</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">main_content_text</span><span class="p">))</span>
        <span class="c1">// ãƒ­ã‚°ã‚’æ®‹ã™
</span>        <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">log_d</span><span class="p">(</span><span class="s">"[Counter SEQ] ğŸğŸ expected=[$i] actual=[$actualCount]"</span><span class="p">)</span>
        <span class="c1">// æ–‡å­—åˆ—ã‚’Assert
</span>        <span class="n">assertEquals</span><span class="p">(</span><span class="s">"[Counter SEQ] ğŸğŸ"</span><span class="p">,</span> <span class="n">i</span><span class="p">.</span><span class="n">toString</span><span class="p">(),</span> <span class="n">actualCount</span><span class="p">)</span>

        <span class="c1">// Snackbarã®æ–‡è¨€ãƒã‚§ãƒƒã‚¯
</span>        <span class="kd">val</span> <span class="py">snackBarTapped</span> <span class="p">=</span> <span class="n">allOf</span><span class="p">(</span><span class="n">withId</span><span class="p">(</span><span class="n">android</span><span class="p">.</span><span class="n">support</span><span class="p">.</span><span class="n">design</span><span class="p">.</span><span class="n">R</span><span class="p">.</span><span class="n">id</span><span class="p">.</span><span class="n">snackbar_text</span><span class="p">),</span> <span class="n">withText</span><span class="p">(</span><span class="s">"Tapped $i times."</span><span class="p">))</span>
        <span class="c1">// SnackbarãŒã‹ã‚‰æ¶ˆãˆã‚‹ã®ã‚’å¾…ã¤
</span>        <span class="n">waitForSnackbarDisappear</span><span class="p">(</span><span class="n">snackBarTapped</span><span class="p">)</span>
        <span class="c1">// Sleepã™ã‚‹
</span>        <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="s">"SHR"</span><span class="p">)</span>
    <span class="p">}</span>

<span class="o">....</span>

    <span class="c1">// this.mUTs.prepareScreenShot() ã« false ã‚’ã‚»ãƒƒãƒˆã—ã¦ã„ãªã‘ã‚Œã°
</span>    <span class="c1">// ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å‰Šé™¤ã™ã‚‹ï¼ˆï¼‰
</span>    <span class="k">this</span><span class="p">.</span><span class="n">mUTs</span><span class="p">.</span><span class="n">removeSuccessScreenShots</span><span class="p">()</span>

<span class="o">....</span>

<span class="p">}</span>
<span class="o">....</span>
</code></pre>
</div>

<h3 id="idãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®æŒ‡å®šæ–¹æ³•">IDãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã®æŒ‡å®šæ–¹æ³•</h3>
<p>ã‚¨ãƒ¬ãƒ¡ãƒ³ãƒˆã«å¯¾ã—ã¦IDãŒæŒ¯ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã¯å¤§æŠµã®å ´åˆãã®IDã‚’ä½¿ã†ã“ã¨ã§æŒ‡å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ãŒã€
æŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯ <strong>Layout Inspector</strong> ï¼ˆ<a href="https://developer.android.com/studio/debug/layout-inspector">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ï¼‰ã§éšå±¤æ§‹é€ ã‚’å–å¾—
ã—ã¦è§£æã‚’ã—ã¦ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã‚’è¡Œã„ã¾ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190718-layoutinspector-00.png" width="90%" />
</div>

<p>Fragmentã®é‡ãªã‚Šæ–¹ãŒæ“ä½œã«ã‚ˆã£ã¦å¤‰åŒ–ã™ã‚‹å ´åˆãŒã‚ã‚Šã€è¡¨ç¤ºã¯åŒã˜ã§ã‚‚éšå±¤ãŒé•ã†å ´åˆãŒå¤šã€…ç™ºç”Ÿã—ã¾ã™ã€‚
ã§ã™ã®ã§ã€Layout Inspectorã§éšå±¤æ§‹é€ ã‚’å–å¾—ã™ã‚‹ã¨ãã¯UI Testã§ã®ã‚·ãƒŠãƒªã‚ªé€šã‚Šã«ä¸€åº¦ç”»é¢ã‚’é·ç§»ã•ã›ã¦ã€ãã‚Œã‹ã‚‰å–å¾—ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚</p>

<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>iOSæ¨™æº–ã®UI Testãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹<a href="https://developer.apple.com/documentation/xctest">XCTest</a>ã«æ¯”ã¹ã‚‹ã¨
ç™–ãŒå°‘ã—å¼·ã„ã§ã™ã€‚ã¨ã£ã¤ãã«ãã„ã¨ã“ã‚ã‚‚ã‚ã‚Šã¾ã™ãŒã€ãã“ã¾ã§é›£ã—ãã¯ãªã„ã®ã§æ°—ã«ãªã£ã¦ã„ã‚‹å ´åˆã¯æŒ‘æˆ¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚<br />
è‡ªåˆ†ã®ä½œã£ãŸã‚¢ãƒ—ãƒªãŒè‡ªå‹•ã§å‹•ãã®ã‚’è¦‹ã‚‹ã®ã‚‚æ¥½ã—ã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h2 id="reference">Reference</h2>
<ul>
  <li><a href="https://developer.android.com/training/testing/espresso">Espresso -  Android Developers</a></li>
  <li><a href="https://developer.android.com/training/testing/ui-automator">UI Automator - Android Developers</a></li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-07-16T00:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html">July 16, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~2 minutes


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/07/16/ci-android-firebase-00.html" rel="bookmark" title="Firebase Test Labã§UI Testã‚’å®Ÿè¡Œã™ã‚‹" itemprop="url">Firebase Test Labã§UI Testã‚’å®Ÿè¡Œã™ã‚‹</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="ã“ã‚Œã¯ä½•">ã“ã‚Œã¯ä½•ï¼Ÿ</h2>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®UI Testã‚’CircleCIã‹ã‚‰å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ãŸè¨˜äº‹ã§ã™ã€‚
<a href="https://github.com/ryoyakawai/uitest_sample_android">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª</a>ã®UI Testã‚’èµ°ã‚‰ã›ã‚‹Firebase Test Labï¼ˆUI Testã‚’å®Ÿè¡Œã™ã‚‹ã‚¤ãƒ³ãƒ•ãƒ©ï¼‰ã«ã¤ã„ã¦è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚</p>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>
<h3 id="ciã®æµã‚Œã§ui-testãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€">Ciã®æµã‚Œã§UI TestãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€</h3>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®CIã®æµã‚Œã§ã¯ <strong>(3) UI Test</strong> ã§UI Testã‚’å®Ÿè¡Œã€
<strong>(4) Report</strong> ã§ãƒ¬ãƒãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™ã€‚</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-circleci_firebase_00.png" width="80%" />
</div>
<p>ã“ã“ã§ä½¿ã†ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>
<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/tree/master/app/src/test/java/com/example/uitestsample">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ãƒªãƒã‚¸ãƒˆãƒª</a></li>
  <li>UI Testã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼š<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/MainActivityInstrumentedTest.kt">MainActivityInstrumentedTest.kt</a></li>
</ul>

<h3 id="ãƒã‚¤ãƒ³ãƒˆæ¡ä»¶ãªã©">ãƒã‚¤ãƒ³ãƒˆã€æ¡ä»¶ãªã©</h3>
<p>CIã§ä½¿ã†CircleCIã¯2.0ã‹ã‚‰Androidã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’å‹•ã‹ã™ã“ã¨ãŒã§ããªããªã£ãŸã“ã¨ã‹ã‚‰ã€
CircleCIå˜ä½“ã§ã®UI Testã®å®Ÿè¡ŒãŒä¸å¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚ï¼ˆ<a href="https://support.circleci.com/hc/en-us/articles/360000028928-Testing-with-Android-emulator-on-CircleCI-2-0">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ï¼‰
ã§ã™ã®ã§ã€UI Testã‚’å«ã‚ã‚‹ã¨ã™ã‚‹ã¨ã€Androidã‚¢ãƒ—ãƒªã®CIã¯å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒå¿…é ˆã¨ãªã£ã¦ã„ã¾ã™ã€‚</p>

<p>ä»Šå›ã¯<a href="https://support.circleci.com/hc/en-us/articles/360000028928-Testing-with-Android-emulator-on-CircleCI-2-0">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã«ã‚ªã‚¹ã‚¹ãƒ¡ã•ã‚Œã¦ã„ã‚‹
Firebase Test Labã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚</p>

<h3 id="firebase-test-labã¨ã¯">Firebase Test Labã¨ã¯</h3>
<p>Firebase Test Labã¯FirebaseãŒã®ã‚µãƒ¼ãƒ“ã‚¹ã®1ã¤ã¨ã—ã¦æä¾›ã—ã¦ã„ã‚‹ã‚¯ãƒ©ã‚¦ãƒ‰ã§UI Testã‚’è¡Œã†ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚Android(Espressoã€UI Automator)ã€iOS(XCTest)ã§æ›¸ã‹ã‚ŒãŸãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚</p>

<p>ï¼ˆè©³ã—ãã¯ã€ŒAndroidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚ã€ã®<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html#aboutfirebasetestlab">Firebase Test Labã¨ã¯</a>ã‚’å¾¡è¦§ãã ã•ã„ã€‚ï¼‰</p>

<p><a href="https://firebase.google.com/docs/test-lab">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã¡ã‚‰</a>ã§ã™ã€‚</p>

<p>ãã‚Œã§ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç­‰ã®æº–å‚™ã‚’èª¬æ˜ã—ã¾ã™ã€‚</p>

<h4 id="æ–™é‡‘ä½“ç³»2019å¹´7æœˆç¾åœ¨">æ–™é‡‘ä½“ç³»ï¼ˆ2019å¹´7æœˆç¾åœ¨ï¼‰</h4>
<p>æ–™é‡‘ã¯ç„¡æ–™æ ãŒã€ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ5å›ã¾ã§ã€Virtualï¼ˆä»®æƒ³ï¼‰ãƒ‡ãƒã‚¤ã‚¹ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ10å›ã¾ã§ã€‚<br />
ç„¡æ–™æ ã‚’è¶…ãˆã‚‹ã¨ã€ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹1å°1æ™‚é–“$5ã€Virtualï¼ˆä»®æƒ³ï¼‰ãƒ‡ãƒã‚¤ã‚¹1å°1æ™‚é–“$1ã¨ãªã‚Šã¾ã™ã€‚
ã¾ãŸã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®ä¸Šé™ã‚‚ã‚ã‚Šã€ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ãŒ30åˆ†ã€Virtualï¼ˆä»®æƒ³ï¼‰ãƒ‡ãƒã‚¤ã‚¹ãŒ60åˆ†ã¨æ±ºã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã®ã§ã€
Firebase Test Labã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯ãã“ã«åã¾ã‚‹ã‚ˆã†ã«ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è€ƒãˆã¾ã—ã‚‡ã†ã€‚<br />
ã“ã®æ™‚é–“ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ç‰©ç†ãƒ‡ãƒã‚¤ã‚¹ã‚‚Virtualï¼ˆä»®æƒ³ï¼‰ãƒ‡ãƒã‚¤ã‚¹ã‚‚åŒã˜ã15åˆ†ã§è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚</p>

<p><a href="https://firebase.google.com/pricing">è©³ç´°ã¯ã“ã“ã®Test Lab</a>ã®é …ç›®ã‚’å¾¡è¦§ãã ã•ã„ã€‚</p>

<h4 id="-firebaseã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™">ï¼ Firebaseã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®æº–å‚™</h4>
<p><a href="https://console.firebase.google.com">console.firebase.google.com</a>ã‹ã‚‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚</p>

<h3 id="-gcpã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æº–å‚™">ï¼ GCPã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æº–å‚™</h3>
<p>Circle CIã‹ã‚‰ã¯ gcloud ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ Firebase Test Lab å®Ÿè¡Œã™ã‚‹ã®ã§ã€GCPã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚å¿…é ˆã¨ãªã‚Šã¾ã™ã€‚
ã¾ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å¿…è¦ã¨ãªã‚Šã¾ã™ã®ã§ä½œæˆã—ã¦ã„ãã¾ã™ã€‚</p>

<ul>
  <li><a href="https://console.cloud.google.com">console.firebase.google.com</a> ã‹ã‚‰GCPã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ</li>
  <li>GCPã® <a href="https://console.cloud.google.com/projectcreate">æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹</a></li>
  <li>å¼•ãç¶šãGCPã§ <a href="https://console.cloud.google.com/marketplace/details/google/testing.googleapis.com">Cloud Testing API</a>ã¨<a href="https://console.cloud.google.com/marketplace/details/google/toolresults.googleapis.com">Cloud Tool Results API</a> ã‚’æœ‰åŠ¹ã«ã™ã‚‹ï¼ˆä¸‹å›³å·¦ï¼šç”»é¢ä¸Šéƒ¨ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é¸æŠã‚’å¿˜ã‚Œãšã«ï¼ï¼‰</li>
  <li><a href="https://console.cloud.google.com">console.firebase.google.com</a> ã«æˆ»ã‚ŠGCPã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ãƒªãƒ³ã‚¯ã™ã‚‹ã€‚ç”»åƒå†…ã®(1)ã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã™ã‚‹ã€‚ï¼ˆä¸‹å›³å³ï¼‰</li>
</ul>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190717-gcp-activateapi-00.png" width="47%" style="margin-right:15px;border-radius:4px;border:1px solid #eeeeee" />
<img src="https://ryoyakawai.com/blog/images/2019/07/20190717-firebase-linkproject-00.png" width="47%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<p>ç¶šã„ã¦ã€gcloud ã‚³ãƒãƒ³ãƒ‰ã¯<a href="https://cloud.google.com/sdk/downloads">ã“ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ</a>ã®é€šã‚Šã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚<br />
æœ€å¾Œã«Androidã®Buildç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚<a href="https://developer.android.com/studio/install">Android Studioã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a>ã™ã‚‹ã®ãŒã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚</p>

<h3 id="-ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰å‹•ã‹ã—ã¦ã¿ã‚‹">ï¼ ã‚³ãƒãƒ³ãƒ‰ã‹ã‚‰å‹•ã‹ã—ã¦ã¿ã‚‹</h3>

<p>ã¾ãšã¯ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŒ‡å®šã‚’è¡Œã„ã¾ã™ã€‚</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="c"># ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§GCPã«ãƒ­ã‚°ã‚¤ãƒ³</span>
<span class="gp">$ </span>gcloud auth;

<span class="c"># è¨­å®šå¯èƒ½ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒªã‚¹ãƒˆã™ã‚‹</span>
<span class="gp">$ </span>gcloud projects list;
PROJECT_ID                 NAME                   PROJECT_NUMBER
my-test-project-00-2xxxx5  My-Test-Project-00     6xxxx4xxxxx6

<span class="c"># ã€Œmy-test-project-00-24690ã€ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦æŒ‡å®šã™ã‚‹</span>
<span class="gp">$ </span>gcloud config <span class="nb">set </span>project my-test-project-00-2xxxx5;

<span class="c"># è¨­å®šå†…å®¹ã‚’ç¢ºèªã™ã‚‹(account, projectãŒæŒ‡å®šã—ãŸå†…å®¹ã§ã‚ã‚‹ã‹ç¢ºèª)</span>
<span class="gp">$ </span>gcloud config list;
<span class="o">[</span>compute]
region <span class="o">=</span> us-central1
zone <span class="o">=</span> us-central1-c
<span class="o">[</span>core]
account <span class="o">=</span> xxxxx.xxxx.xxxx.xxxx@example.com
disable_usage_reporting <span class="o">=</span> True
project <span class="o">=</span> my-test-project-00-2xxxx5

Your active configuration is: <span class="o">[</span>default]
</code></pre>
</div>

<h3 id="-ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œã•ã›ã¦ã¿ã‚‹">ï¼ ãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ä½œã•ã›ã¦ã¿ã‚‹</h3>
<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="c"># ã‚³ãƒ¼ãƒ‰ã‚’Cloneã™ã‚‹</span>
<span class="gp">$ </span>git clone https://github.com/ryoyakawai/uitest_sample_android.git;
<span class="gp">$ </span><span class="nb">cd </span>uitest_sample_android/;

<span class="c"># Build</span>
<span class="c"># EmulatorãŒå‹•ä½œã—ã¦ã„ãªã„å ´åˆã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ãŒã€ä»¥ä¸‹ã®2ã¤ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ã€‚</span>
<span class="c"># - app/build/outputs/apk/debug/app-debug.apk</span>
<span class="c"># - app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk</span>
<span class="gp">$ </span>./gradlew connectedAndroidTest;

<span class="c"># ç’°å¢ƒå¤‰æ•°ã‚’æŒ‡å®šã™ã‚‹</span>
<span class="gp">$ </span><span class="nv">GOOGLE_PROJECT_ID</span><span class="o">=</span><span class="s2">"my-test-project-00-2xxxx5"</span>;
<span class="gp">$ </span><span class="nv">BK_OBJ_NAME</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">GOOGLE_PROJECT_ID</span><span class="k">}</span><span class="s2">/uitest-</span><span class="k">$(</span>date <span class="s2">"+%Y%m%d_%H%M"</span><span class="k">)</span><span class="s2">"</span>;

<span class="c"># ã‚³ãƒãƒ³ãƒ‰ã‚’æ”¹è¡Œã™ã‚‹ã¨ãã¯æœ«å°¾ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’å¿˜ã‚Œãšã«å…¥ã‚Œã¦ãã ã•ã„ã€‚</span>
<span class="gp">$ </span>gcloud firebase <span class="nb">test </span>android run <span class="se">\</span>
 --type instrumentation <span class="se">\</span>
 --app ./app/build/outputs/apk/debug/app-debug.apk <span class="se">\</span>
 --test ./app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk <span class="se">\</span>
 --test-targets <span class="s2">"class com.example.uitestsample.MainActivityInstrumentedTest"</span> <span class="se">\</span>
 --results-dir <span class="nv">$BK_OBJ_NAME</span> <span class="se">\</span>
 --results-bucket cloud-test-<span class="k">${</span><span class="nv">GOOGLE_PROJECT_ID</span><span class="k">}</span> <span class="se">\</span>
 --directories-to-pull /sdcard/uitest/ <span class="se">\</span>
 --device <span class="nv">model</span><span class="o">=</span>Pixel2,version<span class="o">=</span>26,locale<span class="o">=</span>en_US,orientation<span class="o">=</span>portrait <span class="se">\</span>
 --use-orchestrator <span class="se">\</span>
 --timeout 120s;

<span class="c"># ç„¡äº‹ã«é–‹å§‹ã•ã‚Œã‚‹ã¨ä»¥ä¸‹ãŒå‡ºåŠ›ã•ã‚‹</span>
Have questions, feedback, or issues? Get support by visiting:
  https://firebase.google.com/support/

Uploading <span class="o">[</span>./app/build/outputs/apk/debug/app-debug.apk] to Firebase Test Lab...
Uploading <span class="o">[</span>./app/build/outputs/apk/androidTest/debug/app-debug-androidTest.apk] to Firebase Test Lab...
Raw results will be stored <span class="k">in </span>your GCS bucket at <span class="o">[</span>https://console.developers.google.com/storage/browser/cloud-test-my-test-project-00-2xxxx5/my-test-project-00-2xxxx5/uitest-20190716_1603/]

Test <span class="o">[</span>matrix-1gpbgxrsx8fag] has been created <span class="k">in </span>the Google Cloud.
Firebase Test Lab will execute your instrumentation <span class="nb">test </span>on 1 device<span class="o">(</span>s<span class="o">)</span>.
Creating individual <span class="nb">test </span>executions...done.

Test results will be streamed to <span class="o">[</span>https://console.firebase.google.com/project/my-test-project-00-2xxxx5/testlab/histories/bh.xxxxxxxxxxxx/matrices/8xxxxxxxxxxxx11].
16:17:55 Test is Pending
16:18:23 Starting attempt 1.
16:18:23 Test is Running
16:19:17 Started logcat recording.
16:19:17 Preparing device.
16:19:52 Logging <span class="k">in </span>to Google account on device.
16:19:52 Installing apps.
16:20:06 Retrieving Pre-Test Package Stats information from the device.
16:20:06 Retrieving Performance Environment information from the device.
16:20:06 Started crash detection.
16:20:06 Started crash monitoring.
16:20:06 Started performance monitoring.
16:20:19 Started video recording.
16:20:19 Starting instrumentation test.
16:20:53 Completed instrumentation test.
16:21:07 Stopped performance monitoring.
16:21:14 Stopped crash monitoring.
16:21:14 Stopped logcat recording.
16:21:14 Retrieving Post-test Package Stats information from the device.
16:21:14 Logging out of Google account on device.
16:21:21 Done. Test <span class="nb">time</span> <span class="o">=</span> 36 <span class="o">(</span>secs<span class="o">)</span>
16:21:21 Starting results processing. Attempt: 1
16:21:28 Completed results processing. Time taken <span class="o">=</span> 6 <span class="o">(</span>secs<span class="o">)</span>
16:21:28 Test is Finished

Instrumentation testing complete.

More details are available at <span class="o">[</span>https://console.firebase.google.com/project/my-test-project-00-2xxxx5/testlab/histories/bh.xxxxxxxxxxxx/matrices/8xxxxxxxxxxxx11].
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OUTCOME â”‚     TEST_AXIS_VALUE      â”‚     TEST_DETAILS    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Passed  â”‚ Pixel2-26-en_US-portrait â”‚ 3 <span class="nb">test </span>cases passed â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

</code></pre>
</div>

<p>ã‚³ãƒãƒ³ãƒ‰ã«å‡ºåŠ›ã•ã‚Œã‚‹Firebaseã®URLã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨çµæœãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã®1è¡Œã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ä¸‹å›³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
<div class="language-shell highlighter-rouge"><pre class="highlight"><code>Test results will be streamed to <span class="o">[</span>https://console.firebase.google.com/project/my-test-project-00-2xxxx5/testlab/histories/bh.xxxxxxxxxxxx/matrices/8xxxxxxxxxxxx11]
</code></pre>
</div>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190717-firebase-result-00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<p>é™æ­¢ç”»ã€å‹•ç”»ã‚’ä¸€è¦§ã§è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ãƒ†ã‚¹ãƒˆã§ä½•ãŒã•ã‚Œã¦ã„ãŸã‹ã‚‚å¾Œã‹ã‚‰ç¢ºèªã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚
ã¡ãªã¿ã«ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å‹•ç”»ã¯æ’®å½±ã—ã¦ãã‚Œã‚‹è¨­å®šã«ãªã£ã¦ã„ã¾ã™ãŒã€é™æ­¢ç”»ã«é–¢ã—ã¦ã¯è‡ªå‰ã§æ’®å½±ã™ã‚‹å‡¦ç†ã‚’æ›¸ãã€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’æ±ºã‚ã¦ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã«åŸ‹ã‚è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®é™æ­¢ç”»ã‚‚è‡ªå‰ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã®<a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/androidTest/java/com/example/uitestsample/uitestutils/UiTestUtils.kt">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®UiTestUtils</a>ã«å«ã‚“ã§ã„ã¾ã™ã®ã§è©¦ã—ã¦ã¿ãŸã„å ´åˆã¯åˆ©ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚</p>

<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>CIã®æµã‚Œã®ä¸­ã§ã¯ã‚‚ã¡ã‚ã‚“ã€ã¾ãŸã€Œæ—¥ã€…ã®é–‹ç™ºã¨ä¸¦è¡Œã—ã¦ãƒ†ã‚¹ãƒˆã—ãŸã„å ´åˆã«ãƒ­ãƒ¼ã‚«ãƒ«ã§ç’°å¢ƒã‚’ç”¨æ„ã™ã‚‹ã€ã“ã¨ã¯ã‚³ã‚¹ãƒˆçš„ã«å³ã—ã‹ã£ãŸã‚Šã€
ã€Œä»–ç«¯æœ«ã®å®Ÿãƒ‡ãƒã‚¤ã‚¹ã‚’ä½¿ã£ã¦ã¾ãšã¯ãƒ†ã‚¹ãƒˆã‚’å‹•ã‹ã—ã¦ã¿ãŸã„ã€ã¨ã„ã†ã®ã‚‚åŒã˜ãã‚³ã‚¹ãƒˆçš„ã«å³ã—ã„ã“ã¨ãŒå°‘ãªããªã„ã¨æ€ã„ã¾ã™ã€‚
å…¨ã¦ã¯ç„¡ç†ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€ãã‚“ãªã¨ãã«å¿ƒé…ã®å¡Šã®1éƒ¨ã ã‘ã§ã‚‚å–ã‚Šé™¤ãã¹ãFirebase Test Labã‚’ä½¿ã†ã€ã¨ã„ã†ã®ã‚‚ã¨ã¦ã‚‚æœ‰åŠ¹ã ã¨æ€ã„ã¾ã™ã€‚<br />
æ°—ã«ãªã£ã¦ã„ã‚‹æ–¹ã¯ä½¿ã£ã¦ã¿ã¦ã¯ã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼Ÿ</p>

<h2 id="reference">Reference</h2>

<ul>
  <li><a href="https://firebase.google.com/docs/test-lab/android/command-line">Get started with Firebase Test Lab from the gcloud Command Line</a></li>
  <li><a href="https://cloud.google.com/sdk/gcloud/reference/firebase/test/android/run">gcloud firebase test android run(Cloud SDK:Google Cloud)</a></li>
</ul>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2019-07-10T00:00:00+09:00"><a href="https://ryoyakawai.com/blog/2019/07/10/ci-android-unittest-00.html">July 10, 2019</a></time></span><span class="author vcard"><span class="fn"><a href="https://ryoyakawai.com/blog/about/" title="About Ryoya Kawai">Ryoya Kawai</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~1 minute


      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://ryoyakawai.com/blog/2019/07/10/ci-android-unittest-00.html" rel="bookmark" title="Androidã‚¢ãƒ—ãƒªã§ã®Unit Testã«ã¤ã„ã¦ã®è§£èª¬" itemprop="url">Androidã‚¢ãƒ—ãƒªã§ã®Unit Testã«ã¤ã„ã¦ã®è§£èª¬</a></h1>
    
  </header>
  <div class="entry-content">
    <h2 id="ã“ã‚Œã¯ä½•">ã“ã‚Œã¯ä½•ï¼Ÿ</h2>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®Unit Testã‚’èª¬æ˜ã—ãŸè¨˜äº‹ã§ã™ã€‚
<a href="https://github.com/ryoyakawai/uitest_sample_android">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª</a>ã®Unit Testã«ã¤ã„ã¦è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚</p>

<h2 id="æ¦‚è¦">æ¦‚è¦</h2>
<h3 id="ciã®æµã‚Œã§unit-testãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€">CIã®æµã‚Œã§Unit TestãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ç®‡æ‰€</h3>
<p>ã€Œ<a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html">Androidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚</a>ã€ã®CIã®æµã‚Œã§ã¯ <strong>(2) Build</strong> ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-circleci_firebase_00.png" width="80%" />
</div>
<p>ã“ã“ã§ä½¿ã†ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚</p>
<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/tree/master/app/src/test/java/com/example/uitestsample">ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®ãƒªãƒã‚¸ãƒˆãƒª</a></li>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/test/java/com/example/uitestsample/MainActivityUnitTest.kt">Unit Testã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</a></li>
</ul>

<p><a href="https://developer.android.com/training/testing/unit-testing/local-unit-tests">å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã“ã‚Œ</a>ã§ã™ã€‚</p>

<h3 id="ãƒã‚¤ãƒ³ãƒˆæ¡ä»¶ãªã©">ãƒã‚¤ãƒ³ãƒˆã€æ¡ä»¶ãªã©</h3>
<p><a href="https://ryoyakawai.com/blog/2019/07/03/ci-android-00.html#aboutunittest">Unit Testã«ã¤ã„ã¦ï¼ˆAndroidã‚¢ãƒ—ãƒªã‚’CircleCIã§CIã™ã‚‹ã€‚ï¼‰</a>ã«ã‚‚æ›¸ã„ã¦ã„ã¾ã™ãŒãƒã‚¤ãƒ³ãƒˆã¯ä»¥ä¸‹ã§ã™ã€‚</p>
<ul>
  <li>MVPï¼ˆModel-View-Presenterï¼‰ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«å¯¾ã—ã¦ã®Unit Testã‚’å®Ÿè¡Œã™ã‚‹</li>
  <li><a href="https://junit.org/junit4/">JUnit</a>ã‚’ä½¿ã£ã¦Unit Testã‚’å®Ÿè¡Œã™ã‚‹</li>
  <li><a href="https://site.mockito.org/">Mockito</a>ã§Viewã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹</li>
  <li>HTTPã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’ãƒ¢ãƒƒã‚¯ã™ã‚‹</li>
  <li>ãƒ†ã‚¹ãƒˆã™ã‚‹å ´æ‰€ã¯ä»¥ä¸‹ã®å›³ã® <strong>Point for Unit Testing</strong></li>
</ul>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190703-mvp-diagram-00.png" width="90%" />
</div>

<p>ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯MVPã«é™ã£ã¦ã„ã‚‹è¨³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€Interfaceã‚’å®šç¾©ã—ã¦ã„ã‚‹ã¨ãƒ†ã‚¹ãƒˆã‚’æ›¸ãã®ãŒæ¥½ã«ãªã‚‹ã“ã¨ã‹ã‚‰
ã“ã“ã§ã¯MVPã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚</p>

<h3 id="ãƒ†ã‚¹ãƒˆã®ã‚·ãƒŠãƒªã‚ª">ãƒ†ã‚¹ãƒˆã®ã‚·ãƒŠãƒªã‚ª</h3>
<p>ã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½ã¨ã—ã¦ã¯ç„¡é§„ã«å®Ÿè£…ã•ã‚ŒãŸ<a href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a>
ã®REST APIã«æ¥ç¶šã‚’ã—ã¦JSONã‚’å–å¾—ã—ã€Viewã«åæ˜ ã•ã›ã‚‹éƒ¨åˆ†ã®å‹•ä½œã«é–¢ã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¾ã™ã€‚<br />
å…·ä½“çš„ã«èª¬æ˜ã™ã‚‹ã¨ä¸Šå›³ã® <strong>Data Interaction</strong> ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦JSONã‚’å›ºå®šã—ã€<strong>UI Behavior</strong> ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦
æŒ‡å®šã•ã‚Œã¦ã„ã‚‹æŒ¯ã‚‹èˆã„ã‚’è¡Œã†ã‹ã€ã‚’ç¢ºèªã—ã¾ã™ã€‚
<br />
ã‚ˆã£ã¦ã€ä»Šå›ã¯ã“ã®ã‚·ãƒŠãƒªã‚ªã‚’ç¢ºèªã™ã‚‹ç‚ºã«ä»¥ä¸‹ã®2ã¤ã®ãƒ†ã‚¹ãƒˆã®ã‚±ãƒ¼ã‚¹ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚</p>
<ul>
  <li>HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰200ã§JSONã‚’æ­£ã—ãå—ã‘å–ã£ãŸå ´åˆã®å€¤ã®ç¢ºèªã¨Viewã«å¯¾ã™ã‚‹å‹•ä½œç¢ºèª</li>
  <li>HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰500ã‚’å—ã‘å–ã£ãŸå ´åˆã®Viewã«å¯¾ã™ã‚‹å‹•ä½œç¢ºèª</li>
</ul>

<h3 id="æº–å‚™">æº–å‚™</h3>
<p><code class="highlighter-rouge">build.gradle</code>ã«è¿½è¨˜ã€<code class="highlighter-rouge">org.mockito.plugins.MockMaker</code> ã®ä½œæˆã®2ã¤ãŒå¿…è¦ã§ã™ã€‚</p>

<h4 id="-buildgradleã«è¿½è¨˜">ï¼ <code class="highlighter-rouge">build.gradle</code>ã«è¿½è¨˜</h4>
<p><code class="highlighter-rouge">app/build.gradle</code> ã«ä»¥ä¸‹ã‚’è¿½è¨˜ã—ã¾ã™ã€‚</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="o">....</span>
<span class="n">dependencies</span> <span class="p">{</span>
<span class="o">....</span>
    <span class="c1">// Unit and UI Test
</span>    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">junit</span><span class="p">:</span><span class="n">junit</span><span class="p">:</span><span class="m">4.12</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="s">"org.jetbrains.kotlin:kotlin-reflect:$kotlin_version"</span>
    <span class="n">testImplementation</span> <span class="s">"com.android.support:support-annotations:${android.defaultConfig.targetSdkVersion}"</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">org</span><span class="p">.</span><span class="n">robolectric</span><span class="p">:</span><span class="n">robolectric</span><span class="p">:</span><span class="m">4.0</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">nhaarman</span><span class="p">:</span><span class="n">mockito</span><span class="p">-</span><span class="n">kotlin</span><span class="p">-</span><span class="n">kt1</span><span class="p">.</span><span class="m">1</span><span class="p">:</span><span class="m">1.5</span><span class="p">.</span><span class="m">0</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">squareup</span><span class="p">.</span><span class="n">retrofit2</span><span class="p">:</span><span class="n">converter</span><span class="p">-</span><span class="n">moshi</span><span class="p">:</span><span class="m">2.2</span><span class="p">.</span><span class="m">0</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">squareup</span><span class="p">.</span><span class="n">retrofit2</span><span class="p">:</span><span class="n">retrofit</span><span class="p">-</span><span class="n">mock</span><span class="p">:</span><span class="m">2.3</span><span class="p">.</span><span class="m">0</span><span class="err">'</span>
    <span class="n">testImplementation</span> <span class="err">'</span><span class="n">com</span><span class="p">.</span><span class="n">squareup</span><span class="p">.</span><span class="n">okhttp3</span><span class="p">:</span><span class="n">mockwebserver</span><span class="p">:</span><span class="m">3.10</span><span class="p">.</span><span class="m">0</span><span class="err">'</span>
<span class="o">....</span>
<span class="p">}</span>
<span class="o">....</span>
</code></pre>
</div>

<p><code class="highlighter-rouge">build.gradle</code> ã«ä»¥ä¸‹ãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå‰æã§ã™ã€‚</p>

<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="o">....</span>
<span class="n">buildscript</span> <span class="p">{</span>
<span class="o">....</span>
    <span class="n">ext</span><span class="p">.</span><span class="n">kotlin_version</span> <span class="p">=</span> <span class="err">'</span><span class="m">1.3</span><span class="p">.</span><span class="m">31</span><span class="err">'</span>
<span class="o">....</span>
<span class="p">}</span>
<span class="o">....</span>
</code></pre>
</div>

<h4 id="-orgmockitopluginsmockmaker-ã‚’ä½œæˆ">ï¼ <code class="highlighter-rouge">org.mockito.plugins.MockMaker</code> ã‚’ä½œæˆ</h4>
<p><code class="highlighter-rouge">app/src/test/resources/mockito-extensions/org.mockito.plugins.MockMaker</code> ã‚’æ–°è¦ã§ä½œæˆã—ã¦ã€ä»¥ä¸‹ã®1è¡Œã‚’æ›¸ãè¾¼ã¿ã¾ã™ã€‚</p>

<div class="highlighter-rouge"><pre class="highlight"><code>mock-maker-inline
</code></pre>
</div>

<h3 id="unit-testã‚’æ›¸ã">Unit Testã‚’æ›¸ã</h3>

<h4 id="-rest-apiã‚’ãƒ¢ãƒƒã‚¯ã—ã¦å‡ºåŠ›ã‚’å›ºå®šã™ã‚‹">ï¼ REST APIã‚’ãƒ¢ãƒƒã‚¯ã—ã¦å‡ºåŠ›ã‚’å›ºå®šã™ã‚‹</h4>
<p><strong>Data Interaction</strong> ã®éƒ¨åˆ†ã‚’ãƒ¢ãƒƒã‚¯ã—ã¦å‡ºåŠ›ã‚’å›ºå®šã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯<a href="https://jsonplaceholder.typicode.com/">JSONPlaceholder</a>ã®REST APIã®å‡ºåŠ›ã‚’å›ºå®šã™ã‚‹ç‚ºã«
HTTPã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ<a href="https://square.github.io/okhttp/">OkHttp</a>ã‚’ãƒ¢ãƒƒã‚¯ã—ã¾ã™ã€‚
æ‰±ã„ã‚„ã™ã„ã‚ˆã†ã«ã€ <strong>Unit Testæœ¬ä½“</strong> ã¨ã€ <strong>ãƒ¢ãƒƒã‚¯</strong> ã‚’1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã¡ã‚ƒã£ã¦ã„ã¾ã™ã€‚</p>

<ul>
  <li><a href="https://github.com/ryoyakawai/uitest_sample_android/blob/master/app/src/test/java/com/example/uitestsample/MainActivityUnitTest.kt">MainActivityUnitTest.kt</a></li>
</ul>

<p><code class="highlighter-rouge">MockServerDispatcher</code>ã®ã‚¯ãƒ©ã‚¹ãŒãã‚Œã«ãªã‚Šã¾ã™ã€‚<br />
ã“ã“ã§ã¯ã€<code class="highlighter-rouge">Resp200</code>ã€<code class="highlighter-rouge">Resp400</code>ã€<code class="highlighter-rouge">Resp500</code> ã®3ã¤ã®Classã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€ä»¥ä¸‹ã®ç”¨ã«å‡ºåŠ›ã‚’å›ºå®šã—ã¾ã™ã€‚</p>

<ul>
  <li><code class="highlighter-rouge">Resp200</code>ï¼šæ­£å¸¸ç³»ã®å ´åˆã§ã€JSONã‚’è¿”ã™</li>
  <li><code class="highlighter-rouge">Resp400</code>ï¼šç•°å¸¸ç³»ã§ã€HTTP Statusã®400ã‚’è¿”ã™</li>
  <li><code class="highlighter-rouge">Resp500</code>ï¼šç•°å¸¸ç³»ã§ã€HTTP Statusã®500ã‚’è¿”ã™</li>
</ul>

<h4 id="-unit-testã‚’æ›¸ã">ï¼ Unit Testã‚’æ›¸ã</h4>
<p>2ã¤ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®ã†ã¡ã®ã€ŒHTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰200ã§JSONã‚’æ­£ã—ãå—ã‘å–ã£ãŸå ´åˆã®å€¤ã®ç¢ºèªã¨Viewã«å¯¾ã™ã‚‹å‹•ä½œã®ç¢ºèªã€
ã®èª¬æ˜ã‚’ã€ä»¥ä¸‹ã«ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§è¡Œã„ã¾ã™ã€‚ã€‚
ä»¥ä¸‹ã¯ã€</p>
<div class="language-kotlin highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">MainActivityUnitTest</span> <span class="p">{</span>
    <span class="k">private</span> <span class="kd">var</span> <span class="py">mMockTestUtils</span> <span class="p">=</span> <span class="n">UnitTestUtils</span><span class="p">()</span>

    <span class="n">@Test</span>
    <span class="k">fun</span> <span class="nf">sampleUnitDataFetchSuccessTest</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// vvv æ­£å¸¸ç³»ã§JSONã‚’è¿”ã™ã‚ˆã†æŒ‡å®š
</span>        <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">mockServerBehaviorSwitcher</span> <span class="p">=</span> <span class="p">{</span>
            <span class="n">MockServerDispatcher</span><span class="p">().</span><span class="n">Resp200</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="kd">val</span> <span class="py">expectedResponse</span> <span class="p">=</span> <span class="n">MockServerDispatcher</span><span class="p">().</span><span class="n">mockedResponse</span>

        <span class="kd">var</span> <span class="py">mMainActivityPresenter</span> <span class="p">=</span> <span class="n">MainActivityPresenter</span><span class="p">()</span>
        <span class="c1">// vvv Viewã«å¯¾ã™ã‚‹å‹•ä½œã®ç¢ºèªã®ç‚ºã«MainActivityViewContract()ã®Classã‚’ãƒ¢ãƒƒã‚¯
</span>        <span class="kd">var</span> <span class="py">mMainActivityViewContract</span> <span class="p">=</span> <span class="n">mock</span><span class="p">&lt;</span><span class="n">MainActivityViewContract</span><span class="p">&gt;()</span>

        <span class="c1">// vvv Presentorã«ãƒ¢ãƒƒã‚¯ã—ãŸMainActivityViewContract()ã‚’å©ã‹ã›ã‚‹ã‚ˆã†ã«ã‚»ãƒƒãƒˆ
</span>        <span class="n">mMainActivityPresenter</span><span class="p">.</span><span class="n">setView</span><span class="p">(</span><span class="n">mMainActivityViewContract</span><span class="p">)</span>

        <span class="c1">// vvv éåŒæœŸã§ã®å‡¦ç†ã‚’åŒæœŸã§å‹•ä½œã•ã›ã‚‹ã‚ˆã†ã«å¤‰æ›´
</span>        <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">prepareRxForTesting</span><span class="p">()</span>

        <span class="c1">// vvv ã“ã“ã§Mockã—ãŸã‚µãƒ¼ãƒã‚’èµ·å‹•ã™ã‚‹
</span>        <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">startMockServer</span><span class="p">()</span>

        <span class="c1">// vvv ä»¥ä¸‹ã®2è¡Œã§ã€ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®æ¥ç¶šå…ˆã‚’Mockã—ãŸã‚µãƒ¼ãƒã«å…¥ã‚Œæ›¿ãˆã‚‹
</span>        <span class="kd">var</span> <span class="py">mApiConnection</span> <span class="p">=</span> <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">setupMockServer</span><span class="p">()</span>
        <span class="n">setConnection</span><span class="p">(</span><span class="n">mApiConnection</span><span class="p">)</span>

        <span class="c1">// vvv Presenterã®Methodã‚’å©ã„ã¦ã€å‹•ä½œã•ã›ã‚‹
</span>        <span class="n">mMainActivityPresenter</span><span class="p">.</span><span class="n">getJsonSampleResponse</span><span class="p">()</span>
        <span class="c1">// vvv MainActivityViewContractã®handleSuccess()ãŒå©ã‹ã‚Œã‚Œã€
</span>        <span class="c1">// å›ºå®šã—ãŸãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰ã®å–å¾—ãŒã§ãã¦ã„ã‚‹ã‹ã‚’ç¢ºèª
</span>        <span class="n">argumentCaptor</span><span class="p">&lt;</span><span class="n">Array</span><span class="p">&lt;</span><span class="n">SinglePostResponse</span><span class="p">&gt;&gt;().</span><span class="n">apply</span> <span class="p">{</span>
            <span class="n">verify</span><span class="p">(</span><span class="n">mMainActivityViewContract</span><span class="p">,</span> <span class="n">times</span><span class="p">(</span><span class="m">1</span><span class="p">)).</span><span class="n">handleSuccess</span><span class="p">(</span><span class="n">capture</span><span class="p">())</span>

            <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="m">0</span> <span class="n">until</span> <span class="n">expectedResponse</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">expected</span> <span class="p">=</span> <span class="n">expectedResponse</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="kd">val</span> <span class="py">actual</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">firstValue</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">assertDataClass</span><span class="p">(</span><span class="n">expected</span><span class="p">,</span> <span class="n">actual</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="p">}</span>
        <span class="c1">// vvv ã“ã“ã§Mockã—ãŸã‚µãƒ¼ãƒã‚’åœæ­¢
</span>        <span class="n">mMockTestUtils</span><span class="p">.</span><span class="n">shutdownMockServer</span><span class="p">()</span>
    <span class="p">}</span>
<span class="o">....</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="å®Ÿè¡Œã—ã¦ã¿ã‚‹">å®Ÿè¡Œã—ã¦ã¿ã‚‹</h3>
<p>å®Ÿè¡Œæ–¹æ³•ã«ã¯ã€Œã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã€ã€ã¾ãŸã€ŒAndroid Studioã‹ã‚‰ã€ã®2ã¤ãŒã‚ã‚Šã¾ã™ã€‚</p>

<h4 id="-ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰å®Ÿè¡Œ">&gt; ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰å®Ÿè¡Œ</h4>

<p>Unit Testã®å…¨ã¦ã‚’å®Ÿè¡Œã™ã‚‹</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>./gradlew testDebugUnitTest;
</code></pre>
</div>

<p>æŒ‡å®šã—ãŸClassã€Methodã®Unit Testã‚’å®Ÿè¡Œã‚‹</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>// Classã‚’æŒ‡å®š
// --tests ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ <span class="o">[</span>Package Name].[Class Name] ã‚’æŒ‡å®š
<span class="gp">$ </span>./gradlew testDebugUnitTest --tests com.example.uitestsample.MainActivityUnitTest;

// Classã¨Methodã‚’æŒ‡å®š
// --tests ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦ <span class="o">[</span>Package Name].[Class Name].[Method Name] ã‚’æŒ‡å®š
<span class="gp">$ </span>./gradlew testDebugUnitTest --tests com.example.uitestsample.MainActivityUnitTest.sampleUnitDataFetchSuccessTest;
</code></pre>
</div>

<h4 id="-android-studioã‹ã‚‰">&gt; Android Studioã‹ã‚‰</h4>
<p><code class="highlighter-rouge">@Test</code>ã®ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚’æ›¸ãã¨Testã¨ã—ã¦èªè­˜ã•ã‚Œã¾ã™ã€‚
ã™ã‚‹ã¨Android Studioã ã¨ä¸‹å›³ã®èµ¤ä¸¸ã®ã‚ˆã†ã«ã€ãã®å·¦å´ã« <span style="color:green">â–¶ï¸</span>ï¼ˆå†ç”Ÿãƒãƒ¼ã‚¯ï¼‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€
ãã‚Œã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚</p>

<div class="post-image-center">
<img src="https://ryoyakawai.com/blog/images/2019/07/20190710-unittest-androidstudio-00.png" width="80%" style="border-radius:4px;border:1px solid #eeeeee" />
</div>

<h2 id="ãŠã‚ã‚Šã«">ãŠã‚ã‚Šã«</h2>
<p>ã€ŒCloneã—ãŸã‚‰ã™ãã«è©¦ã›ã‚‹ã€ã‚’ç›®æ¨™ã«æ›¸ãã¾ã—ãŸã®ã§ã€èˆˆå‘³ã‚’æŒãŸã‚ŒãŸæ–¹ã¯è©¦ã—ã¦ã¿ã¦ã„ãŸã ãˆã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚<br />
é–“é•ã£ã¦ã‚‹ï¼ã¨ã‹ã‚ã‚Šã¾ã—ãŸã‚‰PRã€ã¾ãŸã”æŒ‡æ‘˜ãã ã•ã„ã€‚</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    

    
    
      <li><strong class="current-page">1</strong></li>
    

    
    

    
    
    

    
      
        
        
        
        <li><a href="https://ryoyakawai.com/blog/page2/">2</a></li>
      
    
      
        
        
        
        <li><a href="https://ryoyakawai.com/blog/page3/">3</a></li>
      
    

    
    
      <li>â€¦</li>
    

    
      <li><a href="https://ryoyakawai.com/blog/page16/">16</a></li>
    

    
    
      <li><a href="https://ryoyakawai.com/blog/page2/" class="btn">Next</a></li>
    
  </ul>
</div>


</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2019 Ryoya Kawai.</span>

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://ryoyakawai.com/blog/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://ryoyakawai.com/blog/assets/js/scripts.min.js"></script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116678332-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116678332-1');
</script>





<script type="text/javascript" src="https://ryoyakawai.com/blog/assets/js/header-title-post-index.js"></script>

</body>
</html>
